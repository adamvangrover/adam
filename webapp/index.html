<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Catalog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A simple font and custom scrollbar for a better look */
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* Simple animations for modal */
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }

        @keyframes slide-up {
            from { transform: translateY(20px) scale(0.98); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }

        /* Hide the modal by default */
        .modal-hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans">

    <div id="root" class="min-h-screen flex flex-col md:flex-row">
        <aside class="w-full md:w-64 md:flex-shrink-0 bg-gray-900 border-b md:border-b-0 md:border-r border-gray-800">
            <div class="flex items-center space-x-2 p-4 border-b border-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-indigo-400">
                    <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                    <polyline points="2 17 12 22 22 17"></polyline>
                    <polyline points="2 12 12 17 22 12"></polyline>
                </svg>
                <h1 class="text-xl font-bold text-white">Prompt Catalog</h1>
            </div>
            <nav class="p-4">
                <h2 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Workflow Stages</h2>
                <div id="sidebar-nav" class="flex flex-row md:flex-col overflow-x-auto md:overflow-x-visible pb-2 md:pb-0">
                    </div>
            </nav>
        </aside>

        <main class="flex-1 p-4 md:p-8">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-white">Credit Risk Agents</h2>
                <p class="text-gray-400 mt-1">
                    Browse and explore pre-defined prompts for various credit risk workflow stages.
                    Currently showing <span id="current-stage" class="font-bold text-indigo-400">All</span> stage.
                </p>
            </div>
            <div id="prompt-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
        </main>

        <div id="prompt-modal" class="fixed inset-0 bg-black/70 items-center justify-center p-4 z-50 modal-hidden">
            <div id="modal-content" class="bg-gray-800 border border-gray-700 rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const promptData = [
          {
            "prompt_id": "AGENT-ONBOARD-SCREEN-001", "workflow_stage": "PRE_TRADE", "agent_task": "Initial Counterparty Screening & Summarization", "trigger_event": "NewCreditApplicationReceived",
            "prompt_template": "You are a credit risk screening agent. A new credit application has been received and enriched with external data. Your task is to generate a structured initial assessment summary. Based on the provided context, which includes the application, financial ratios, and news sentiment analysis, you must:\n1. Provide a concise overview of the counterparty's business and financial profile.\n2. Identify and list up to 5 key credit risks, citing specific data points (e.g., high leverage, negative cash flow, industry volatility).\n3. Highlight any adverse media or sanctions-related red flags from the news sentiment and compliance checks.\n4. Conclude with a preliminary, automated risk classification (Low, Medium, High) to guide the credit officer's review.",
            "example_context": { "legalEntityIdentifier": "5493001B317445727B61", "applicationData": { "requestedCredit": 50000000, "industry": "Manufacturing" }, "financials": { "totalDebt": 250000000, "ebitda": 45000000, "debtToEbitdaRatio": 5.55 }, "newsSentiment": { "score": -0.75, "keywords": ["supply chain disruption", "labor dispute", "earnings miss"] }, "complianceCheck": { "sanctionsHit": false, "pepScreening": "Clear" } },
            "example_completion": "**Initial Assessment Summary: Global Manufacturing Inc.**\n\n**1. Business & Financial Profile:** The counterparty is an established firm in the manufacturing sector. Financials show moderate profitability but are characterized by significant leverage.\n\n**2. Key Credit Risks:**\n  - **High Leverage:** Debt-to-EBITDA ratio is 5.55x, indicating a high debt service burden.\n  - **Industry Headwinds:** The manufacturing sector is facing significant supply chain disruptions.\n  - **Profitability Concerns:** Recent earnings reports indicate a miss on revenue expectations.\n  - **Negative Cash Flow:** The latest quarterly report shows negative free cash flow, raising liquidity concerns.\n\n**3. Adverse Media & Red Flags:** News analysis reveals a consistently negative sentiment score (-0.75), driven by reports of ongoing labor disputes and supply chain challenges. Compliance checks are clear.\n\n**4. Preliminary Risk Classification:** High"
          },
          {
            "prompt_id": "AGENT-FIN-REPORT-001", "workflow_stage": "PERIODIC_REVIEW", "agent_task": "Analyze Quarterly Financial Statements", "trigger_event": "QuarterlyReportFiled",
            "prompt_template": "You are a financial analyst agent. The quarterly financial report for a counterparty is available. Your task is to analyze the key performance indicators (KPIs) against the prior period and the same quarter last year. Based on the provided financial data, you must:\n1. State the period-over-period (PoP) and year-over-year (YoY) percentage changes for Revenue, Net Income, and EBITDA.\n2. Analyze the Cash Flow from Operations (CFO) trend and comment on its quality.\n3. Identify the primary drivers for any significant changes in performance (e.g., margin compression, revenue growth, one-off expenses).\n4. Conclude with a summary of the company's financial trajectory (Improving, Stable, Deteriorating).",
            "example_context": { "counterpartyName": "Tech Solutions LLC", "currentPeriod": { "revenue": 150000000, "netIncome": 12000000, "ebitda": 30000000, "cfo": 25000000 }, "priorPeriod": { "revenue": 145000000, "netIncome": 14000000, "ebitda": 31000000, "cfo": 28000000 }, "priorYearPeriod": { "revenue": 120000000, "netIncome": 10000000, "ebitda": 26000000, "cfo": 20000000 } },
            "example_completion": "**Quarterly Financial Analysis: Tech Solutions LLC**\n\n**1. KPI Performance:**\n- **Revenue:** Grew 3.4% PoP and 25.0% YoY.\n- **Net Income:** Decreased 14.3% PoP but grew 20.0% YoY.\n- **EBITDA:** Decreased 3.2% PoP but grew 15.4% YoY.\n\n**2. Cash Flow Analysis:** Cash Flow from Operations remains strong at $25M, though it has decreased from the prior period. The ratio of CFO to Net Income is healthy at >2.0x, indicating high-quality earnings.\n\n**3. Key Drivers:** The YoY growth is strong, driven by successful new product launches. However, the sequential (PoP) decline in profitability metrics suggests recent margin compression, likely due to increased R&D and marketing spend noted in the report.\n\n**4. Financial Trajectory:** Improving (long-term trend) with short-term margin pressure."
          },
          {
            "prompt_id": "AGENT-CORP-RATING-001", "workflow_stage": "PERIODIC_REVIEW", "agent_task": "Determine Corporate Credit Rating", "trigger_event": "AnnualReviewCycleStart",
            "prompt_template": "You are a credit rating analyst. Based on the provided quantitative and qualitative factors, your task is to assign an internal corporate credit rating and provide a concise rationale. The rating scale is from AAA to D. Your analysis must:\n1. Assess the key financial ratios (Leverage, Coverage, Profitability) against internal benchmarks for the industry.\n2. Incorporate the qualitative assessments (Competitive Position, Industry Outlook).\n3. Propose a final credit rating.\n4. Justify the rating by summarizing the primary strengths and weaknesses.",
            "example_context": { "counterpartyName": "Stable Utilities Co.", "financials": { "debtToEbitda": 2.5, "ebitdaInterestCoverage": 8.0, "ebitdaMargin": "45%" }, "benchmarks": { "leverage": "Below industry median (3.0x)", "coverage": "Above industry median (6.0x)" }, "qualitative": { "competitivePosition": "Market leader in regulated territory", "industryOutlook": "Stable" } },
            "example_completion": "**Internal Credit Rating: Stable Utilities Co.**\n\n**1. Financial Ratio Assessment:** All key financial metrics are strong relative to industry benchmarks. Leverage is low at 2.5x and coverage is robust at 8.0x, indicating a very low risk of financial distress.\n\n**2. Qualitative Assessment:** The company benefits from a dominant competitive position in a highly stable, regulated industry.\n\n**3. Proposed Rating:** AA\n\n**4. Rationale:** The 'AA' rating is justified by the company's exceptional financial profile, characterized by low leverage and strong cash flows, combined with the stability and predictability of its regulated business model. There are no significant weaknesses identified."
          },
          {
            "prompt_id": "AGENT-REG-RATING-001", "workflow_stage": "PERIODIC_REVIEW", "agent_task": "Assign Regulatory Rating", "trigger_event": "CreditFileReview",
            "prompt_template": "You are a credit review agent. Your task is to recommend a regulatory rating for the given loan facility based on its performance and the borrower's condition. The possible ratings are 'Pass', 'Special Mention', and 'Substandard'. Your recommendation must:\n1. Review the payment history and covenant compliance status.\n2. Assess any signs of deteriorating financial condition or operational weaknesses.\n3. Conclude with a recommended rating and a clear, concise justification referencing specific issues.",
            "example_context": { "loanId": "LN-78910", "borrowerName": "Coastal Logistics", "paymentHistory": "No late payments in last 12 months.", "covenantCompliance": "In compliance with all covenants.", "financials": { "trend": "EBITDA has declined 20% over the last two quarters due to rising fuel costs.", "liquidity": "Cash on hand has decreased by 30%." } },
            "example_completion": "**Regulatory Rating Recommendation: Coastal Logistics**\n\n**1. Performance Review:** The loan is current and in full compliance with all financial covenants.\n\n**2. Borrower Condition:** Despite the clean performance, the borrower's financial condition shows clear signs of deterioration. A sustained 20% decline in EBITDA and a significant drop in liquidity represent a potential future weakness that could impair their ability to service debt if the trend continues.\n\n**3. Recommended Rating:** Special Mention\n\n**4. Justification:** A 'Special Mention' rating is warranted because, while the loan is not currently impaired, the borrower exhibits potential weaknesses that, if not corrected, may result in a deteriorated repayment capacity in the future."
          },
          {
            "prompt_id": "AGENT-ACCRUAL-STATUS-001", "workflow_stage": "POST_TRADE_MONITORING", "agent_task": "Determine Loan Accrual Status", "trigger_event": "Loan90DaysPastDue",
            "prompt_template": "You are a loan management agent. A loan is now 90 days past due on its principal or interest payment. Your task is to recommend whether to place the loan on non-accrual status. Your analysis must consider:\n1. The number of days the payment is past due.\n2. The likelihood of collecting the full principal and interest, considering collateral coverage and recent communications.\n3. Formulate a recommendation: 'Continue Accrual' or 'Place on Non-Accrual'.\n4. Provide a clear rationale for your recommendation.",
            "example_context": { "loanId": "LN-11121", "borrowerName": "Metro Development Group", "daysPastDue": 91, "collateral": { "type": "Real Estate", "loanToValue": "115%", "appraisalAge": "2 years" }, "communicationsLog": "Borrower has not responded to contact attempts in over 30 days." },
            "example_completion": "**Non-Accrual Recommendation: Metro Development Group**\n\n**1. Delinquency:** The loan is 91 days past due.\n\n**2. Collection Likelihood:** The collection of principal and interest is in doubt. The loan-to-value ratio is over 100% based on an outdated appraisal, suggesting a potential collateral shortfall. Furthermore, the borrower has been unresponsive, which indicates a lack of cooperation in resolving the delinquency.\n\n**3. Recommendation:** Place on Non-Accrual.\n\n**4. Rationale:** The loan should be placed on non-accrual status as the payment is over 90 days delinquent and the collection of future interest payments is not reasonably assured due to a potential collateral shortfall and lack of communication from the borrower."
          },
          {
            "prompt_id": "AGENT-VALUATION-NARRATE-001", "workflow_stage": "PERIODIC_REVIEW", "agent_task": "Summarize Company Valuation", "trigger_event": "ValuationModelRunCompleted",
            "prompt_template": "You are a valuation analyst. The output from valuation models is ready for review. Your task is to create a concise narrative summarizing the valuation results for an internal committee. The summary must:\n1. State the final estimated Enterprise Value (EV) range.\n2. List the primary valuation methodologies used (e.g., DCF, Trading Comps).\n3. Explain the key assumptions and drivers behind the primary methodology (e.g., WACC, terminal growth rate for DCF; median multiple for Comps).\n4. Conclude with a statement on the confidence level of the valuation.",
            "example_context": { "companyName": "Innovate Pharma Inc.", "valuationRangeEV": "1.8B - 2.2B USD", "methodologies": ["Discounted Cash Flow (DCF)", "Comparable Company Analysis (Trading Comps)"], "dcfAssumptions": { "wacc": "8.5%", "terminalGrowthRate": "2.0%", "keyDriver": "Successful launch of drug candidate 'X-25' in Year 3 projection." }, "compsAssumptions": { "peerSet": "Mid-cap biotech", "medianMultiple": "12.5x EV/EBITDA" } },
            "example_completion": "**Valuation Summary: Innovate Pharma Inc.**\n\n**1. Estimated Enterprise Value:** The estimated EV is in the range of $1.8B to $2.2B.\n\n**2. Methodologies:** The valuation is based on a Discounted Cash Flow (DCF) analysis, supported by a Comparable Company Analysis.\n\n**3. Key Assumptions:** The DCF is the primary methodology. Its valuation is highly sensitive to the successful commercialization of the 'X-25' drug candidate, which drives the majority of cash flow in the outer years of the forecast. The valuation assumes a Weighted Average Cost of Capital (WACC) of 8.5% and a terminal growth rate of 2.0%.\n\n**4. Confidence Level:** The confidence level is moderate, given the high dependency on a single clinical-stage asset. The valuation could change significantly based on future trial results."
          },
          {
            "prompt_id": "AGENT-PD-MAPPING-001", "workflow_stage": "POST_TRADE_MONITORING", "agent_task": "Interpret PD & Map to Rating", "trigger_event": "PDModelRecalculated",
            "prompt_template": "You are a quantitative analyst agent. A Probability of Default (PD) model has been run for a counterparty. Your task is to translate the model's output into a business-friendly explanation. You must:\n1. State the calculated 1-year Probability of Default.\n2. Identify the top 2-3 factors that drove the PD calculation, as indicated by the model's contribution analysis.\n3. Map the PD to the corresponding internal credit rating based on the provided ratings grid.\n4. Summarize the result in a single, coherent statement.",
            "example_context": { "counterpartyName": "Global Retail Corp", "calculatedPD": 1.75, "keyDrivers": ["High leverage ratio (6.2x Debt/EBITDA)", "Weakening consumer sentiment index", "Low interest coverage ratio (1.8x)"], "ratingGrid": { "0.0-0.5%": "AAA-A", "0.5-1.5%": "BBB", "1.5-3.0%": "BB", "3.0%+": "B or lower" } },
            "example_completion": "**Probability of Default Analysis: Global Retail Corp**\n\nFor Global Retail Corp, the 1-year Probability of Default has been calculated at 1.75%. This result was primarily driven by the company's high leverage and low interest coverage ratio. Based on the firm's rating grid, a PD of 1.75% maps to an internal credit rating of 'BB'."
          },
          {
            "prompt_id": "AGENT-OUTLOOK-ASSIGN-001", "workflow_stage": "PERIODIC_REVIEW", "agent_task": "Assign Credit Outlook", "trigger_event": "RatingCommitteePrep",
            "prompt_template": "You are a senior credit officer. Your task is to assign a credit outlook (Stable, Positive, or Negative) for a counterparty based on their current rating and forward-looking information. The outlook should reflect the most likely direction of the rating over the next 12-18 months. Your response must:\n1. State the current credit rating.\n2. Analyze the provided forward-looking factors (e.g., industry trends, M&A activity, strategy shifts).\n3. Recommend an outlook.\n4. Provide a 1-2 sentence justification that connects the factors to the potential rating change.",
            "example_context": { "counterpartyName": "Apex Industrials", "currentRating": "BBB-", "forwardLookingFactors": { "industryTrend": "Sector is facing secular decline due to technological disruption.", "companyNews": "Announced a large, debt-financed acquisition of a competitor.", "managementStrategy": "Strategy to integrate the acquisition carries significant execution risk." } },
            "example_completion": "**Credit Outlook: Apex Industrials**\n\n**1. Current Rating:** BBB-\n\n**2. Forward-Looking Analysis:** The company faces significant headwinds from a secularly declining industry. This challenge is compounded by a large, debt-financed acquisition that will increase leverage and introduces considerable integration risk.\n\n**3. Recommended Outlook:** Negative\n\n**4. Justification:** A Negative outlook is assigned because the combination of industry pressures and heightened risk from the new acquisition creates a strong possibility that credit metrics will weaken, potentially leading to a rating downgrade within the next 12-18 months."
          },
          {
            "prompt_id": "AGENT-TRADE-EXPLAIN-001", "workflow_stage": "AT_TRADE", "agent_task": "Explain New Trade Risk Drivers", "trigger_event": "BilateralTradeExecuted",
            "prompt_template": "You are a risk explanation agent. A new, non-cleared bilateral trade has been executed. Your task is to generate a plain-language explanation of its primary credit risk drivers for a non-quantitative audience (e.g., a relationship manager). Based on the provided trade context, your explanation must cover:\n1. The type of trade and its basic mechanics.\n2. The main market factors that will drive the bank's exposure to the counterparty (e.g., 'If interest rates fall, our exposure to the counterparty will grow').\n3. The significance of the trade's notional and maturity in the context of credit risk.",
            "example_context": { "tradeId": "a1b2c3d4-e5f6-7890-1234-567890abcdef", "counterpartyName": "Global Corp Inc.", "instrumentType": "10-Year USD Interest Rate Swap", "direction": "Receive Fixed", "notional": 100000000, "keyRiskFactors": null },
            "example_completion": "**New Trade Risk Explanation (Trade ID: a1b2c3d4)**\n\nWe have entered into a 10-year, $100 million Interest Rate Swap with Global Corp Inc., where we will receive a fixed interest rate and pay them a floating rate.\n\n**Primary Risk Driver:** Our main credit risk is tied to the movement of US interest rates. If interest rates fall significantly, the fixed payments we are scheduled to receive become more valuable. This would make the swap an asset on our books, and our exposure to Global Corp Inc. defaulting on their payments would increase substantially.\n\n**Significance:** The large notional ($100 million) and long maturity (10 years) make this a significant trade. Long-dated swaps are particularly sensitive to interest rate changes, meaning our potential future exposure can be large and can persist for a long time."
          },
          {
            "prompt_id": "AGENT-PFE-NARRATE-001", "workflow_stage": "POST_TRADE_MONITORING", "agent_task": "Narrate PFE/CVA Calculation Results", "trigger_event": "PortfolioExposureRecalculated",
            "prompt_template": "You are a quantitative risk translation agent. The nightly PFE and CVA calculation for a key counterparty has completed. Your task is to translate the raw quantitative output into a concise business narrative for the daily risk summary report. Based on the provided data, you must:\n1. State the current Maximum PFE (MPFE) and CVA values.\n2. Explain the primary driver of any significant change from the previous period (e.g., 'The 15% increase in MPFE was primarily driven by heightened market volatility in FX rates, which impacts the cross-currency swap portfolio').\n3. Highlight the time horizon where the peak exposure occurs.",
            "example_context": { "counterpartyName": "Hedge Fund Alpha", "metrics": { "currentMPFE": 125000000, "previousMPFE": 108000000, "peakPFEHorizon": "2 Years", "currentCVA": 2300000, "previousCVA": 2100000 }, "marketDataChange": { "driver": "FX Volatility", "change": "+12%" } },
            "example_completion": "**Daily Exposure Update: Hedge Fund Alpha**\n\nMaximum Potential Future Exposure (MPFE) has increased to $125M, with a current CVA of $2.3M. The 15.7% increase in MPFE overnight was primarily driven by a 12% spike in FX volatility, which significantly widened the potential future value distribution of the outstanding derivatives portfolio. The peak credit exposure is projected to occur at the 2-year mark."
          },
          {
            "prompt_id": "AGENT-BREACH-RCA-001", "workflow_stage": "POST_TRADE_MONITORING", "agent_task": "Limit Breach Root Cause Analysis", "trigger_event": "LimitBreachDetected",
            "prompt_template": "You are a risk investigation agent. A [severity] limit breach with ID [breachId] has occurred for counterparty [counterpartyId]. The limit of [limitValue] was exceeded by a calculated exposure of [breachValue]. Your task is to perform a root cause analysis. Analyze the provided context, including recent trade activity, market data movements, and collateral status, and provide a confidence score (0-1) for each potential cause: a) new trade activity, b) adverse market movement, c) collateral dispute or failure.",
            "example_context": { "breachId": "BR-2024-456", "severity": "CRITICAL", "counterpartyId": "...", "limitType": "PFE", "limitValue": 100000000, "breachValue": 125000000, "recentTrades": [{ "notional": 50000000 }], "marketData": { "USD_IR_VOL": "+15%" }, "collateral": { "status": "Disputed" } },
            "example_completion": "**Root Cause Analysis for Breach BR-2024-456:**\n- **New Large Trade:** Confidence: 0.7. A new trade with a $50M notional was executed shortly before the breach, which would have a significant marginal impact on PFE.\n- **Adverse Market Movement:** Confidence: 0.9. A 15% spike in USD interest rate volatility occurred, which dramatically increases the simulated future exposure of interest rate derivatives, the primary component of this portfolio.\n- **Collateral Dispute:** Confidence: 0.4. There is a collateral dispute, but the disputed amount is small and unlikely to be the primary driver of a $25M breach.\n**Conclusion:** The breach was most likely caused by a combination of the large new trade and the sharp increase in market volatility."
          },
          {
            "prompt_id": "AGENT-BREACH-ESCALATE-001", "workflow_stage": "POST_TRADE_MONITORING", "agent_task": "Draft Breach Escalation Communication", "trigger_event": "RootCauseAnalysisCompleted",
            "prompt_template": "You are a risk communication agent. Following a root cause analysis for breach [breachId], your task is to draft a concise escalation email to the Head of Credit Risk. The email must be formal and leverage the structured output from the analysis. Include these sections: 1) Executive Summary (Counterparty, Limit Type, Breach Amount), 2) Confirmed Root Cause, 3) Immediate Actions Taken (system-logged), and 4) Recommended Next Steps.",
            "example_context": { "breachId": "BR-2024-456", "counterpartyName": "Global Corp Inc.", "limitType": "PFE", "breachAmount": "25M USD", "rootCauseAnalysisOutput": "The breach was most likely caused by a combination of the large new trade and the sharp increase in market volatility.", "actionsTaken": "Trading desk has been notified; hard block automatically applied to prevent new exposure-increasing trades." },
            "example_completion": "Subject: URGENT: Critical PFE Limit Breach for Global Corp Inc. (BR-2024-456)\n\n**1. Executive Summary:**\nThis is to notify you of a critical breach of the Potential Future Exposure (PFE) limit for counterparty Global Corp Inc. The approved limit of $100M has been exceeded by $25M, with a current exposure of $125M.\n\n**2. Confirmed Root Cause:**\nAnalysis confirms the breach was triggered by the combined effect of a sharp increase in market volatility and the execution of a new large-notional interest rate swap.\n\n**3. Immediate Actions Taken:**\nThe trading desk has been formally notified, and a hard block has been automatically applied, preventing any new exposure-increasing trades with this counterparty without explicit approval from Credit Risk Management.\n\n**4. Recommended Next Steps:**\nWe recommend an immediate call with the counterparty to discuss posting additional discretionary collateral to cure the breach. We will also conduct a full portfolio review to identify potential risk-reducing trades."
          },
          {
            "prompt_id": "AGENT-STRESS-NARRATE-001", "workflow_stage": "POST_TRADE_MONITORING", "agent_task": "Summarize Stress Test Results", "trigger_event": "StressTestRunCompleted",
            "prompt_template": "You are a risk reporting agent. A firm-wide stress test has been completed. Your task is to generate a narrative summary of the results for a senior risk committee presentation. Based on the provided data for the '[scenarioName]' scenario, the summary must:\n1. State the overall P&L impact and the total increase in Potential Future Exposure (PFE).\n2. Identify the top 3 counterparties that contribute most to the increase in PFE.\n3. For the top counterparty, explain which specific trades or asset classes are the primary drivers of their increased exposure.\n4. Conclude with a statement on the portfolio's overall resilience to this specific shock.",
            "example_context": { "scenarioName": "Global Interest Rate Shock +200bps", "overallPnlImpact": -1200000000, "overallPfeIncrease": 5400000000, "topContributors": null, "topCounterpartyDeepDive": { "name": "Hedge Fund Alpha", "drivers": "Their large portfolio of long-dated, uncollateralized interest rate swaps, where they pay a fixed rate, saw a massive increase in mark-to-market value." } },
            "example_completion": "**Stress Test Summary: Global Interest Rate Shock +200bps**\n\n**Overall Impact:** The scenario resulted in a firm-wide P&L loss of $1.2 billion and a total increase in Potential Future Exposure of $5.4 billion.\n\n**Top Contributors:** The increase in credit exposure is highly concentrated. The top contributors are Hedge Fund Alpha ($850M increase) and Pension Plan Beta ($620M increase).\n\n**Deep Dive - Hedge Fund Alpha:** The exposure to Hedge Fund Alpha is driven almost exclusively by their large, uncollateralized portfolio of long-dated interest rate swaps. The sharp rise in interest rates caused the value of these positions to increase dramatically in our favor, thus increasing our credit risk to them.\n\n**Conclusion:** The portfolio shows significant vulnerability to a sharp, upward shift in global interest rates, particularly through uncollateralized derivatives with leveraged counterparties. A review of concentration limits for these specific clients is recommended."
          }
        ];

        // --- GLOBAL STATE ---
        let selectedStage = 'All';

        // --- DOM ELEMENTS ---
        const sidebarNav = document.getElementById('sidebar-nav');
        const promptGrid = document.getElementById('prompt-grid');
        const currentStageSpan = document.getElementById('current-stage');
        const modal = document.getElementById('prompt-modal');
        const modalContent = document.getElementById('modal-content');
        
        // --- STAGE COLORS MAPPING ---
        const stageColors = {
            'PRE_TRADE': 'bg-blue-900 text-blue-300',
            'AT_TRADE': 'bg-purple-900 text-purple-300',
            'POST_TRADE_MONITORING': 'bg-teal-900 text-teal-300',
            'PERIODIC_REVIEW': 'bg-amber-900 text-amber-300',
        };

        // --- RENDER FUNCTIONS ---

        function renderSidebar() {
            const stages = ['All', ...new Set(promptData.map(p => p.workflow_stage))];
            sidebarNav.innerHTML = ''; // Clear existing buttons
            stages.forEach(stage => {
                const isActive = selectedStage === stage;
                const button = document.createElement('button');
                button.textContent = stage.replace(/_/g, ' ');
                button.className = `flex-shrink-0 md:w-full text-left px-4 py-2 text-sm rounded-lg transition-colors duration-200 ${
                    isActive
                        ? 'bg-indigo-600 text-white font-semibold'
                        : 'text-gray-300 hover:bg-gray-700 hover:text-white'
                }`;
                button.onclick = () => {
                    selectedStage = stage;
                    renderSidebar();
                    renderPromptCards();
                    currentStageSpan.textContent = stage.replace(/_/g, ' ');
                };
                sidebarNav.appendChild(button);
            });
        }

        function renderPromptCards() {
            const filteredPrompts = selectedStage === 'All'
                ? promptData
                : promptData.filter(p => p.workflow_stage === selectedStage);
            
            promptGrid.innerHTML = ''; // Clear existing cards
            filteredPrompts.forEach(prompt => {
                const card = document.createElement('div');
                card.className = "bg-gray-800 rounded-lg border border-gray-700 p-6 cursor-pointer hover:border-indigo-500 hover:bg-gray-700/50 transition-all duration-200 group flex flex-col justify-between";
                card.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-semibold px-2.5 py-1 rounded-full ${stageColors[prompt.workflow_stage] || 'bg-gray-700 text-gray-300'}">
                                ${prompt.workflow_stage.replace(/_/g, ' ')}
                            </span>
                            <span class="text-xs text-gray-500 font-mono">${prompt.prompt_id}</span>
                        </div>
                        <h3 class="text-lg font-bold text-gray-100 mb-2 group-hover:text-indigo-400">${prompt.agent_task}</h3>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400 mt-3 border-t border-gray-700 pt-3">
                            <span class="font-semibold text-gray-300">Trigger:</span> ${prompt.trigger_event}
                        </p>
                    </div>
                `;
                card.onclick = () => openModal(prompt);
                promptGrid.appendChild(card);
            });
        }

        function openModal(prompt) {
            modalContent.innerHTML = `
                <header class="flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0">
                    <div>
                        <h2 class="text-xl font-bold text-white">${prompt.agent_task}</h2>
                        <p class="text-sm text-gray-400 font-mono">${prompt.prompt_id}</p>
                    </div>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-white transition-colors p-2 rounded-full hover:bg-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </header>
                <main class="p-6 overflow-y-auto space-y-6">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2">Prompt Template</h3>
                        <div class="relative bg-gray-900/50 p-4 rounded-lg border border-gray-700">
                            <button id="copy-btn" class="absolute top-2 right-2 p-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-indigo-600 hover:text-white transition-all text-xs">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </button>
                            <pre class="text-gray-300 text-sm whitespace-pre-wrap font-sans">${prompt.prompt_template}</pre>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2">Example Context</h3>
                        <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
                            <pre class="text-gray-300 text-sm whitespace-pre-wrap font-mono">${JSON.stringify(prompt.example_context, null, 2)}</pre>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2">Example Completion</h3>
                        <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
                            <pre class="text-gray-300 text-sm whitespace-pre-wrap font-sans">${prompt.example_completion}</pre>
                        </div>
                    </div>
                </main>
            `;

            // Add event listeners for the new modal content
            document.getElementById('close-modal-btn').onclick = closeModal;
            const copyBtn = document.getElementById('copy-btn');
            copyBtn.onclick = () => handleCopy(prompt.prompt_template, copyBtn);
            
            modal.classList.remove('modal-hidden');
            modal.classList.add('flex', 'animate-fade-in');
            modalContent.classList.add('animate-slide-up');
        }

        function closeModal() {
            modal.classList.add('modal-hidden');
            modal.classList.remove('flex', 'animate-fade-in');
            modalContent.classList.remove('animate-slide-up');
            modalContent.innerHTML = '';
        }
        
        // Use modern clipboard API with a fallback
        function handleCopy(text, buttonElement) {
             const originalIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            `;
            const successIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                   <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            `;
            
            const showSuccess = () => {
                buttonElement.innerHTML = successIcon;
                setTimeout(() => {
                   buttonElement.innerHTML = originalIcon;
                }, 2000);
            };
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(showSuccess).catch(err => {
                    console.error('Async copy failed: ', err);
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed'; // Avoid scrolling to bottom
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showSuccess();
                } catch (err) {
                    console.error('Fallback copy failed: ', err);
                }
                document.body.removeChild(textArea);
            }
        }


        // --- EVENT LISTENERS ---
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });
        
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // --- INITIALIZATION ---
        function init() {
            renderSidebar();
            renderPromptCards();
        }

        // Run the app when the DOM is ready
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
