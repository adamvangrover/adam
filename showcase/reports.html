<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM System | Reports & Newsletters</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .page-preview {
            background: white;
            color: black;
            font-family: 'Times New Roman', Times, serif;
            /* transform: scale(0.9); */
            width: 100%;
            min-height: 297mm; /* A4 height */
            padding: 20mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .report-title { font-size: 24pt; font-weight: bold; border-bottom: 2px solid #000; margin-bottom: 10px; }
        .report-meta { font-style: italic; color: #666; margin-bottom: 20px; }
        .section-title { font-size: 14pt; font-weight: bold; margin-top: 20px; border-bottom: 1px solid #ccc; color: #333; }
        .kv-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 10pt; }
        .kv-table td { border: 1px solid #ddd; padding: 4px 8px; }
        .kv-table tr:nth-child(even) { background-color: #f9f9f9; }
        .kv-key { font-weight: bold; background-color: #f0f0f0; width: 40%; }
    </style>
</head>
<body class="h-screen flex flex-col grid-bg text-slate-200">
    <div class="scan-line"></div>
    <!-- Nav via nav.js -->

    <main class="flex-1 p-8 overflow-y-auto grid grid-cols-12 gap-6">

        <!-- Header -->
        <div class="col-span-12 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2 font-mono">INTELLIGENCE PRODUCTS</h1>
                <p class="text-slate-400">Automated financial reports, investment memos, and newsletters generated by the Adam System.</p>
            </div>
        </div>

        <!-- Document List -->
        <div class="col-span-12 lg:col-span-4 h-[80vh] flex flex-col space-y-4 overflow-y-auto pr-2" id="doc-list">
            <!-- Loading... -->
             <div class="glass-panel p-4 rounded text-center text-slate-500">Loading documents...</div>
        </div>

        <!-- Preview Area -->
        <div class="col-span-12 lg:col-span-8 bg-slate-800/30 rounded-lg flex flex-col overflow-hidden border border-slate-800 relative h-[80vh]">
            <div class="absolute top-4 right-4 z-10 space-x-2">
                <button class="bg-slate-900 text-white px-3 py-1 rounded text-xs border border-slate-600 hover:bg-slate-700 shadow">DOWNLOAD PDF</button>
                <button class="bg-slate-900 text-white px-3 py-1 rounded text-xs border border-slate-600 hover:bg-slate-700 shadow">PRINT</button>
            </div>

            <!-- Document Container (Scaled) -->
            <div id="preview-container" class="w-full h-full overflow-y-auto p-10 bg-slate-900">
                <div id="doc-content" class="page-preview shadow-2xl mx-auto">
                    <div class="h-full flex flex-col items-center justify-center text-slate-400 mt-20">
                        <p>Select a document to preview</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Wait for app init or use mock data directly
            const data = window.MOCK_DATA || {};
            const reports = data.reports || [];
            const newsletters = data.newsletters || [];

            const listContainer = document.getElementById('doc-list');
            listContainer.innerHTML = '';

            // Newsletters Section
            if(newsletters.length > 0) {
                const nsDiv = document.createElement('div');
                nsDiv.className = 'glass-panel p-4 rounded-lg';
                nsDiv.innerHTML = `<h3 class="text-amber-500 font-mono font-bold text-sm mb-4 uppercase tracking-wider">Newsletters</h3>`;
                const nsList = document.createElement('div');
                nsList.className = 'space-y-2';

                newsletters.forEach((item, idx) => {
                    const el = document.createElement('div');
                    el.className = 'p-3 bg-slate-800/50 hover:bg-slate-700 border border-slate-700 hover:border-amber-500/50 rounded cursor-pointer transition group';
                    el.innerHTML = `
                         <div class="flex justify-between items-center">
                            <h4 class="font-bold text-slate-200 group-hover:text-amber-400 text-sm">${item.title || "Newsletter"}</h4>
                            <span class="text-[0.6rem] text-slate-500">${item.date || 'Unknown'}</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1 truncate">${item.file_path}</p>
                    `;
                    el.onclick = () => renderDoc(item, 'newsletter');
                    nsList.appendChild(el);
                });
                nsDiv.appendChild(nsList);
                listContainer.appendChild(nsDiv);
            }

            // Reports Section
            if(reports.length > 0) {
                 const repDiv = document.createElement('div');
                repDiv.className = 'glass-panel p-4 rounded-lg';
                repDiv.innerHTML = `<h3 class="text-blue-500 font-mono font-bold text-sm mb-4 uppercase tracking-wider">Analysis Reports</h3>`;
                const repList = document.createElement('div');
                repList.className = 'space-y-2';

                reports.forEach((item, idx) => {
                    const el = document.createElement('div');
                    el.className = 'p-3 bg-slate-800/50 hover:bg-slate-700 border border-slate-700 hover:border-blue-500/50 rounded cursor-pointer transition group';
                    const rating = item.rating || "N/A"; // Assuming some rating field
                    el.innerHTML = `
                        <div class="flex justify-between items-center">
                            <h4 class="font-bold text-slate-200 group-hover:text-blue-400 text-sm">${item.company || item.title || "Report"}</h4>
                            <span class="text-[0.6rem] bg-slate-800 px-1 rounded border border-slate-700 text-slate-400">REPORT</span>
                        </div>
                         <p class="text-xs text-slate-400 mt-1 truncate">${item.title || item.file_path}</p>
                    `;
                    el.onclick = () => renderDoc(item, 'report');
                    repList.appendChild(el);
                });
                repDiv.appendChild(repList);
                listContainer.appendChild(repDiv);
            }
        });

        function renderDoc(data, type) {
            const container = document.getElementById('doc-content');

            if (data.type === 'markdown') {
                container.innerHTML = `
                    <div class="report-title">${data.title}</div>
                    <div class="report-meta">Source: ${data.file_path}</div>
                    <div class="whitespace-pre-wrap font-mono text-sm">${data.raw_content_preview || "Markdown content rendering not fully implemented in static preview."}</div>
                `;
                return;
            }

            // Render JSON Report
            let html = `
                <div class="text-right text-xs text-gray-500 mb-8">ADAM INTELLIGENCE REPORT | ${new Date().toISOString().split('T')[0]}</div>
                <div class="report-title">${data.title || data.company + " Report"}</div>
                <div class="report-meta">
                    <strong>Company:</strong> ${data.company || "N/A"} <br>
                    <strong>Date:</strong> ${data.date || new Date().toLocaleDateString()} <br>
                    <strong>File:</strong> ${data.file_path}
                </div>
            `;

            if (data.sections) {
                data.sections.forEach(sec => {
                    html += `<div class="section-title">${sec.title}</div>`;
                    if (sec.content) {
                        html += `<p class="mt-2 text-justify">${sec.content}</p>`;
                    }
                    if (sec.metrics) {
                        html += `<table class="kv-table">`;
                        for (const [key, val] of Object.entries(sec.metrics)) {
                             let displayVal = val;
                             if (typeof val === 'object') {
                                 displayVal = Object.entries(val).map(([k,v]) => `${k}: ${v}`).join(', ');
                             }
                             html += `<tr><td class="kv-key">${key}</td><td>${displayVal}</td></tr>`;
                        }
                        html += `</table>`;
                    }
                    if (sec.risks) {
                        html += `<table class="kv-table">`;
                         for (const [key, val] of Object.entries(sec.risks)) {
                             html += `<tr><td class="kv-key">${key}</td><td style="color:${val==='High'?'red':'black'}">${val}</td></tr>`;
                        }
                        html += `</table>`;
                    }
                    if (sec.analysis) {
                         html += `<div class="mt-2 text-sm italic border-l-4 border-blue-200 pl-2 text-gray-600">${sec.analysis}</div>`;
                    }
                });
            } else {
                // Fallback for flat JSON
                html += `<pre class="text-xs bg-gray-100 p-2 mt-4 overflow-auto">${JSON.stringify(data, null, 2)}</pre>`;
            }

            container.innerHTML = html;
        }
    </script>
</body>
</html>
