<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | Scenario Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .scenario-active {
            border: 1px solid var(--accent-color);
            background: rgba(10, 255, 96, 0.1);
        }
        .trend-up { color: #0aff60; }
        .trend-down { color: #ff3333; }
    </style>
</head>
<body class="h-screen flex flex-col grid-bg overflow-hidden text-slate-200">
    <div class="scan-line"></div>

    <!-- Header -->
    <header class="h-16 border-b border-slate-700/50 flex items-center justify-between px-6 bg-[#0f172a]/90 backdrop-blur-md z-40 shrink-0">
        <div class="flex items-center gap-4">
            <h1 class="text-xl font-bold tracking-tight mono">ADAM <span class="text-amber-400">v23.5</span> <span class="text-slate-500 font-normal">| Scenario Engine</span></h1>
        </div>
        <div class="flex gap-6 font-mono text-xs hidden md:flex">
             <div>STATUS: <span class="text-emerald-400">ONLINE</span></div>
             <div>SCENARIO: <span class="text-amber-400" id="active-scenario-label">--</span></div>
        </div>
    </header>

    <main class="flex-1 p-6 flex flex-col overflow-hidden relative">

        <!-- Top Bar: Scenario Selector & Metadata -->
        <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Active Scenario Card -->
            <div class="cyber-card p-6 rounded-lg relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl"><i class="fas fa-chess"></i></div>
                <h3 class="text-xs text-slate-500 font-mono uppercase mb-2">Active Regime</h3>
                <div class="text-2xl font-bold text-white font-mono mb-2" id="scenario-name">LOADING...</div>
                <p class="text-xs text-slate-400" id="scenario-desc">Waiting for market data stream...</p>
                <div class="mt-4 flex gap-2">
                    <span class="px-2 py-1 bg-slate-800 rounded text-[10px] font-mono border border-slate-700 text-slate-400">Drift: <span id="metric-drift">--</span></span>
                    <span class="px-2 py-1 bg-slate-800 rounded text-[10px] font-mono border border-slate-700 text-slate-400">Vol: <span id="metric-vol">--</span></span>
                </div>
            </div>

            <!-- Market Tickers -->
            <div class="cyber-card p-6 rounded-lg md:col-span-2 overflow-y-auto custom-scrollbar">
                <h3 class="text-xs text-slate-500 font-mono uppercase mb-4 flex justify-between">
                    <span>Live Feeds</span>
                    <span class="text-[10px]">UPDATED: <span id="last-updated">--</span></span>
                </h3>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4" id="ticker-grid">
                    <!-- Injected via JS -->
                </div>
            </div>
        </div>

        <!-- Bottom: News Feed & Control -->
        <div class="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-6 overflow-hidden">

            <!-- News Feed -->
            <div class="cyber-card p-6 rounded-lg lg:col-span-2 flex flex-col">
                <h3 class="text-xs text-slate-500 font-mono uppercase mb-4"><i class="fas fa-rss"></i> Scenario Narrative Stream</h3>
                <div class="flex-1 overflow-y-auto custom-scrollbar space-y-3" id="news-feed">
                    <!-- News Items -->
                </div>
            </div>

            <!-- Controls (Simulation) -->
            <div class="cyber-card p-6 rounded-lg flex flex-col">
                <h3 class="text-xs text-slate-500 font-mono uppercase mb-4"><i class="fas fa-terminal"></i> Simulation Controls</h3>
                <div class="flex-1 space-y-4">
                    <p class="text-xs text-slate-400 mb-4">
                        Manually trigger regime shifts or inject volatility.
                        <br><span class="opacity-50">(Requires backend agent connection)</span>
                    </p>

                    <div class="space-y-2">
                        <div class="p-3 border border-slate-700 hover:border-cyan-500 cursor-pointer transition rounded bg-slate-800/50 group" onclick="console.log('Trigger Bull')">
                            <div class="text-xs font-bold text-white group-hover:text-cyan-400">ACTIVATE: BULL_RALLY</div>
                            <div class="text-[10px] text-slate-500">Positive drift, low volatility.</div>
                        </div>
                        <div class="p-3 border border-slate-700 hover:border-red-500 cursor-pointer transition rounded bg-slate-800/50 group" onclick="console.log('Trigger Bear')">
                            <div class="text-xs font-bold text-white group-hover:text-red-400">ACTIVATE: BEAR_CRASH</div>
                            <div class="text-[10px] text-slate-500">Negative drift, high volatility.</div>
                        </div>
                        <div class="p-3 border border-slate-700 hover:border-amber-500 cursor-pointer transition rounded bg-slate-800/50 group" onclick="console.log('Trigger Hammer')">
                            <div class="text-xs font-bold text-white group-hover:text-amber-400">ACTIVATE: MIDNIGHT_HAMMER</div>
                            <div class="text-[10px] text-slate-500">Energy spike, geopolitical shock.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script src="js/market_snapshot.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.MARKET_SNAPSHOT) {
                renderDashboard(window.MARKET_SNAPSHOT);
            } else {
                console.error("Market Snapshot data missing.");
            }
        });

        function renderDashboard(data) {
            // 1. Scenario Info
            const meta = data.metadata || {};
            const scenario = meta.active_scenario || "Unknown";
            document.getElementById('scenario-name').innerText = scenario;
            document.getElementById('active-scenario-label').innerText = scenario.toUpperCase();
            document.getElementById('last-updated').innerText = meta.generated_at ? new Date(meta.generated_at).toLocaleTimeString() : "--";

            // Description mapping (Mock)
            const descriptions = {
                "Normal Market": "Standard market conditions.",
                "Bull Rally": "Strong upward momentum.",
                "Bear Crash": "Panic selling and high volatility.",
                "Operation Midnight Hammer": "Geopolitical energy shock.",
                "Fractured Ouroboros": "Credit cycle collapse."
            };
            document.getElementById('scenario-desc').innerText = descriptions[scenario] || meta.description || "System running.";

            // 2. Tickers
            const grid = document.getElementById('ticker-grid');
            const keySymbols = ["ES=F", "NQ=F", "BTC-USD", "CL=F", "GC=F", "AAPL", "NVDA", "JPM"];

            keySymbols.forEach(sym => {
                const item = data.market_data[sym];
                if (!item) return;

                const changeClass = item.change_pct >= 0 ? "trend-up" : "trend-down";
                const icon = item.change_pct >= 0 ? "fa-caret-up" : "fa-caret-down";

                const el = document.createElement('div');
                el.className = "bg-slate-900/50 p-3 rounded border border-slate-800 flex justify-between items-center";
                el.innerHTML = `
                    <div>
                        <div class="text-xs font-bold text-white font-mono">${sym}</div>
                        <div class="text-sm font-mono text-slate-300">$${item.price.toLocaleString()}</div>
                    </div>
                    <div class="text-right">
                        <div class="${changeClass} text-xs font-mono font-bold">
                            <i class="fas ${icon}"></i> ${Math.abs(item.change_pct)}%
                        </div>
                    </div>
                `;
                grid.appendChild(el);
            });

            // 3. News
            const newsContainer = document.getElementById('news-feed');
            (data.news_feed || []).slice(0, 20).forEach(news => {
                const el = document.createElement('div');
                el.className = "p-3 bg-slate-800/30 border-l-2 border-slate-700 text-xs text-slate-300 font-mono";

                // Color code sentiment
                let color = "border-slate-700";
                if(news.sentiment === "POSITIVE") color = "border-emerald-500";
                if(news.sentiment === "NEGATIVE") color = "border-red-500";
                if(news.sentiment === "NEUTRAL") color = "border-amber-500";

                el.classList.replace("border-slate-700", color);

                el.innerHTML = `
                    <div class="flex justify-between text-[10px] text-slate-500 mb-1">
                        <span>${news.source}</span>
                        <span>${news.timestamp ? new Date(news.timestamp).toLocaleTimeString() : ""}</span>
                    </div>
                    <div class="text-white">${news.headline}</div>
                `;
                newsContainer.appendChild(el);
            });
        }

        // Auto-refresh (Poll for file changes via JS re-injection hack or just simple timer if serving live)
        // For static showcase, we rely on manual refresh.
    </script>
    <script src="../showcase/js/nav.js" data-root=".."></script>
</body>
</html>
