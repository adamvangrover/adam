<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | AVG Schedule Optimizer</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-dark: #020408;
            --panel-bg: rgba(15, 23, 42, 0.95);
            --border-color: #334155;
            --accent-cyan: #22d3ee;
            --accent-purple: #a855f7;
        }

        body {
            background-color: var(--bg-dark);
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
        }

        .scan-line {
            position: fixed; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(to bottom, rgba(34, 211, 238, 0), rgba(34, 211, 238, 0.5), rgba(34, 211, 238, 0));
            opacity: 0.1; animation: scan 8s linear infinite; pointer-events: none; z-index: 50;
        }
        @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }

        .tab-active {
            border-bottom: 2px solid var(--accent-cyan);
            color: var(--accent-cyan);
        }
        .tab-inactive {
            color: #64748b;
        }
        .tab-inactive:hover {
            color: #94a3b8;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-[#050b14] relative overflow-x-hidden">
    <div class="scan-line"></div>

    <!-- Header -->
    <header class="h-16 border-b border-slate-700/50 flex items-center justify-between px-6 bg-[#0f172a]/90 backdrop-blur-md z-40 sticky top-0">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-400 hover:text-white transition"><i class="fas fa-arrow-left"></i></a>
            <div class="w-8 h-8 bg-cyan-900/50 rounded flex items-center justify-center border border-cyan-500/30">
                <i class="fas fa-sliders-h text-cyan-400"></i>
            </div>
            <h1 class="text-xl font-bold tracking-tight mono">ADAM <span class="text-cyan-400">AVG OPTIMIZER</span> <span class="text-slate-500 font-normal">| Schedule Tuning Workbench</span></h1>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex gap-6 text-sm font-mono">
            <a href="avg_search.html" class="tab-inactive py-2">DASHBOARD</a>
            <a href="avg_schedule.html" class="tab-active py-2">OPTIMIZER</a>
            <a href="avg_market.html" class="tab-inactive py-2">MARKET SCAN</a>
        </div>
    </header>

    <main class="flex-1 p-6 grid grid-cols-12 gap-6 max-w-7xl mx-auto w-full">

        <!-- Controls Column -->
        <div class="col-span-12 lg:col-span-4 space-y-6">

            <div class="glass-panel p-6 rounded-lg">
                <h2 class="text-lg font-bold text-white mono mb-4 border-b border-slate-700 pb-2">ADAM PARAMETERS</h2>
                <p class="text-xs text-slate-400 mb-6">
                    Adjust hyperparameters to control how the Adam optimizer explores the annealing schedule landscape.
                </p>

                <div class="space-y-4">
                    <!-- Scenario Selection -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-2">SCENARIO PRESET</label>
                        <select id="scenario-select" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm text-white focus:border-cyan-500 outline-none" onchange="updateView()">
                            <option value="Default">Default (Balanced)</option>
                            <option value="Aggressive">Aggressive (High LR)</option>
                            <option value="Conservative">Conservative (Low LR)</option>
                        </select>
                    </div>

                    <!-- Read-Only Params Display -->
                    <div class="grid grid-cols-2 gap-4 pt-4">
                        <div class="bg-slate-800/50 p-2 rounded">
                            <div class="text-[10px] text-slate-500 uppercase">Learning Rate</div>
                            <div class="font-mono text-cyan-400" id="param-lr">--</div>
                        </div>
                        <div class="bg-slate-800/50 p-2 rounded">
                            <div class="text-[10px] text-slate-500 uppercase">Beta 1 (Momentum)</div>
                            <div class="font-mono text-cyan-400" id="param-beta1">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="glass-panel p-4 rounded-lg">
                <h3 class="text-xs font-bold text-slate-500 mono uppercase mb-3">Performance Metrics</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-slate-300">Final Fidelity</span>
                        <span class="font-bold text-emerald-400 mono" id="metric-fidelity">--%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-slate-300">Convergence Step</span>
                        <span class="font-bold text-white mono" id="metric-convergence">--</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-slate-300">Enterprise Odds</span>
                        <span class="font-bold text-purple-400 mono" id="metric-odds">--</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- Visualization Column -->
        <div class="col-span-12 lg:col-span-8 space-y-6">

            <!-- Comparison Chart -->
            <div class="glass-panel p-6 rounded-lg">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold text-white mono">OPTIMIZATION TRACE COMPARISON</h2>
                    <span class="text-xs font-mono bg-slate-800 px-2 py-1 rounded text-slate-400">Loss over Iterations</span>
                </div>
                <div class="h-64 relative">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <!-- Schedule Shape -->
            <div class="glass-panel p-6 rounded-lg">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold text-white mono">RESULTING SCHEDULE SHAPE</h2>
                    <span class="text-xs font-mono bg-slate-800 px-2 py-1 rounded text-cyan-400" id="scenario-label">Default</span>
                </div>
                <div class="h-48 relative">
                    <canvas id="scheduleChart"></canvas>
                </div>
            </div>
        </div>

    </main>

    <script>
        let globalData = null;
        let comparisonChart = null;
        let scheduleChart = null;

        async function loadData() {
            try {
                const response = await fetch('data/quantum_search_data.json');
                globalData = await response.json();

                // Init Charts
                initCharts();

                // Render Initial View
                updateView();
            } catch (e) {
                console.error("Failed to load data:", e);
            }
        }

        function initCharts() {
            // 1. Comparison Chart (Losses)
            const ctxComp = document.getElementById('comparisonChart').getContext('2d');

            const datasets = [];
            const colors = {
                "Default": "#22d3ee",      // Cyan
                "Aggressive": "#f472b6",   // Pink
                "Conservative": "#a78bfa"  // Purple
            };

            if (globalData.optimizer_comparison) {
                Object.entries(globalData.optimizer_comparison).forEach(([name, data]) => {
                    datasets.push({
                        label: name,
                        data: data.trace.loss,
                        borderColor: colors[name] || "#cbd5e1",
                        borderWidth: 2,
                        tension: 0.3,
                        pointRadius: 0
                    });
                });
            }

            comparisonChart = new Chart(ctxComp, {
                type: 'line',
                data: {
                    labels: Array.from({length: 100}, (_, i) => i), // 0-99
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#94a3b8' } } },
                    scales: {
                        y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' }, title: { display: true, text: 'Loss', color: '#64748b' } },
                        x: { grid: { display: false }, ticks: { color: '#64748b' }, title: { display: true, text: 'Iteration', color: '#64748b' } }
                    }
                }
            });

            // 2. Schedule Chart (Dynamic)
            const ctxSched = document.getElementById('scheduleChart').getContext('2d');
            scheduleChart = new Chart(ctxSched, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'A(t)',
                            data: [],
                            borderColor: '#22d3ee',
                            borderWidth: 2, pointRadius: 0
                        },
                        {
                            label: 'B(t)',
                            data: [],
                            borderColor: '#a855f7',
                            borderWidth: 2, pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#94a3b8' } } },
                    scales: {
                        y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' }, min: 0, max: 1 },
                        x: { grid: { display: false }, ticks: { display: false } }
                    }
                }
            });
        }

        function updateView() {
            if (!globalData || !globalData.optimizer_comparison) return;

            const selectedScenario = document.getElementById('scenario-select').value;
            const scenarioData = globalData.optimizer_comparison[selectedScenario];

            if (!scenarioData) return;

            // Update Metrics
            document.getElementById('metric-fidelity').innerText = (scenarioData.metrics.simulation_fidelity * 100).toFixed(4) + "%";
            document.getElementById('metric-odds').innerText = scenarioData.metrics.enterprise_success_probability.toExponential(2);
            document.getElementById('scenario-label').innerText = selectedScenario;

            // Mock Params (Ideally these come from JSON)
            const mockParams = {
                "Default": { lr: 0.05, beta1: 0.9 },
                "Aggressive": { lr: 0.20, beta1: 0.8 },
                "Conservative": { lr: 0.01, beta1: 0.95 }
            };
            document.getElementById('param-lr').innerText = mockParams[selectedScenario].lr;
            document.getElementById('param-beta1').innerText = mockParams[selectedScenario].beta1;

            // Convergence Step (First step where loss < 0.1)
            const convergenceIdx = scenarioData.trace.loss.findIndex(l => l < 0.1);
            document.getElementById('metric-convergence').innerText = convergenceIdx > -1 ? convergenceIdx : ">100";

            // Update Schedule Chart
            scheduleChart.data.labels = scenarioData.schedule.t.map(t => t.toFixed(2));
            scheduleChart.data.datasets[0].data = scenarioData.schedule.A;
            scheduleChart.data.datasets[1].data = scenarioData.schedule.B;
            scheduleChart.update();
        }

        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
