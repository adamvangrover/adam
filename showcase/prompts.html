<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM System | Prompt as Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="h-screen flex flex-col grid-bg text-slate-200">
    <div class="scan-line"></div>
    <!-- Nav via nav.js -->

    <main class="flex-1 p-8 overflow-y-auto grid grid-cols-12 gap-6">

        <!-- Header -->
        <div class="col-span-12 glass-panel p-6 rounded-lg border-l-4 border-amber-500 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2 font-mono">PROMPT AS CODE (PaC)</h1>
                <p class="text-slate-400">Structured, version-controlled prompt templates with Jinja2 rendering and Pydantic validation.</p>
            </div>
            <div class="text-right hidden md:block">
                 <div class="text-2xl font-mono text-amber-500 font-bold">AOPL v1.0</div>
                 <div class="text-xs text-slate-500">ADAM OPEN PROMPT LIBRARY</div>
            </div>
        </div>

        <!-- Sidebar List -->
        <div class="col-span-12 lg:col-span-3 glass-panel rounded-lg overflow-hidden flex flex-col h-[70vh]">
            <div class="bg-slate-900/50 p-4 border-b border-slate-700 font-bold text-slate-300 text-sm">TEMPLATE LIBRARY</div>
            <div class="overflow-y-auto flex-1 p-2 space-y-1" id="prompt-list">
                <!-- Populated via JS -->
                 <div class="text-slate-500 text-xs text-center mt-4">Loading templates...</div>
            </div>
        </div>

        <!-- Editor/Viewer -->
        <div class="col-span-12 lg:col-span-9 glass-panel rounded-lg flex flex-col h-[70vh] border border-slate-700">
            <!-- Toolbar -->
            <div class="bg-slate-900/80 p-3 border-b border-slate-700 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <span id="current-file" class="font-mono text-amber-400 font-bold text-sm">select_template.md</span>
                    <span class="text-xs text-slate-500 bg-slate-800 px-2 py-0.5 rounded border border-slate-700">READ ONLY</span>
                </div>
                <div class="flex space-x-3 text-xs font-mono">
                    <button class="text-slate-400 hover:text-white" onclick="alert('Copy function mock')">COPY</button>
                    <button class="text-slate-400 hover:text-white" onclick="alert('History function mock')">HISTORY</button>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 bg-slate-900/50 p-6 overflow-auto font-mono text-sm leading-relaxed text-slate-300" id="prompt-content">
                <p class="text-slate-500 italic">// Select a prompt template from the library to view source.</p>
                <br>
                <p class="text-slate-500">
                    The Adam System uses a "Prompt-as-Code" architecture. Prompts are not magic strings; they are structured assets managed like software code.<br><br>
                    Features:<br>
                    - <span class="text-cyan-400">Jinja2 Templating</span>: Dynamic variable injection.<br>
                    - <span class="text-purple-400">Pydantic Validation</span>: Type-safe inputs and outputs.<br>
                    - <span class="text-emerald-400">Version Control</span>: Git-backed history and rollbacks.
                </p>
            </div>
        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             const data = window.MOCK_DATA || {};
             const prompts = data.prompts || [];
             renderList(prompts);
        });

        function renderList(prompts) {
            const list = document.getElementById('prompt-list');
            list.innerHTML = '';

            if (prompts.length === 0) {
                list.innerHTML = '<div class="text-slate-500 text-xs text-center mt-4">No templates found in data.</div>';
                return;
            }

            // Group by category
            const categories = {};
            prompts.forEach(p => {
                const cat = p.category || "General";
                if(!categories[cat]) categories[cat] = [];
                categories[cat].push(p);
            });

            // Sort categories
            const sortedCats = Object.keys(categories).sort();

            for (const cat of sortedCats) {
                const items = categories[cat];
                const group = document.createElement('div');
                group.className = 'mb-4';
                group.innerHTML = `<h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 px-2 border-b border-slate-800 pb-1">${cat}</h4>`;

                items.forEach(item => {
                    const btn = document.createElement('button');
                    const ext = item.name.split('.').pop();
                    btn.className = 'w-full text-left px-3 py-2 text-sm text-slate-300 hover:bg-slate-700/50 hover:text-white rounded transition mb-1 flex justify-between items-center group';
                    btn.innerHTML = `
                        <span class="truncate pr-2" title="${item.name}">${item.name}</span>
                        <span class="text-[0.6rem] text-slate-600 bg-slate-900 px-1 rounded border border-slate-800 group-hover:border-slate-600 font-mono">${ext.toUpperCase()}</span>
                    `;
                    btn.onclick = () => loadPrompt(item);
                    group.appendChild(btn);
                });

                list.appendChild(group);
            }
        }

        async function loadPrompt(item) {
            document.getElementById('current-file').textContent = item.path;
            const container = document.getElementById('prompt-content');
            container.innerHTML = '<span class="text-slate-500">Loading content...</span>';

            const content = await window.dataManager.getFileContent(item.path);

            // Simple syntax highlighting mock
            let html = content
                .replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/{{/g, '<span class="text-amber-500">{{').replace(/}}/g, '}}</span>')
                .replace(/{% /g, '<span class="text-purple-500">{% ').replace(/ %}/g, ' %}</span>')
                .replace(/---/g, '<span class="text-slate-500">---</span>');

            container.innerHTML = `<pre>${html}</pre>`;
        }
    </script>

    <!-- Adam Global Nav -->
    <script src="../showcase/js/nav.js" data-root=".."></script>
</body>
</html>
