<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM v24.0 | Credit Architect</title>

    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons (Vanilla JS) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* Embedded Cyber-Minimalist Theme from showcase/css/style.css */
        :root {
            --bg-dark: #050b14;
            --bg-card: rgba(15, 23, 42, 0.6);
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --primary-color: #06b6d4; /* Cyan 500 */
            --primary-glow: rgba(6, 182, 212, 0.5);
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-amber: #f59e0b;
            --panel-border: rgba(148, 163, 184, 0.1);
            --font-mono: 'JetBrains Mono', monospace;
            --font-sans: 'Inter', sans-serif;
            --grid-color: rgba(56, 189, 248, 0.03);
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-dark);
            color: var(--text-primary);
            background-image:
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .font-mono { font-family: var(--font-mono); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Glass Panel / Card */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--panel-border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: var(--primary-glow);
            box-shadow: 0 0 15px var(--primary-glow);
        }

        /* Inputs */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .input-cell:focus {
            background-color: rgba(6, 182, 212, 0.1);
            outline: none;
            color: var(--primary-color);
        }

        /* Driver Input Styles */
        .driver-input {
            background-color: rgba(6, 182, 212, 0.05);
            color: #22d3ee;
            text-align: right;
            border-radius: 2px;
            transition: all 0.2s;
        }
        .driver-input:focus {
            background-color: rgba(6, 182, 212, 0.2);
            box-shadow: 0 0 5px rgba(6, 182, 212, 0.3);
        }

        /* Scanline Effect */
        .scan-line {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px; pointer-events: none; z-index: 50; opacity: 0.15;
        }

        /* Print Styling */
        @media print {
            body { background: white; color: black; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .card { border: 1px solid #ddd; box-shadow: none; break-inside: avoid; margin-bottom: 20px; background: white !important; color: black !important; }
            .text-slate-200, .text-slate-300, .text-slate-400 { color: #333 !important; }
            .text-emerald-400, .text-emerald-500 { color: #006600 !important; }
            .text-rose-400, .text-rose-500 { color: #aa0000 !important; }
            .text-blue-400 { color: #0000aa !important; }
            input { border: none; text-align: right; background: transparent; color: black !important; }
            .scan-line { display: none; }
            .driver-input { background: none; color: black; border: 1px solid #eee; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="scan-line"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- Icon Component (Safe for Vanilla Lucide) ---
        const Icon = ({ name, className = "" }) => {
            // Use ref to trigger icon replacement
            const iconRef = React.useRef(null);

            useEffect(() => {
                if (iconRef.current) {
                    lucide.createIcons({
                        root: iconRef.current.parentNode,
                        icons: { [name]: lucide.icons[name] }, // Targeted replacement
                        nameAttr: 'data-lucide',
                        attrs: { class: className }
                    });
                }
            }, [name, className]);

            // Initial render as placeholder i tag
            return <i data-lucide={name} ref={iconRef} className={className}></i>;
        };

        // --- Demo Presets ---
        const PRESETS = {
            SAAS: {
                inputs: {
                    rfr: 4.25, erp: 5.50, beta: 1.4, cod_pretax: 7.50, tax_rate: 21.0, tgr: 3.5,
                    shares: 100, price: 45.00, cash: 200,
                    debt_abl: 0, debt_1l: 300, debt_2l: 0, debt_unsec: 500, debt_sub: 0, debt_pref: 0,
                    distressed_ev_discount: 30.0
                },
                history: {
                    revenue: [450, 600, 850],
                    cogs: [112, 140, 190], // High gross margin (~78%)
                    sga: [300, 380, 500], // High SG&A
                    da: [20, 25, 30],
                    capex: [25, 30, 35], // Low Capex
                    nwc: [40, 50, 60]
                },
                drivers: {
                    growth: [20.0, 18.0, 15.0, 12.0, 10.0, 8.0, 6.0],
                    cogs_pct: [22.0, 21.0, 20.0, 20.0, 20.0, 20.0, 20.0],
                    sga_pct: [55.0, 50.0, 45.0, 40.0, 35.0, 30.0, 28.0],
                    da_pct: [3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5],
                    capex_pct: [4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0],
                    nwc_pct: [8.0, 8.0, 8.0, 8.0, 8.0, 8.0, 8.0]
                }
            },
            INDUSTRIAL: {
                inputs: {
                    rfr: 4.25, erp: 5.50, beta: 0.9, cod_pretax: 8.50, tax_rate: 21.0, tgr: 1.5,
                    shares: 100, price: 22.00, cash: 50,
                    debt_abl: 100, debt_1l: 800, debt_2l: 200, debt_unsec: 0, debt_sub: 0, debt_pref: 0,
                    distressed_ev_discount: 45.0
                },
                history: {
                    revenue: [1800, 1850, 1900],
                    cogs: [1200, 1250, 1300], // Low margin
                    sga: [200, 210, 220],
                    da: [100, 105, 110],
                    capex: [90, 95, 100],
                    nwc: [250, 260, 270]
                },
                drivers: {
                    growth: [2.5, 2.5, 2.0, 2.0, 1.5, 1.5, 1.5],
                    cogs_pct: [68.0, 68.0, 68.0, 68.0, 68.0, 68.0, 68.0],
                    sga_pct: [11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0],
                    da_pct: [5.8, 5.8, 5.8, 5.8, 5.8, 5.8, 5.8],
                    capex_pct: [5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5],
                    nwc_pct: [14.0, 14.0, 14.0, 14.0, 14.0, 14.0, 14.0]
                }
            }
        };

        // --- UI Components ---
        const Card = ({ children, className = "" }) => (
            <div className={`rounded-lg p-4 card ${className}`}>
                {children}
            </div>
        );

        const SectionHeader = ({ title, iconName, color = "text-cyan-400" }) => (
            <div className="flex items-center gap-2 mb-4 border-b border-slate-700/50 pb-2">
                {iconName && <Icon name={iconName} className={`w-4 h-4 ${color}`} />}
                <h3 className="text-xs font-bold text-slate-100 uppercase tracking-wider font-mono">{title}</h3>
            </div>
        );

        const Badge = ({ children, variant = "neutral" }) => {
            const styles = {
                neutral: "bg-slate-800 text-slate-400 border-slate-600",
                green: "bg-emerald-900/30 text-emerald-400 border-emerald-800",
                red: "bg-rose-900/30 text-rose-400 border-rose-800",
                blue: "bg-blue-900/30 text-blue-400 border-blue-800",
                yellow: "bg-amber-900/30 text-amber-400 border-amber-800",
                cyan: "bg-cyan-900/30 text-cyan-400 border-cyan-800",
            };
            return (
                <span className={`px-2 py-0.5 rounded text-[10px] font-bold border font-mono uppercase ${styles[variant]}`}>
                    {children}
                </span>
            );
        };

        const InputField = ({ label, value, onChange, step = "0.1", prefix = "", suffix = "" }) => (
            <div className="flex justify-between items-center group py-1">
                <label className="text-xs text-slate-400 group-hover:text-cyan-300 transition-colors cursor-default font-mono">{label}</label>
                <div className="flex items-center bg-slate-900/50 rounded px-2 border border-slate-700 hover:border-cyan-500 transition-colors w-28">
                    {prefix && <span className="text-xs text-slate-500 mr-1 select-none">{prefix}</span>}
                    <input
                        type="number"
                        step={step}
                        value={value}
                        onChange={(e) => onChange(parseFloat(e.target.value) || 0)}
                        className="w-full bg-transparent text-right text-xs text-slate-200 focus:outline-none py-1 font-mono"
                    />
                    {suffix && <span className="text-xs text-slate-500 ml-1 select-none w-3 text-right">{suffix}</span>}
                </div>
            </div>
        );

        // --- Main App Logic ---
        const CreditArchitect = () => {
            // 1. Initial State
            const [inputs, setInputs] = useState(PRESETS.SAAS.inputs);
            const [history, setHistory] = useState(PRESETS.SAAS.history);
            const [drivers, setDrivers] = useState(PRESETS.SAAS.drivers);

            // Scenario State Management
            const [activeScenario, setActiveScenario] = useState("BASE"); // BASE, BULL, BEAR, CRISIS
            const [flashMessage, setFlashMessage] = useState("");

            // 2. Calculation Engine
            const model = useMemo(() => {
                // Debt Stack Aggregation
                const total_debt = inputs.debt_abl + inputs.debt_1l + inputs.debt_2l + inputs.debt_unsec + inputs.debt_sub + inputs.debt_pref;
                const net_debt = total_debt - inputs.cash;

                // Market Cap & WACC
                const market_cap = inputs.shares * inputs.price;
                const total_cap = market_cap + total_debt;

                const cost_equity = inputs.rfr + (inputs.beta * inputs.erp);
                const cost_debt_after_tax = inputs.cod_pretax * (1 - (inputs.tax_rate/100));

                const weight_e = market_cap / total_cap;
                const weight_d = total_debt / total_cap;
                const wacc = (weight_e * cost_equity) + (weight_d * cost_debt_after_tax);

                // --- Projections Engine ---
                let proj_rev = [], proj_cogs = [], proj_gross_profit = [],
                    proj_sga = [], proj_ebitda = [], proj_da = [], proj_ebit = [],
                    proj_tax = [], proj_nopat = [], proj_capex = [],
                    proj_nwc = [], proj_nwc_chg = [], proj_fcf = [];

                let prev_rev = history.revenue[2];
                let prev_nwc = history.nwc[2];

                for (let i = 0; i < 7; i++) {
                    const rev = prev_rev * (1 + drivers.growth[i]/100);
                    const cogs = rev * (drivers.cogs_pct[i]/100);
                    const gp = rev - cogs;
                    const sga = rev * (drivers.sga_pct[i]/100);
                    const ebitda = gp - sga;
                    const da = rev * (drivers.da_pct[i]/100);
                    const ebit = ebitda - da;
                    const tax = Math.max(0, ebit * (inputs.tax_rate/100));
                    const nopat = ebit - tax;

                    const capex = rev * (drivers.capex_pct[i]/100);
                    const req_nwc = rev * (drivers.nwc_pct[i]/100);
                    const change_nwc = req_nwc - prev_nwc;

                    // Unlevered Free Cash Flow
                    const fcf = nopat + da - change_nwc - capex;

                    proj_rev.push(rev);
                    proj_cogs.push(cogs);
                    proj_gross_profit.push(gp);
                    proj_sga.push(sga);
                    proj_ebitda.push(ebitda);
                    proj_da.push(da);
                    proj_ebit.push(ebit);
                    proj_tax.push(tax);
                    proj_capex.push(capex);
                    proj_nwc.push(req_nwc);
                    proj_nwc_chg.push(change_nwc);
                    proj_fcf.push(fcf);

                    prev_rev = rev;
                    prev_nwc = req_nwc;
                }

                // --- DCF Valuation ---
                let pv_fcf = 0;
                proj_fcf.forEach((fcf, i) => {
                    pv_fcf += fcf / Math.pow(1 + wacc/100, i + 0.5); // Mid-year convention
                });

                const terminal_val = (proj_fcf[6] * (1 + inputs.tgr/100)) / ((wacc - inputs.tgr)/100);
                const pv_terminal = terminal_val / Math.pow(1 + wacc/100, 7);
                const enterprise_value = pv_fcf + pv_terminal;
                const equity_value = enterprise_value - total_debt + inputs.cash;
                const implied_price = equity_value / inputs.shares;
                const upside = (implied_price / inputs.price) - 1;

                // --- Credit Metrics ---
                // History EBITDA Construction
                const hist_ebitda = history.revenue.map((r, i) => r - history.cogs[i] - history.sga[i]);
                const ltm_ebitda = hist_ebitda[2];
                const ltm_capex = history.capex[2];

                const leverage = total_debt / ltm_ebitda;
                const net_leverage = net_debt / ltm_ebitda;
                const interest_expense = total_debt * (inputs.cod_pretax/100);

                // Fixed Charge Coverage Ratio (EBITDA - Capex) / Interest
                const fccr = interest_expense > 0 ? (ltm_ebitda - ltm_capex) / interest_expense : 99;

                // Interest Coverage (EBITDA / Interest)
                const icr = interest_expense > 0 ? ltm_ebitda / interest_expense : 99;

                // Repayment Capacity (Waterfall Cumulative FCF)
                let cum_fcf = 0;
                let years_to_repay = 7.1; // >7 flag
                for(let i=0; i<7; i++) {
                    cum_fcf += proj_fcf[i];
                    if(cum_fcf >= total_debt) {
                        // Linear interpolation for fractional year
                        const prev_cum = cum_fcf - proj_fcf[i];
                        const needed = total_debt - prev_cum;
                        years_to_repay = i + (needed / proj_fcf[i]);
                        break;
                    }
                }
                const repayment_coverage = total_debt > 0 ? cum_fcf / total_debt : 100;

                // --- LGD Waterfall (Loss Given Default) ---
                // Simulating a distress scenario where EV is impaired
                const distress_ev = enterprise_value * (1 - inputs.distressed_ev_discount/100);
                let remaining_ev = distress_ev;

                const rec_abl = Math.min(inputs.debt_abl, remaining_ev);
                remaining_ev = Math.max(0, remaining_ev - inputs.debt_abl);

                const rec_1l = Math.min(inputs.debt_1l, remaining_ev);
                remaining_ev = Math.max(0, remaining_ev - inputs.debt_1l);

                const rec_2l = Math.min(inputs.debt_2l, remaining_ev);
                remaining_ev = Math.max(0, remaining_ev - inputs.debt_2l);

                const rec_unsec = Math.min(inputs.debt_unsec, remaining_ev);
                remaining_ev = Math.max(0, remaining_ev - inputs.debt_unsec);

                const rec_sub = Math.min(inputs.debt_sub, remaining_ev);

                const total_recovery = rec_abl + rec_1l + rec_2l + rec_unsec + rec_sub;
                const recovery_rate = total_debt > 0 ? total_recovery / total_debt : 1;
                const lgd = 1 - recovery_rate;

                // --- Regulatory & Rating Simulation (SNC Rating Agent Logic) ---
                let snc_rating = "Pass";
                let snc_def = "Ability to Repay is sound. Leverage < 4x, Coverage > 3x.";

                // Logic based on core/agents/specialized/snc_rating_agent.py
                if (leverage < 4.0 && icr > 3.0) {
                    snc_rating = "Pass";
                    snc_def = "Sound worth and paying capacity. (Lev < 4.0x, Cov > 3.0x)";
                } else if (leverage < 6.0 && icr > 1.5) {
                    snc_rating = "Special Mention";
                    snc_def = "Potential weakness deserving management attention. (Lev 4-6x, Cov 1.5-3x)";
                } else if (leverage < 8.0 || icr < 1.0) {
                    snc_rating = "Substandard";
                    snc_def = "Well-defined weakness. Payment jeopardy. (Lev < 8x or Cov < 1.0x)";
                } else {
                    snc_rating = "Doubtful";
                    snc_def = "Collection highly improbable. (Lev > 8x)";
                }

                // Covenant Headroom Estimation
                let implied_covenant = 0;
                if (snc_rating === "Pass") implied_covenant = leverage * 1.35;
                else if (snc_rating === "Special Mention") implied_covenant = leverage * 1.15;
                else implied_covenant = leverage * 0.95;

                const headroom_pct = implied_covenant > 0 ? (implied_covenant - leverage) / implied_covenant : 0;
                const covenant_status = headroom_pct < 0 ? `POTENTIAL BREACH (${(headroom_pct*100).toFixed(1)}%)` : `${(headroom_pct*100).toFixed(1)}% Cushion`;

                // Probability of Default (PD) Mapping
                let pd = 0.05; // Default AA
                let implied_rating = "AA";

                if(leverage > 7) { pd = 25.0; implied_rating="CCC"; }
                else if(leverage > 5.5) { pd = 12.0; implied_rating="B-"; }
                else if(leverage > 4.5) { pd = 6.0; implied_rating="B"; }
                else if(leverage > 3.5) { pd = 3.0; implied_rating="BB-"; }
                else if(leverage > 2.5) { pd = 1.0; implied_rating="BB"; }
                else if(leverage > 1.5) { pd = 0.4; implied_rating="BBB"; }

                const asset_coverage = enterprise_value / total_debt;

                return {
                    wacc, total_debt, net_debt, market_cap,
                    hist_ebitda,
                    proj_rev, proj_cogs, proj_sga, proj_ebitda, proj_da, proj_ebit, proj_tax, proj_fcf,
                    enterprise_value, equity_value, implied_price, upside,
                    leverage, net_leverage, fccr, icr, years_to_repay, repayment_coverage,
                    snc_rating, snc_def, implied_rating, pd, lgd, recovery_rate,
                    distress_ev, covenant_status,
                    waterfall: { rec_abl, rec_1l, rec_2l, rec_unsec, rec_sub },
                    asset_coverage
                };
            }, [inputs, history, drivers]);

            // --- Handlers ---
            const updateInput = (key, val) => setInputs(p => ({...p, [key]: val}));
            const updateDriver = (key, idx, val) => {
                const newArr = [...drivers[key]];
                newArr[idx] = val;
                setDrivers(p => ({...p, [key]: newArr}));
            };
            const updateHistory = (key, idx, val) => {
                const newArr = [...history[key]];
                newArr[idx] = val;
                setHistory(p => ({...p, [key]: newArr}));
            };

            const loadPreset = (type) => {
                const preset = PRESETS[type];
                setInputs(preset.inputs);
                setHistory(preset.history);
                setDrivers(preset.drivers);
                setActiveScenario("BASE");
                setFlashMessage(`Loaded ${type} Profile`);
                setTimeout(() => setFlashMessage(""), 2000);
            };

            const simulateCrisis = () => {
                const shockDrivers = {
                    ...drivers,
                    growth: [-5.0, -2.0, 1.0, 2.0, 2.0, 2.0, 2.0], // Shock
                    cogs_pct: drivers.cogs_pct.map(v => v + 3.0), // Margin compression
                    sga_pct: drivers.sga_pct.map(v => v + 1.0) // Operating leverage hit
                };
                setDrivers(shockDrivers);
                setInputs(p => ({...p, cod_pretax: p.cod_pretax + 2.0})); // Repricing risk
                setActiveScenario("CRISIS");
                setFlashMessage("Simulating Macro Shock Scenario...");
                setTimeout(() => setFlashMessage(""), 3000);
            };

            const exportData = () => {
                // Construct V23 Knowledge Graph Object
                const v23Graph = {
                    v23_knowledge_graph: {
                        meta: {
                            target: "Client_Workstation_Export",
                            generated_at: new Date().toISOString(),
                            model_version: "Adam-v23.5-Apex-Architect"
                        },
                        nodes: {
                            credit_analysis: {
                                snc_rating_model: {
                                    overall_borrower_rating: model.snc_rating,
                                    rationale: model.snc_def,
                                    primary_facility_assessment: {
                                        facility_type: "Composite Debt Stack",
                                        collateral_coverage: model.asset_coverage > 1.5 ? "Strong" : model.asset_coverage > 1.0 ? "Adequate" : "Weak",
                                        repayment_capacity: model.repayment_coverage > 1.0 ? "High" : "Low"
                                    }
                                },
                                covenant_risk_analysis: {
                                    primary_constraint: "Leverage Ratio",
                                    current_level: model.leverage,
                                    headroom_assessment: model.covenant_status
                                }
                            },
                            equity_analysis: {
                                valuation_engine: {
                                    dcf_model: {
                                        wacc_assumption: model.wacc.toFixed(2) + "%",
                                        terminal_growth: inputs.tgr + "%",
                                        intrinsic_value_estimate: model.implied_price
                                    }
                                }
                            }
                        }
                    }
                };

                const blob = new Blob([JSON.stringify(v23Graph, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `ADAM_Export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                setFlashMessage("Exported to V23 Graph JSON");
                setTimeout(() => setFlashMessage(""), 2000);
            };

            useEffect(() => {
                lucide.createIcons();
            }, [activeScenario]);

            return (
                <div className="min-h-screen pb-20 text-slate-200 font-sans">
                    {/* Navigation */}
                    <nav className="card !rounded-none !border-x-0 !border-t-0 sticky top-0 z-50 px-6 py-3 flex justify-between items-center shadow-2xl shadow-cyan-900/10 no-print">
                        <div className="flex items-center gap-3">
                            <div className="bg-cyan-900/20 border border-cyan-500/30 p-1.5 rounded-lg shadow-[0_0_15px_rgba(6,182,212,0.3)]">
                                <Icon name="activity" className="text-cyan-400 w-5 h-5" />
                            </div>
                            <div>
                                <h1 className="text-sm font-bold text-slate-100 tracking-wide font-mono">ADAM v24.0 <span className="text-cyan-400">CREDIT ARCHITECT</span></h1>
                                <div className="text-[10px] text-slate-500 font-mono tracking-[0.2em]">AUTONOMOUS ANALYST WORKSTATION</div>
                            </div>
                        </div>
                        <div className="flex gap-3">
                            {flashMessage && (
                                <div className="flex items-center text-xs text-cyan-400 animate-pulse font-mono mr-4">
                                    <Icon name="zap" className="w-3 h-3 mr-1" /> {flashMessage}
                                </div>
                            )}
                            <button onClick={() => loadPreset("SAAS")} className="flex items-center gap-2 px-3 py-1.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 rounded border border-slate-700 transition-colors font-mono uppercase">
                                <Icon name="brain" className="w-3 h-3" /> SaaS Mode
                            </button>
                            <button onClick={() => loadPreset("INDUSTRIAL")} className="flex items-center gap-2 px-3 py-1.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 rounded border border-slate-700 transition-colors font-mono uppercase">
                                <Icon name="factory" className="w-3 h-3" /> Industrial Mode
                            </button>
                            <button onClick={simulateCrisis} className="flex items-center gap-2 px-3 py-1.5 text-xs bg-rose-900/20 hover:bg-rose-900/40 text-rose-400 rounded border border-rose-800 transition-colors font-mono uppercase">
                                <Icon name="alert-triangle" className="w-3 h-3" /> Stress Test
                            </button>
                            <button onClick={exportData} className="flex items-center gap-2 px-3 py-1.5 text-xs bg-cyan-900/20 hover:bg-cyan-900/40 text-cyan-400 rounded border border-cyan-800 transition-colors font-mono uppercase">
                                <Icon name="download" className="w-3 h-3" /> Export V23 JSON
                            </button>
                        </div>
                    </nav>

                    <div className="max-w-[1800px] mx-auto p-4 lg:p-6 grid grid-cols-12 gap-6">

                        {/* LEFT COLUMN: Inputs */}
                        <div className="col-span-12 lg:col-span-3 space-y-4 no-print">
                            <Card className={activeScenario === 'CRISIS' ? 'border-rose-500/50 shadow-[0_0_10px_rgba(244,63,94,0.2)]' : ''}>
                                <SectionHeader title="Capital Structure" iconName="pie-chart" />
                                <div className="space-y-1 mb-4">
                                    <InputField label="Share Price" value={inputs.price} onChange={v => updateInput('price', v)} prefix="$" />
                                    <InputField label="Shares Out (M)" value={inputs.shares} onChange={v => updateInput('shares', v)} />
                                    <InputField label="Cash ($M)" value={inputs.cash} onChange={v => updateInput('cash', v)} />
                                </div>
                                <div className="my-2 border-t border-slate-700/50"></div>
                                <h4 className="text-[10px] font-bold text-slate-500 uppercase mb-2 font-mono">Debt Waterfall ($M)</h4>
                                <div className="space-y-1">
                                    <InputField label="ABL / Revolver" value={inputs.debt_abl} onChange={v => updateInput('debt_abl', v)} />
                                    <InputField label="1st Lien Term" value={inputs.debt_1l} onChange={v => updateInput('debt_1l', v)} />
                                    <InputField label="2nd Lien" value={inputs.debt_2l} onChange={v => updateInput('debt_2l', v)} />
                                    <InputField label="Unsecured" value={inputs.debt_unsec} onChange={v => updateInput('debt_unsec', v)} />
                                    <InputField label="Subordinated" value={inputs.debt_sub} onChange={v => updateInput('debt_sub', v)} />
                                    <InputField label="Pref. Equity" value={inputs.debt_pref} onChange={v => updateInput('debt_pref', v)} />
                                </div>
                                <div className="mt-4 bg-slate-950/50 p-3 rounded border border-slate-700/50">
                                    <div className="flex justify-between text-xs mb-1">
                                        <span className="text-slate-400 font-mono">Total Debt</span>
                                        <span className="font-mono text-slate-200 font-bold">${model.total_debt.toFixed(1)}M</span>
                                    </div>
                                    <div className="flex justify-between text-xs">
                                        <span className="text-slate-400 font-mono">Net Debt</span>
                                        <span className="font-mono text-slate-200 font-bold">${model.net_debt.toFixed(1)}M</span>
                                    </div>
                                </div>
                            </Card>

                            <Card>
                                <SectionHeader title="WACC Assumptions" iconName="settings" />
                                <div className="space-y-1">
                                    <InputField label="Risk Free Rate" value={inputs.rfr} onChange={v => updateInput('rfr', v)} suffix="%" />
                                    <InputField label="Equity Risk Prem" value={inputs.erp} onChange={v => updateInput('erp', v)} suffix="%" />
                                    <InputField label="Beta" value={inputs.beta} onChange={v => updateInput('beta', v)} step="0.05" />
                                    <InputField label="Pre-Tax Cost Debt" value={inputs.cod_pretax} onChange={v => updateInput('cod_pretax', v)} suffix="%" />
                                    <InputField label="Tax Rate" value={inputs.tax_rate} onChange={v => updateInput('tax_rate', v)} suffix="%" />
                                    <div className="mt-3 flex justify-between items-center pt-2 border-t border-slate-700/50">
                                        <span className="text-xs font-bold text-slate-400 font-mono">WACC</span>
                                        <span className="text-sm font-mono font-bold text-emerald-400">{model.wacc.toFixed(2)}%</span>
                                    </div>
                                </div>
                            </Card>

                             <Card>
                                <SectionHeader title="Valuation" iconName="calculator" />
                                <InputField label="Terminal Growth" value={inputs.tgr} onChange={v => updateInput('tgr', v)} suffix="%" />
                                <div className="my-2 border-t border-slate-700/50"></div>
                                <h4 className="text-[10px] font-bold text-slate-500 uppercase mb-2 font-mono">LGD Stress Test</h4>
                                <InputField label="Distressed EV Disc." value={inputs.distressed_ev_discount} onChange={v => updateInput('distressed_ev_discount', v)} suffix="%" />
                            </Card>
                        </div>

                        {/* RIGHT COLUMN: Outputs & Model */}
                        <div className="col-span-12 lg:col-span-9 space-y-6">

                            {/* Executive Summary Stats */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <Card className="bg-gradient-to-br from-slate-900 to-slate-800/50 border-cyan-900/30">
                                    <div className="text-[10px] text-cyan-500 uppercase tracking-wider font-bold mb-1 font-mono">Implied Share Price</div>
                                    <div className="flex items-baseline gap-2">
                                        <span className={`text-2xl font-mono font-bold ${model.upside > 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                                            ${model.implied_price.toFixed(2)}
                                        </span>
                                        <span className={`text-xs font-bold ${model.upside > 0 ? 'text-emerald-500' : 'text-rose-500'}`}>
                                            {model.upside > 0 ? '+' : ''}{(model.upside * 100).toFixed(1)}%
                                        </span>
                                    </div>
                                    <div className="text-[10px] text-slate-500 mt-2 font-mono">TEV: ${model.enterprise_value.toFixed(0)}M</div>
                                </Card>

                                <Card>
                                    <div className="text-[10px] text-slate-400 uppercase tracking-wider font-bold mb-1 font-mono">SNC Regulatory Rating</div>
                                    <div className="flex flex-col">
                                        <span className={`text-xl font-bold font-mono ${
                                            model.snc_rating === 'Pass' ? 'text-emerald-400' :
                                            model.snc_rating === 'Special Mention' ? 'text-amber-400' : 'text-rose-500'
                                        }`}>
                                            {model.snc_rating}
                                        </span>
                                        <span className="text-[10px] text-slate-500 leading-tight mt-1 truncate font-mono">{model.snc_def}</span>
                                    </div>
                                </Card>

                                <Card>
                                    <div className="text-[10px] text-slate-400 uppercase tracking-wider font-bold mb-1 font-mono">Credit Profile</div>
                                    <div className="flex items-baseline gap-3">
                                        <div>
                                            <div className="text-[10px] text-slate-500 font-mono">Rating</div>
                                            <div className="text-xl font-mono font-bold text-slate-200">{model.implied_rating}</div>
                                        </div>
                                        <div>
                                            <div className="text-[10px] text-slate-500 font-mono">PD</div>
                                            <div className={`text-xl font-mono font-bold ${model.pd > 5 ? 'text-rose-400' : 'text-slate-200'}`}>{model.pd.toFixed(1)}%</div>
                                        </div>
                                    </div>
                                    <div className="w-full bg-slate-800 h-1 rounded-full mt-2 overflow-hidden">
                                        <div className={`h-full ${model.pd < 2 ? 'bg-emerald-500' : model.pd < 5 ? 'bg-amber-500' : 'bg-rose-500'}`} style={{width: `${Math.min(model.pd * 5, 100)}%`}}></div>
                                    </div>
                                </Card>

                                <Card>
                                    <div className="text-[10px] text-slate-400 uppercase tracking-wider font-bold mb-1 font-mono">Recovery (1 - LGD)</div>
                                    <div className="flex items-baseline gap-2">
                                        <span className="text-2xl font-mono font-bold text-cyan-400">{(model.recovery_rate * 100).toFixed(1)}%</span>
                                        <span className="text-[10px] text-slate-500 font-mono">Blended</span>
                                    </div>
                                    <div className="text-[10px] text-slate-500 mt-1 font-mono">Distressed EV: <span className="text-slate-300">${model.distress_ev.toFixed(0)}M</span></div>
                                </Card>
                            </div>

                            {/* Main Model Grid */}
                            <Card className="overflow-hidden border-t-2 border-t-cyan-500/50">
                                <SectionHeader title="Financial Model: History & Projections" iconName="file-text" />
                                <div className="overflow-x-auto">
                                    <table className="w-full text-right text-xs font-mono border-collapse">
                                        <thead>
                                            <tr className="bg-slate-900/50 text-slate-400">
                                                <th className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 min-w-[140px] z-10">Fiscal Year ($M)</th>
                                                {['FY-2', 'FY-1', 'LTM'].map(y => <th key={y} className="p-2 border-b border-slate-800 text-slate-500">{y}</th>)}
                                                {Array.from({length:7}).map((_,i) => <th key={i} className="p-2 text-cyan-400 border-b border-slate-800">FY+{i+1}</th>)}
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-800/50">
                                            {/* Revenue */}
                                            <tr className="bg-slate-900/30">
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 font-bold text-slate-300">Revenue</td>
                                                {history.revenue.map((v,i) => <td key={i} className="p-2 text-slate-400">
                                                    <input className="w-full bg-transparent text-right focus:outline-none focus:text-cyan-400 border-b border-slate-800 focus:border-cyan-500" value={v} onChange={e => updateHistory('revenue', i, parseFloat(e.target.value))} />
                                                </td>)}
                                                {model.proj_rev.map((v,i) => <td key={i} className="p-2 text-slate-200 font-bold">{v.toFixed(0)}</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-cyan-500/70 italic text-[10px]">Growth % (Driver)</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600 text-[10px]">-</td>
                                                {drivers.growth.map((v,i) => (
                                                    <td key={i} className="p-1">
                                                        <input type="number" step="0.1" value={v} onChange={(e) => updateDriver('growth', i, parseFloat(e.target.value))}
                                                            className="w-full driver-input p-1 focus:outline-none" />
                                                    </td>
                                                ))}
                                            </tr>

                                            {/* COGS & Gross Profit */}
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-slate-400">(-) COGS</td>
                                                {history.cogs.map((v,i) => <td key={i} className="p-2 text-slate-500">
                                                    <input className="w-full bg-transparent text-right focus:outline-none focus:text-cyan-400 border-b border-slate-800 focus:border-cyan-500" value={v} onChange={e => updateHistory('cogs', i, parseFloat(e.target.value))} />
                                                </td>)}
                                                {model.proj_cogs.map((v,i) => <td key={i} className="p-2 text-slate-500">({v.toFixed(0)})</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-cyan-500/70 italic text-[10px]">COGS % of Rev (Driver)</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600 text-[10px]">-</td>
                                                {drivers.cogs_pct.map((v,i) => (
                                                    <td key={i} className="p-1">
                                                        <input type="number" step="0.1" value={v} onChange={(e) => updateDriver('cogs_pct', i, parseFloat(e.target.value))}
                                                            className="w-full driver-input p-1 focus:outline-none" />
                                                    </td>
                                                ))}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-slate-400 font-bold">Gross Profit</td>
                                                {history.revenue.map((r,i) => <td key={i} className="p-2 text-slate-300 font-bold">{(r - history.cogs[i]).toFixed(0)}</td>)}
                                                {model.proj_gross_profit.map((v,i) => <td key={i} className="p-2 text-slate-300 font-bold">{v.toFixed(0)}</td>)}
                                            </tr>

                                            {/* SG&A */}
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-slate-400">(-) SG&A</td>
                                                {history.sga.map((v,i) => <td key={i} className="p-2 text-slate-500">
                                                    <input className="w-full bg-transparent text-right focus:outline-none focus:text-cyan-400 border-b border-slate-800 focus:border-cyan-500" value={v} onChange={e => updateHistory('sga', i, parseFloat(e.target.value))} />
                                                </td>)}
                                                {model.proj_sga.map((v,i) => <td key={i} className="p-2 text-slate-500">({v.toFixed(0)})</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-cyan-500/70 italic text-[10px]">SG&A % of Rev (Driver)</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600 text-[10px]">-</td>
                                                {drivers.sga_pct.map((v,i) => (
                                                    <td key={i} className="p-1">
                                                        <input type="number" step="0.1" value={v} onChange={(e) => updateDriver('sga_pct', i, parseFloat(e.target.value))}
                                                            className="w-full driver-input p-1 focus:outline-none" />
                                                    </td>
                                                ))}
                                            </tr>

                                            {/* EBITDA */}
                                            <tr className="bg-slate-900/30">
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 font-bold text-emerald-400">EBITDA</td>
                                                {model.hist_ebitda.map((v,i) => <td key={i} className="p-2 text-slate-400 font-bold">{v.toFixed(0)}</td>)}
                                                {model.proj_ebitda.map((v,i) => <td key={i} className="p-2 text-slate-200 font-bold">{v.toFixed(0)}</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-cyan-500/70 italic text-[10px]">Margin %</td>
                                                {model.hist_ebitda.map((v,i) => <td key={i} className="p-2 text-slate-600 text-[10px]">{(v/history.revenue[i]*100).toFixed(1)}%</td>)}
                                                {model.proj_ebitda.map((v,i) => <td key={i} className="p-2 text-cyan-700 text-[10px]">{(v/model.proj_rev[i]*100).toFixed(1)}%</td>)}
                                            </tr>

                                            {/* D&A */}
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-slate-400">(-) D&A</td>
                                                {history.da.map((v,i) => <td key={i} className="p-2 text-slate-500">
                                                    <input className="w-full bg-transparent text-right focus:outline-none focus:text-cyan-400 border-b border-slate-800 focus:border-cyan-500" value={v} onChange={e => updateHistory('da', i, parseFloat(e.target.value))} />
                                                </td>)}
                                                {model.proj_da.map((v,i) => <td key={i} className="p-2 text-slate-500">({v.toFixed(0)})</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-cyan-500/70 italic text-[10px]">D&A % of Rev (Driver)</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600 text-[10px]">-</td>
                                                {drivers.da_pct.map((v,i) => (
                                                    <td key={i} className="p-1">
                                                        <input type="number" step="0.1" value={v} onChange={(e) => updateDriver('da_pct', i, parseFloat(e.target.value))}
                                                            className="w-full driver-input p-1 focus:outline-none" />
                                                    </td>
                                                ))}
                                            </tr>

                                            {/* EBIT & Tax */}
                                            <tr className="bg-slate-900/30">
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 font-bold text-slate-300">EBIT</td>
                                                {history.revenue.map((r,i) => <td key={i} className="p-2 text-slate-400">{(model.hist_ebitda[i] - history.da[i]).toFixed(0)}</td>)}
                                                {model.proj_ebit.map((v,i) => <td key={i} className="p-2 text-slate-200">{v.toFixed(0)}</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-slate-400">(-) Tax</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600">-</td>
                                                {model.proj_tax.map((v,i) => <td key={i} className="p-2 text-slate-500">({v.toFixed(0)})</td>)}
                                            </tr>

                                            {/* FCF Items */}
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-slate-400">(-) Capex</td>
                                                {history.capex.map((v,i) => <td key={i} className="p-2 text-slate-500">
                                                    <input className="w-full bg-transparent text-right focus:outline-none focus:text-cyan-400 border-b border-slate-800 focus:border-cyan-500" value={v} onChange={e => updateHistory('capex', i, parseFloat(e.target.value))} />
                                                </td>)}
                                                {model.proj_capex.map((v,i) => <td key={i} className="p-2 text-slate-500">({v.toFixed(0)})</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-cyan-500/70 italic text-[10px]">Capex % of Rev (Driver)</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600 text-[10px]">-</td>
                                                {drivers.capex_pct.map((v,i) => (
                                                    <td key={i} className="p-1">
                                                        <input type="number" step="0.1" value={v} onChange={(e) => updateDriver('capex_pct', i, parseFloat(e.target.value))}
                                                            className="w-full driver-input p-1 focus:outline-none" />
                                                    </td>
                                                ))}
                                            </tr>

                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-slate-400">(-) NWC Change</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600">-</td>
                                                {model.proj_nwc_chg.map((v,i) => <td key={i} className="p-2 text-slate-500">({v.toFixed(0)})</td>)}
                                            </tr>
                                            <tr>
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 text-cyan-500/70 italic text-[10px]">NWC % of Rev (Driver)</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600 text-[10px]">-</td>
                                                {drivers.nwc_pct.map((v,i) => (
                                                    <td key={i} className="p-1">
                                                        <input type="number" step="0.1" value={v} onChange={(e) => updateDriver('nwc_pct', i, parseFloat(e.target.value))}
                                                            className="w-full driver-input p-1 focus:outline-none" />
                                                    </td>
                                                ))}
                                            </tr>

                                            <tr className="border-t-2 border-slate-700 bg-emerald-900/10">
                                                <td className="p-2 text-left sticky left-0 bg-slate-900 border-r border-slate-800 font-bold text-emerald-400">Unlevered FCF</td>
                                                <td colSpan="3" className="p-2 text-center text-slate-600">-</td>
                                                {model.proj_fcf.map((v,i) => <td key={i} className="p-2 font-bold text-emerald-400">{v.toFixed(0)}</td>)}
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </Card>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                {/* Credit Deep Dive */}
                                <Card>
                                    <SectionHeader title="Deep Dive Credit Analysis" iconName="shield-alert" />
                                    <div className="space-y-4 text-xs font-mono">
                                        <div className="flex justify-between items-center border-b border-slate-700/50 pb-2">
                                            <span className="text-slate-400">LTM Gross Leverage</span>
                                            <span className={`font-bold ${model.leverage > 4 ? 'text-rose-400' : 'text-slate-200'}`}>{model.leverage.toFixed(2)}x</span>
                                        </div>
                                         <div className="flex justify-between items-center border-b border-slate-700/50 pb-2">
                                            <span className="text-slate-400">LTM Net Leverage</span>
                                            <span className="font-bold text-cyan-400">{model.net_leverage.toFixed(2)}x</span>
                                        </div>
                                        <div className="flex justify-between items-center border-b border-slate-700/50 pb-2">
                                            <span className="text-slate-400">Fixed Charge Coverage (FCCR)</span>
                                            <span className={`font-bold ${model.fccr < 1.1 ? 'text-rose-400' : model.fccr < 1.5 ? 'text-amber-400' : 'text-emerald-400'}`}>{model.fccr.toFixed(2)}x</span>
                                        </div>
                                        <div className="flex justify-between items-center border-b border-slate-700/50 pb-2">
                                            <span className="text-slate-400">Interest Coverage (ICR)</span>
                                            <span className={`font-bold ${model.icr < 2.0 ? 'text-rose-400' : model.icr < 3.0 ? 'text-amber-400' : 'text-emerald-400'}`}>{model.icr.toFixed(2)}x</span>
                                        </div>

                                        <div className="mt-4 pt-2">
                                            <h4 className="text-[10px] font-bold text-slate-500 uppercase mb-2">Covenant Headroom (Est.)</h4>
                                            <div className="flex justify-between items-center">
                                                <span className="text-slate-400">Implied Maintenance Status</span>
                                                <Badge variant={model.covenant_status.includes('BREACH') ? 'red' : 'green'}>{model.covenant_status}</Badge>
                                            </div>
                                        </div>

                                        <div className="mt-4">
                                            <h4 className="text-[10px] font-bold text-slate-500 uppercase mb-2">LGD Waterfall (Distressed EV: ${model.distress_ev.toFixed(0)}M)</h4>
                                            <div className="space-y-2">
                                                {[
                                                    {name: 'ABL', debt: inputs.debt_abl, rec: model.waterfall.rec_abl},
                                                    {name: '1st Lien', debt: inputs.debt_1l, rec: model.waterfall.rec_1l},
                                                    {name: '2nd Lien', debt: inputs.debt_2l, rec: model.waterfall.rec_2l},
                                                    {name: 'Unsecured', debt: inputs.debt_unsec, rec: model.waterfall.rec_unsec}
                                                ].map((tranche, i) => (
                                                    <div key={i} className="flex items-center gap-2">
                                                        <div className="w-16 text-[10px] text-slate-400">{tranche.name}</div>
                                                        <div className="flex-1 h-3 bg-slate-800 rounded-sm overflow-hidden relative">
                                                            {tranche.debt > 0 && (
                                                                <div
                                                                    className={`h-full ${tranche.rec === tranche.debt ? 'bg-emerald-600' : tranche.rec > 0 ? 'bg-amber-500' : 'bg-rose-900'}`}
                                                                    style={{width: `${(tranche.rec / tranche.debt) * 100}%`}}
                                                                ></div>
                                                            )}
                                                        </div>
                                                        <div className="w-10 text-[10px] text-right text-slate-300">
                                                            {tranche.debt > 0 ? ((tranche.rec / tranche.debt) * 100).toFixed(0) + '%' : '-'}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </Card>

                                {/* AI Insights Panel */}
                                <Card className="border-cyan-500/20 bg-cyan-900/5 relative overflow-hidden">
                                    <div className="scan-line absolute inset-0 opacity-10"></div>
                                    <SectionHeader title="ADAM v24.0 | Auto-Analysis" iconName="brain" color="text-cyan-400" />
                                    <div className="space-y-3 text-xs font-mono">
                                        <div className="p-3 bg-slate-900/80 rounded border-l-2 border-cyan-500 shadow-lg">
                                            <div className="text-[10px] text-cyan-500 font-bold mb-1 uppercase flex items-center gap-1">
                                                <Icon name="terminal" className="w-3 h-3" /> System Log
                                            </div>
                                            <p className="text-slate-300 leading-relaxed">
                                                <span className="text-cyan-400">Analysis Complete.</span> Target exhibits <span className="text-white font-bold">{model.leverage.toFixed(1)}x</span> leverage.
                                                SNC classification projected as <span className={`${model.snc_rating === 'Pass' ? 'text-emerald-400' : 'text-rose-400'}`}>{model.snc_rating}</span> due to {model.icr > 1.5 ? 'adequate' : 'weak'} coverage ratios.
                                            </p>
                                        </div>

                                        <div className="p-3 bg-slate-900/80 rounded border-l-2 border-amber-500 shadow-lg">
                                            <div className="text-[10px] text-amber-500 font-bold mb-1 uppercase flex items-center gap-1">
                                                <Icon name="alert-triangle" className="w-3 h-3" /> Risk Flag
                                            </div>
                                            <p className="text-slate-300 leading-relaxed">
                                                {model.repayment_coverage < 0.5
                                                    ? "Critical repayment risk detected. Cumulative FCF covers <50% of debt load."
                                                    : model.leverage > 6.0
                                                        ? "Highly levered capital structure. Monitor for covenant breach."
                                                        : "Capital structure appears stable under base case assumptions."}
                                            </p>
                                        </div>

                                        <div className="p-3 bg-slate-900/80 rounded border-l-2 border-emerald-500 shadow-lg">
                                            <div className="text-[10px] text-emerald-500 font-bold mb-1 uppercase flex items-center gap-1">
                                                <Icon name="briefcase" className="w-3 h-3" /> Strategic Verdict
                                            </div>
                                            <p className="text-slate-300 leading-relaxed">
                                                Recommendation: <span className="text-white font-bold">{
                                                    model.upside > 0.25 && model.snc_rating === "Pass" ? "STRONG BUY" :
                                                    model.upside > 0.10 && model.snc_rating === "Pass" ? "BUY" :
                                                    model.snc_rating === "Substandard" ? "SELL (Credit Risk)" : "HOLD"
                                                }</span>.
                                                DCF implies <span className="text-white font-bold">${model.implied_price.toFixed(2)}</span> / share
                                                ({model.upside > 0 ? '+' : ''}{(model.upside*100).toFixed(1)}% vs spot).
                                            </p>
                                        </div>
                                    </div>
                                </Card>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CreditArchitect />);
    </script>
</body>
</html>
