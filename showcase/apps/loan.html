<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | Loan Amortizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-dark: #020408;
            --panel-glass: rgba(10, 15, 30, 0.7);
            --yellow-glow: #eab308;
            --grid-line: rgba(234, 179, 8, 0.05);
        }

        body {
            background-color: var(--bg-dark);
            color: #e2e8f0;
            font-family: 'Courier New', Courier, monospace;
            background-image:
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 30px 30px;
            overflow: hidden;
        }

        .glass-panel {
            background: var(--panel-glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(234, 179, 8, 0.1);
        }

        input[type="number"] {
            background: #050a14;
            border: 1px solid #1e293b;
            color: var(--yellow-glow);
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            font-size: 0.75rem;
            padding: 4px;
            width: 100%;
        }
        input:focus {
            border-color: var(--yellow-glow);
            box-shadow: 0 0 8px rgba(234, 179, 8, 0.3);
            outline: none;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--yellow-glow); }

        table { border-collapse: collapse; width: 100%; }
        th { text-align: right; color: #64748b; padding: 4px; border-bottom: 1px solid #1e293b; position: sticky; top: 0; background: #020408; }
        td { text-align: right; padding: 4px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body class="h-screen flex flex-col p-4 text-xs">

    <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-2">
        <h1 class="text-lg font-bold text-white tracking-widest flex items-center">
            <i data-lucide="banknote" class="w-5 h-5 mr-2 text-yellow-400"></i>
            LOAN AMORTIZER
        </h1>
        <div class="flex gap-2">
            <button onclick="exportCSV()" class="px-3 py-1 bg-yellow-900/20 border border-yellow-500/30 text-yellow-400 rounded hover:bg-yellow-500/30 text-[10px] font-bold flex items-center gap-1">
                <i data-lucide="download" class="w-3 h-3"></i> EXPORT CSV
            </button>
            <div class="text-[10px] text-gray-500 self-center">LOCAL_MODE</div>
        </div>
    </div>

    <div class="grid grid-cols-12 gap-4 flex-grow overflow-hidden">

        <!-- Sidebar -->
        <aside class="col-span-4 lg:col-span-3 flex flex-col gap-3">
            <div class="glass-panel p-3 rounded">
                <div class="text-[10px] text-gray-500 mb-2 uppercase font-bold">Loan Terms</div>
                <div class="space-y-2">
                    <div><label class="block text-gray-400 text-[10px]">Principal Amount</label><input type="number" id="principal" value="1000000"></div>
                    <div><label class="block text-gray-400 text-[10px]">Annual Interest Rate %</label><input type="number" id="rate" value="5.0" step="0.1"></div>
                    <div><label class="block text-gray-400 text-[10px]">Term (Years)</label><input type="number" id="years" value="10"></div>
                    <div><label class="block text-gray-400 text-[10px]">Extra Monthly Pmt</label><input type="number" id="extra" value="0"></div>
                </div>
            </div>

             <div class="glass-panel p-3 rounded flex-grow">
                 <div class="text-[10px] text-gray-500 mb-2 uppercase font-bold">Summary</div>
                 <div class="space-y-2">
                     <div class="flex justify-between border-b border-gray-800 pb-1">
                         <span class="text-gray-400">Monthly Pmt</span>
                         <span class="text-white font-bold font-mono" id="val-pmt">-</span>
                     </div>
                     <div class="flex justify-between border-b border-gray-800 pb-1">
                         <span class="text-gray-400">Total Interest</span>
                         <span class="text-yellow-400 font-bold font-mono" id="val-int">-</span>
                     </div>
                      <div class="flex justify-between border-b border-gray-800 pb-1">
                         <span class="text-gray-400">Total Payments</span>
                         <span class="text-white font-bold font-mono" id="val-total">-</span>
                     </div>
                 </div>
                 <div class="mt-4 h-40 relative">
                     <canvas id="loan-chart"></canvas>
                 </div>
            </div>
        </aside>

        <!-- Main Table -->
        <main class="col-span-8 lg:col-span-9 glass-panel rounded overflow-hidden flex flex-col">
            <div class="overflow-auto flex-grow p-0">
                <table class="text-xs font-mono w-full">
                    <thead>
                        <tr>
                            <th class="text-center w-12">Mo</th>
                            <th>Payment</th>
                            <th>Principal</th>
                            <th>Interest</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        lucide.createIcons();
        let chartInstance = null;
        let scheduleData = [];

        const inputs = document.querySelectorAll('input');
        inputs.forEach(i => i.addEventListener('change', runModel));

        function fmt(n) { return n.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}); }

        function runModel() {
            const p = parseFloat(document.getElementById('principal').value);
            const r = parseFloat(document.getElementById('rate').value) / 100 / 12;
            const n = parseFloat(document.getElementById('years').value) * 12;
            const extra = parseFloat(document.getElementById('extra').value);

            // Monthly Payment
            const pmt = (p * r * Math.pow(1+r, n)) / (Math.pow(1+r, n) - 1);

            document.getElementById('val-pmt').innerText = fmt(pmt);

            let bal = p;
            let totalInt = 0;
            let totalPaid = 0;
            scheduleData = [];

            let chartBal = [];
            let chartLabels = [];

            const tbody = document.getElementById('schedule-body');
            tbody.innerHTML = '';

            for(let i=1; i<=n; i++) {
                if(bal <= 0) break;

                let interest = bal * r;
                let principal = pmt - interest + extra;

                if(bal < principal) {
                    principal = bal;
                    // Last payment adjustment
                }

                bal -= principal;
                totalInt += interest;
                totalPaid += (principal + interest);

                scheduleData.push({ month: i, pmt: principal+interest, prin: principal, int: interest, bal: bal });

                if(i % 12 === 0 || i === 1) { // Optimize rendering
                     const tr = document.createElement('tr');
                     tr.innerHTML = `
                        <td class="text-center text-gray-500">${i}</td>
                        <td class="text-white">${fmt(principal+interest)}</td>
                        <td class="text-green-400">${fmt(principal)}</td>
                        <td class="text-yellow-400">${fmt(interest)}</td>
                        <td class="text-gray-300 font-bold">${fmt(bal)}</td>
                     `;
                     tbody.appendChild(tr);

                     chartBal.push(bal);
                     chartLabels.push('Y'+(i/12).toFixed(0));
                }
            }

            document.getElementById('val-int').innerText = fmt(totalInt);
            document.getElementById('val-total').innerText = fmt(totalPaid);

            // Chart
            if(chartInstance) chartInstance.destroy();
            const ctx = document.getElementById('loan-chart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Balance',
                        data: chartBal,
                        borderColor: '#eab308',
                        backgroundColor: 'rgba(234, 179, 8, 0.1)',
                        fill: true,
                        borderWidth: 2, pointRadius: 1
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { display: false }, x: { display: false } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function exportCSV() {
            let csv = "Month,Payment,Principal,Interest,Balance\n";
            scheduleData.forEach(row => {
                csv += `${row.month},${row.pmt.toFixed(2)},${row.prin.toFixed(2)},${row.int.toFixed(2)},${row.bal.toFixed(2)}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'loan_schedule.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        window.onload = function() {
            lucide.createIcons();
            runModel();
        };
    </script>

    <!-- Adam Global Nav -->
    <script src="../../showcase/js/nav.js" data-root="../.."></script>
</body>
</html>
