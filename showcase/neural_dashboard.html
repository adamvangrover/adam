<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM v23 | Neural Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body class="bg-slate-900 text-slate-200 font-sans overflow-hidden">
    <div class="scan-line"></div>

    <!-- Header -->
    <header class="h-16 border-b border-slate-700/50 flex items-center justify-between px-6 bg-slate-900/80 backdrop-blur-md z-50 relative">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-500 hover:text-white transition">
                <i class="fas fa-chevron-left"></i>
            </a>
            <div class="w-3 h-3 rounded-full bg-emerald-500 animate-pulse box-shadow-glow"></div>
            <h1 class="text-xl font-bold tracking-tight text-slate-100">ADAM <span class="text-cyan-400">v23</span> <span class="text-slate-500 font-normal text-sm ml-2">| NEURAL DASHBOARD</span></h1>
        </div>
        <div class="flex gap-6 font-mono text-xs text-slate-400">
            <div>MEM_USAGE: <span class="text-emerald-400" id="mem-usage">-- GB</span></div>
            <div>GRAPH_OPS: <span class="text-cyan-400" id="ops-rate">-- /s</span></div>
            <div>STATUS: <span class="text-emerald-400" id="status-text">ONLINE</span></div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex gap-4 p-4 h-[calc(100vh-64px)]">

        <!-- Sidebar: Active Agents -->
        <aside class="w-64 glass-panel p-4 flex flex-col gap-4 rounded-lg overflow-y-auto hidden lg:flex">
            <h2 class="text-xs uppercase tracking-widest text-slate-500 font-bold border-b border-slate-700 pb-2">Reasoning Circuits</h2>

            <div class="p-3 bg-slate-800/50 border border-slate-700 hover:border-cyan-500/50 rounded cursor-pointer transition hover-card group" onclick="loadGraph('SNC')">
                <div class="flex justify-between items-center mb-1">
                    <span class="font-bold text-sm text-cyan-400 group-hover:text-cyan-300">SNC Analyzer</span>
                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                </div>
                <div class="text-xs text-slate-400">Cyclical Logic: Credit Risk</div>
            </div>

            <div class="p-3 bg-slate-800/50 border border-slate-700 hover:border-purple-500/50 rounded cursor-pointer transition hover-card group" onclick="loadGraph('Sentiment')">
                <div class="flex justify-between items-center mb-1">
                    <span class="font-bold text-sm text-purple-400 group-hover:text-purple-300">Market Sentiment</span>
                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                </div>
                <div class="text-xs text-slate-400">State: Ingesting News</div>
            </div>

            <div class="p-3 bg-slate-800/50 border border-slate-700 hover:border-red-500/50 rounded cursor-pointer transition hover-card group" onclick="loadGraph('RedTeam')">
                <div class="flex justify-between items-center mb-1">
                    <span class="font-bold text-sm text-red-400 group-hover:text-red-300">Red Team</span>
                    <span class="w-2 h-2 rounded-full bg-amber-400"></span>
                </div>
                <div class="text-xs text-slate-400">Adversarial Simulator</div>
            </div>
             <div class="p-3 bg-slate-800/50 border border-slate-700 hover:border-blue-500/50 rounded cursor-pointer transition hover-card group" onclick="loadGraph('Macro')">
                <div class="flex justify-between items-center mb-1">
                    <span class="font-bold text-sm text-blue-400 group-hover:text-blue-300">Macro Planner</span>
                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                </div>
                <div class="text-xs text-slate-400">Neuro-Symbolic Pathfinding</div>
            </div>
        </aside>

        <!-- Main Visualization Area -->
        <section class="flex-1 glass-panel relative flex flex-col rounded-lg overflow-hidden">
            <div class="absolute top-4 left-4 z-10 pointer-events-none">
                <h2 id="graph-title" class="text-lg font-bold text-slate-200">System Idle</h2>
                <p id="graph-status" class="text-sm text-slate-400 font-mono mt-1">Select a circuit to visualize...</p>
            </div>

            <!-- Vis.js Container -->
            <div id="mynetwork" class="w-full h-full bg-slate-900/50"></div>
        </section>

        <!-- Right Panel: Stream Log -->
        <aside class="w-80 glass-panel flex flex-col rounded-lg overflow-hidden">
            <div class="p-3 border-b border-slate-700 bg-slate-800/80">
                <h2 class="text-xs uppercase tracking-widest text-slate-400 font-bold flex items-center gap-2">
                    <i class="fas fa-terminal text-cyan-500"></i> Live Thought Stream
                </h2>
            </div>
            <div id="log-container" class="flex-1 overflow-y-auto p-3 font-mono text-xs space-y-2 bg-slate-900/80">
                <div class="text-slate-500 border-l-2 border-slate-700 pl-2 py-1">[SYSTEM] Neural Dashboard initialized.</div>
            </div>
        </aside>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Graph Data Definitions (Can be moved to mock_data later)
        const GRAPHS = {
            'SNC': {
                title: "Shared National Credit (SNC) Analysis",
                nodes: [
                    { id: 1, label: 'Ingest Facility', group: 'input' },
                    { id: 2, label: 'Structure Analysis', group: 'process' },
                    { id: 3, label: 'Credit Risk Model', group: 'process' },
                    { id: 4, label: 'Critique Agent', group: 'critique' },
                    { id: 5, label: 'Revise Assessment', group: 'process' },
                    { id: 6, label: 'Final Approval', group: 'output' }
                ],
                edges: [
                    { from: 1, to: 2, arrows: 'to' },
                    { from: 2, to: 3, arrows: 'to' },
                    { from: 3, to: 4, arrows: 'to' },
                    { from: 4, to: 5, arrows: 'to', label: 'Reject', color: { color: '#ef4444' }, dashes: true },
                    { from: 5, to: 3, arrows: 'to', label: 'Retry' },
                    { from: 4, to: 6, arrows: 'to', label: 'Approve', color: { color: '#10b981' } }
                ]
            },
            'Sentiment': {
                title: "Market Sentiment & Contagion",
                nodes: [
                    { id: 1, label: 'News Feed', group: 'input' },
                    { id: 2, label: 'NLP Engine', group: 'process' },
                    { id: 3, label: 'Sentiment Score', group: 'process' },
                    { id: 4, label: 'Knowledge Graph', group: 'db' },
                    { id: 5, label: 'Contagion Check', group: 'critique' },
                    { id: 6, label: 'Risk Alert', group: 'output' }
                ],
                edges: [
                    { from: 1, to: 2, arrows: 'to' },
                    { from: 2, to: 3, arrows: 'to' },
                    { from: 3, to: 4, arrows: 'to' },
                    { from: 4, to: 5, arrows: 'to' },
                    { from: 5, to: 6, arrows: 'to', label: 'High Risk' },
                    { from: 5, to: 1, arrows: 'to', label: 'Monitor', dashes: true }
                ]
            },
            'RedTeam': {
                title: "Adversarial Red Team Simulation",
                nodes: [
                    { id: 1, label: 'Scenario Gen', group: 'process' },
                    { id: 2, label: 'Attack Vector', group: 'critique' },
                    { id: 3, label: 'Defense Sim', group: 'process' },
                    { id: 4, label: 'Vulnerability', group: 'output' },
                    { id: 5, label: 'Patch Gen', group: 'process' }
                ],
                edges: [
                    { from: 1, to: 2, arrows: 'to' },
                    { from: 2, to: 3, arrows: 'to' },
                    { from: 3, to: 4, arrows: 'to' },
                    { from: 4, to: 5, arrows: 'to' },
                    { from: 5, to: 1, arrows: 'to', label: 'Iterate' }
                ]
            },
            'Macro': {
                 title: "Macroeconomic Neuro-Symbolic Planner",
                 nodes: [
                     { id: 1, label: 'Global Macro Data', group: 'input' },
                     { id: 2, label: 'Causal Inference', group: 'process' },
                     { id: 3, label: 'Scenario Planner', group: 'process' },
                     { id: 4, label: 'Strategy Eval', group: 'critique' },
                     { id: 5, label: 'Investment Memo', group: 'output' }
                 ],
                 edges: [
                     { from: 1, to: 2, arrows: 'to' },
                     { from: 2, to: 3, arrows: 'to' },
                     { from: 3, to: 4, arrows: 'to' },
                     { from: 4, to: 3, arrows: 'to', label: 'Refine', dashes: true },
                     { from: 4, to: 5, arrows: 'to', label: 'Finalize' }
                 ]
             }
        };

        // Network Config
        let network = null;
        const container = document.getElementById('mynetwork');
        const options = {
            nodes: {
                shape: 'dot',
                size: 20,
                font: { size: 14, color: '#e2e8f0', face: 'JetBrains Mono' },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                width: 2,
                smooth: { type: 'continuous' },
                color: { color: '#64748b', highlight: '#22d3ee' }
            },
            groups: {
                input: { color: { background: '#0f172a', border: '#94a3b8' }, shape: 'diamond' },
                process: { color: { background: '#1e293b', border: '#38bdf8' } }, // Sky
                critique: { color: { background: '#450a0a', border: '#ef4444' } }, // Red
                output: { color: { background: '#064e3b', border: '#10b981' } }, // Emerald
                db: { color: { background: '#312e81', border: '#818cf8' }, shape: 'database' } // Indigo
            },
            physics: {
                stabilization: false,
                barnesHut: {
                    gravitationalConstant: -2000,
                    springLength: 150
                }
            },
            interaction: { hover: true }
        };

        // Initialize Data Manager
        window.dataManager.init().then(() => {
            updateStats();
            setInterval(updateStats, 2000);
            // Auto load first graph
            loadGraph('SNC');
        });

        function updateStats() {
            const stats = window.dataManager.getSystemStats();
            document.getElementById('mem-usage').innerText = stats.memory_usage + " GB";
            // Randomize OPS for effect
            document.getElementById('ops-rate').innerText = Math.floor(2000 + Math.random() * 500) + " /s";
        }

        function loadGraph(key) {
            const data = GRAPHS[key];
            if(!data) return;

            document.getElementById('graph-title').innerText = data.title;
            document.getElementById('graph-status').innerText = "Initializing neural pathways...";

            // Log interaction
            log(`Loading circuit: ${key}`, 'system');

            const nodes = new vis.DataSet(data.nodes);
            const edges = new vis.DataSet(data.edges);

            if (network) network.destroy();
            network = new vis.Network(container, { nodes, edges }, options);

            // Simulate "Thinking"
            startSimulation(nodes, edges);
        }

        function startSimulation(nodes, edges) {
            const nodeIds = nodes.getIds();
            let activeIndex = 0;

            const interval = setInterval(() => {
                if(!network) { clearInterval(interval); return; }

                // Reset previous
                const prevId = nodeIds[activeIndex === 0 ? nodeIds.length - 1 : activeIndex - 1];
                const prevNode = nodes.get(prevId);

                // Original color restore logic simplified: rely on groups, just reset specific props if needed
                // But easier is just to let vis.js handle standard state, and we pulse sizes or colors

                // Activate Current
                const currId = nodeIds[activeIndex];
                const currNode = nodes.get(currId);

                network.selectNodes([currId]); // Highlight using selection

                log(`Processing node: ${currNode.label}`, currNode.group === 'critique' ? 'error' : 'info');

                activeIndex = (activeIndex + 1) % nodeIds.length;
            }, 1500);
        }

        const logContainer = document.getElementById('log-container');
        function log(msg, type='info') {
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString('en-US', {hour12: false});

            let classes = "border-l-2 pl-2 py-1 text-xs font-mono animate-fade-in";
            if (type === 'system') classes += " border-slate-500 text-slate-400";
            else if (type === 'error') classes += " border-red-500 text-red-400";
            else classes += " border-cyan-500 text-cyan-300";

            div.className = classes;
            div.innerHTML = `<span class="opacity-50">[${time}]</span> ${msg}`;

            logContainer.appendChild(div);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // CSS Animation for log
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes fadeIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
            .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>
