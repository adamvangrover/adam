<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | Neural Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        .thought-node {
            transition: all 0.5s ease;
        }
        .synapse {
            stroke-dasharray: 5;
            animation: dash 1s linear infinite;
        }
        @keyframes dash {
            to { stroke-dashoffset: -10; }
        }
    </style>
</head>
<body class="h-screen flex flex-col grid-bg overflow-hidden">
    <div class="scan-line"></div>

    <!-- Nav injected by nav.js -->

    <!-- Main Content -->
    <main class="flex-1 p-6 grid grid-cols-12 gap-6 overflow-hidden h-full relative">

        <!-- Header -->
        <div class="col-span-12 flex justify-between items-end border-b border-slate-700 pb-2">
            <div>
                <h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 font-mono">NEURAL_DASHBOARD_v23</h2>
                <p class="text-slate-500 text-sm font-mono tracking-widest">REAL-TIME COGNITIVE ARCHITECTURE VISUALIZATION</p>
            </div>
            <div class="text-right">
                <div class="text-xs text-slate-500 font-mono">CYCLE_ID</div>
                <div class="text-xl text-cyan-400 font-mono font-bold" id="cycle-id">8849-AFX</div>
            </div>
        </div>

        <!-- Brain Visualization (Center) -->
        <div class="col-span-12 lg:col-span-8 glass-panel rounded-lg relative overflow-hidden flex items-center justify-center h-[600px] border border-cyan-900/50 shadow-[0_0_50px_rgba(6,182,212,0.1)]">
            <div class="absolute top-4 left-4 z-10">
                <h3 class="text-cyan-500 font-mono text-xs font-bold uppercase tracking-wider border-l-2 border-cyan-500 pl-2">Cortex Activity</h3>
            </div>
            <!-- D3 Graph Container -->
            <div id="neural-graph" class="w-full h-full"></div>

            <!-- Overlay Stats -->
            <div class="absolute bottom-4 right-4 text-xs font-mono text-right space-y-1">
                <div class="text-slate-500">Active Nodes: <span class="text-white" id="active-nodes">0</span></div>
                <div class="text-slate-500">Synaptic Weight: <span class="text-white" id="synaptic-weight">0.00</span></div>
                <div class="text-slate-500">Graph Entropy: <span class="text-white" id="entropy">Low</span></div>
            </div>
        </div>

        <!-- Right Panel: Thought Stream & Metrics -->
        <div class="col-span-12 lg:col-span-4 flex flex-col gap-6 h-[600px]">

            <!-- Active Thoughts Stream -->
            <div class="glass-panel p-4 rounded-lg flex-1 overflow-hidden flex flex-col border border-slate-700">
                <div class="flex justify-between items-center mb-4 border-b border-slate-700 pb-2">
                    <h3 class="text-purple-400 font-mono text-sm font-bold uppercase tracking-wider">Reasoning Stream</h3>
                    <div class="w-2 h-2 rounded-full bg-purple-500 animate-pulse"></div>
                </div>
                <div id="thought-stream" class="flex-1 overflow-y-auto space-y-3 pr-2 font-mono text-xs">
                    <!-- Stream items injected here -->
                </div>
            </div>

            <!-- Conviction Metrics -->
            <div class="glass-panel p-4 rounded-lg h-1/3 flex flex-col border border-slate-700">
                 <div class="flex justify-between items-center mb-4 border-b border-slate-700 pb-2">
                    <h3 class="text-emerald-400 font-mono text-sm font-bold uppercase tracking-wider">Conviction Meter</h3>
                </div>
                <div class="space-y-4 flex-1 justify-center flex flex-col">
                    <div>
                        <div class="flex justify-between text-xs text-slate-400 mb-1">
                            <span>SNC Rating Confidence</span>
                            <span>92%</span>
                        </div>
                        <div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-emerald-500 h-full rounded-full w-[92%] shadow-[0_0_10px_rgba(16,185,129,0.5)]"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs text-slate-400 mb-1">
                            <span>Macro-Econ Correlation</span>
                            <span>78%</span>
                        </div>
                        <div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-blue-500 h-full rounded-full w-[78%] shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs text-slate-400 mb-1">
                            <span>Risk Signal Strength</span>
                            <span>45%</span>
                        </div>
                        <div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-amber-500 h-full rounded-full w-[45%] shadow-[0_0_10px_rgba(245,158,11,0.5)]"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initNeuralGraph();
            startThoughtStream();
        });

        function initNeuralGraph() {
            const container = document.getElementById('neural-graph');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const svg = d3.select("#neural-graph").append("svg")
                .attr("width", width)
                .attr("height", height);

            // Mock Data for "Brain"
            const nodes = Array.from({length: 30}, (_, i) => ({
                id: i,
                group: Math.floor(Math.random() * 4),
                val: Math.random() * 10 + 5
            }));

            const links = [];
            for (let i = 0; i < 40; i++) {
                links.push({
                    source: Math.floor(Math.random() * 30),
                    target: Math.floor(Math.random() * 30),
                    value: Math.random()
                });
            }

            const simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(80))
                .force("charge", d3.forceManyBody().strength(-200))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collide", d3.forceCollide(20));

            const link = svg.append("g")
                .selectAll("line")
                .data(links)
                .join("line")
                .attr("stroke", "#334155")
                .attr("stroke-opacity", 0.6)
                .attr("stroke-width", d => Math.sqrt(d.value) * 2);

            const node = svg.append("g")
                .selectAll("circle")
                .data(nodes)
                .join("circle")
                .attr("r", d => d.val)
                .attr("fill", d => {
                    const colors = ["#22d3ee", "#a855f7", "#10b981", "#f59e0b"];
                    return colors[d.group];
                })
                .attr("fill-opacity", 0.7)
                .attr("stroke", "#fff")
                .attr("stroke-width", 1.5)
                .call(drag(simulation));

            // Pulse animation
            setInterval(() => {
                const randomNode = Math.floor(Math.random() * nodes.length);
                node.filter((d, i) => i === randomNode)
                    .transition().duration(200).attr("r", d => d.val * 2).attr("fill", "#fff")
                    .transition().duration(500).attr("r", d => d.val).attr("fill", d => ["#22d3ee", "#a855f7", "#10b981", "#f59e0b"][d.group]);

                // Highlight links
                link.filter(l => l.source.id === randomNode || l.target.id === randomNode)
                    .transition().duration(200).attr("stroke", "#fff").attr("stroke-opacity", 1)
                    .transition().duration(500).attr("stroke", "#334155").attr("stroke-opacity", 0.6);

            }, 500);

            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("cx", d => d.x)
                    .attr("cy", d => d.y);
            });

            document.getElementById('active-nodes').innerText = nodes.length;
            document.getElementById('synaptic-weight').innerText = (links.length / nodes.length).toFixed(2);
        }

        function drag(simulation) {
            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }

            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }

            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }

            return d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);
        }

        function startThoughtStream() {
            const stream = document.getElementById('thought-stream');
            const thoughts = [
                {agent: "SNC_AGENT", msg: "Analysing collateral coverage for Loan #4922..."},
                {agent: "RISK_BRAIN", msg: "VaR threshold breach detected in Sector 4."},
                {agent: "MACRO_EYE", msg: "Ingesting CPI data from BLS API..."},
                {agent: "SENTIMENT", msg: "Social volume spike detected: 'Recession' + 'Tech'"},
                {agent: "META_COG", msg: "Critiquing previous analysis draft... Confidence: 0.85"},
                {agent: "PLANNER", msg: "Decomposing query into 4 sub-tasks."},
                {agent: "EXEC_CORE", msg: "Spinning up worker node for data retrieval."},
                {agent: "REFLECTOR", msg: "Wait, the debt ratio assumption might be outdated. Verifying..."},
                {agent: "GRAPH_MGR", msg: "Updating edge weights based on new correlation matrix."}
            ];

            const addThought = () => {
                const t = thoughts[Math.floor(Math.random() * thoughts.length)];
                const div = document.createElement('div');
                div.className = "p-2 bg-slate-800/50 rounded border-l-2 border-purple-500 animate-fade-in";
                div.innerHTML = `
                    <div class="flex justify-between items-center text-[10px] text-slate-400 mb-1">
                        <span class="font-bold text-purple-400">${t.agent}</span>
                        <span>${new Date().toLocaleTimeString('en-US', {hour12:false})}</span>
                    </div>
                    <div class="text-slate-300 leading-tight">${t.msg}</div>
                `;
                stream.prepend(div);

                if(stream.children.length > 20) stream.lastChild.remove();
            };

            setInterval(addThought, 1500);
            addThought(); // Initial
        }
    </script>
</body>
</html>
