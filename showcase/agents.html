<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM v23 | Agent Registry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body class="bg-slate-900 text-slate-200 font-sans h-screen flex flex-col overflow-hidden">
    <div class="scan-line"></div>

    <!-- Header -->
    <header class="h-16 border-b border-slate-700/50 flex items-center justify-between px-6 bg-slate-900/80 backdrop-blur-md z-50">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-500 hover:text-white transition">
                <i class="fas fa-chevron-left"></i>
            </a>
            <h1 class="text-xl font-bold tracking-tight text-slate-100">AGENT <span class="text-emerald-400">REGISTRY</span></h1>
        </div>

        <!-- Filter Bar -->
        <div class="flex items-center gap-2 bg-slate-800 p-1 rounded-lg border border-slate-700">
            <button onclick="filterAgents('all')" class="filter-btn active px-3 py-1 text-xs rounded hover:bg-slate-700 transition" data-filter="all">All</button>
            <button onclick="filterAgents('active')" class="filter-btn px-3 py-1 text-xs rounded hover:bg-slate-700 transition" data-filter="active">Active</button>
            <button onclick="filterAgents('idle')" class="filter-btn px-3 py-1 text-xs rounded hover:bg-slate-700 transition" data-filter="idle">Idle</button>
            <button onclick="filterAgents('orchestrator')" class="filter-btn px-3 py-1 text-xs rounded hover:bg-slate-700 transition" data-filter="orchestrator">Orchestrators</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col p-4 gap-4 overflow-hidden">

        <!-- Agent Grid -->
        <div id="agent-grid" class="flex-1 overflow-y-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-2">
            <!-- Agents injected here -->
        </div>

        <!-- Terminal Panel -->
        <div class="h-64 glass-panel border-t border-slate-700 flex flex-col rounded-lg overflow-hidden">
            <div class="bg-slate-800 p-2 flex justify-between items-center px-4 border-b border-slate-700">
                <div class="flex gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <div class="text-xs font-mono text-slate-400">adam_kernel_v23.5.sh</div>
            </div>
            <div id="terminal-output" class="flex-1 bg-slate-950 p-4 font-mono text-xs overflow-y-auto space-y-1 text-slate-300">
                <div class="text-slate-500"># System initialized. Waiting for agent selection...</div>
            </div>
        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/app.js"></script>
    <script>
        const grid = document.getElementById('agent-grid');
        const terminal = document.getElementById('terminal-output');

        // Extended Mock Agents if window.MOCK_DATA is empty
        const defaultAgents = [
            { name: "Meta_Orchestrator", type: "Orchestrator", status: "ACTIVE", load: 85, tasks: 12, version: "v23.5" },
            { name: "SNC_Analyst", type: "Specialist", status: "ACTIVE", load: 62, tasks: 4, version: "v23.1" },
            { name: "Market_Sentiment", type: "Analyst", status: "IDLE", load: 5, tasks: 0, version: "v22.9" },
            { name: "Red_Team_Lead", type: "Adversarial", status: "IDLE", load: 0, tasks: 0, version: "v23.0" },
            { name: "Compliance_Bot", type: "Support", status: "ACTIVE", load: 45, tasks: 8, version: "v22.8" },
            { name: "Quantum_Risk", type: "Experimental", status: "OFFLINE", load: 0, tasks: 0, version: "v0.9b" },
            { name: "Planner_Node", type: "Orchestrator", status: "ACTIVE", load: 30, tasks: 2, version: "v23.5" }
        ];

        window.dataManager.init().then(() => {
            const agents = window.dataManager.getAgents();
            renderAgents(agents.length ? agents : defaultAgents);
        });

        function renderAgents(agentList) {
            grid.innerHTML = '';
            agentList.forEach(agent => {
                const statusColor = agent.status === 'ACTIVE' ? 'bg-emerald-500' : (agent.status === 'IDLE' ? 'bg-amber-500' : 'bg-slate-500');
                const isOrchestrator = agent.type.includes('Orchestrator');

                const card = document.createElement('div');
                card.className = `glass-panel p-4 rounded-lg border border-slate-700 hover:border-cyan-500/50 transition group hover-card relative overflow-hidden agent-card`;
                card.dataset.status = agent.status.toLowerCase();
                card.dataset.type = agent.type.toLowerCase();

                card.onclick = () => selectAgent(agent);

                card.innerHTML = `
                    <div class="absolute top-0 right-0 p-2 opacity-50 text-6xl text-slate-800 -rotate-12 select-none group-hover:opacity-10 transition pointer-events-none">
                        <i class="fas fa-robot"></i>
                    </div>

                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <h3 class="font-bold text-slate-200 group-hover:text-cyan-400 font-mono">${agent.name.replace(/_/g, ' ')}</h3>
                            <div class="text-xs text-slate-500 mt-1">${agent.type} â€¢ ${agent.version}</div>
                        </div>
                        <span class="w-2 h-2 rounded-full ${statusColor} animate-pulse"></span>
                    </div>

                    <div class="mt-6 space-y-3 relative z-10">
                        <div>
                            <div class="flex justify-between text-xs mb-1">
                                <span class="text-slate-500">CPU Load</span>
                                <span class="font-mono text-cyan-400">${agent.load}%</span>
                            </div>
                            <div class="w-full bg-slate-800 rounded-full h-1.5 overflow-hidden">
                                <div class="bg-cyan-600 h-1.5 rounded-full transition-all duration-1000" style="width: ${agent.load}%"></div>
                            </div>
                        </div>

                        <div class="flex justify-between items-center pt-2 border-t border-slate-700/50">
                            <span class="text-xs text-slate-500">Active Tasks</span>
                            <span class="bg-slate-800 px-2 py-0.5 rounded text-xs font-mono text-white border border-slate-700">${agent.tasks}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function filterAgents(filter) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === filter) {
                    btn.classList.add('bg-cyan-900', 'text-cyan-400', 'border-cyan-700');
                    btn.classList.remove('hover:bg-slate-700');
                } else {
                    btn.classList.remove('bg-cyan-900', 'text-cyan-400', 'border-cyan-700');
                    btn.classList.add('hover:bg-slate-700');
                }
            });

            const cards = document.querySelectorAll('.agent-card');
            cards.forEach(card => {
                const status = card.dataset.status;
                const type = card.dataset.type;
                let show = false;

                if (filter === 'all') show = true;
                else if (filter === 'orchestrator' && type.includes('orchestrator')) show = true;
                else if (status === filter) show = true;

                card.style.display = show ? 'block' : 'none';
            });
        }

        function selectAgent(agent) {
            // Terminal startup sequence
            terminal.innerHTML = '';

            const logs = [
                `> Connecting to ${agent.name}...`,
                `> Handshake: [${agent.version}] verified.`,
                `> Loading memory context... OK.`,
                `> Checking dependencies... OK.`,
                `> STATUS: ${agent.status}`,
                `> Last heartbeat: 14ms ago`,
                `> Ready for instructions.`
            ];

            let i = 0;
            const interval = setInterval(() => {
                if (i >= logs.length) {
                    clearInterval(interval);
                    return;
                }
                const div = document.createElement('div');
                div.className = "terminal-text";
                div.innerText = logs[i];
                terminal.appendChild(div);
                terminal.scrollTop = terminal.scrollHeight;
                i++;
            }, 300);
        }
    </script>
</body>
</html>
