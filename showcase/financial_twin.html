<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | Digital Twin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" href="css/style.css">

    <style>
        .entity-panel { background: rgba(15, 23, 42, 0.9); border-left: 1px solid #334155; }
        .node-label { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #94a3b8; }
    </style>
</head>
<body class="h-screen flex flex-col grid-bg overflow-hidden text-slate-200">
    <div class="scan-line"></div>

    <header class="h-16 border-b border-slate-700/50 flex items-center justify-between px-6 bg-[#0f172a]/90 backdrop-blur-md z-40 shrink-0">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-400 hover:text-white transition"><i class="fas fa-arrow-left"></i></a>
            <h1 class="text-xl font-bold tracking-tight mono">ADAM <span class="text-cyan-400">v23.5</span> <span class="text-slate-500 font-normal">| Financial Digital Twin</span></h1>
        </div>
        <div class="flex items-center gap-4 text-xs font-mono">
            <div class="bg-slate-800 border border-slate-700 rounded px-3 py-1 flex items-center gap-2">
                <span class="text-slate-400">ENTITY:</span>
                <span class="text-white font-bold">JPMORGAN CHASE & CO.</span>
            </div>
            <button class="bg-cyan-900/30 hover:bg-cyan-600 text-cyan-400 hover:text-white border border-cyan-800/50 rounded px-3 py-1 transition" onclick="runSimulation()">
                <i class="fas fa-play mr-1"></i> Simulate Shock
            </button>
        </div>
    </header>

    <main class="flex-1 flex overflow-hidden relative">

        <!-- Graph Area -->
        <div id="twin-network" class="flex-1 bg-gradient-to-b from-[#0f172a] to-[#050b14]"></div>

        <!-- Entity Inspector -->
        <aside class="w-80 entity-panel absolute right-0 top-0 h-full transform transition-transform duration-300 translate-x-full z-20 flex flex-col shadow-2xl" id="inspector">
            <div class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/50">
                <h3 class="font-bold text-white font-mono flex items-center gap-2">
                    <i class="fas fa-cube text-cyan-400"></i>
                    <span id="insp-title">Node Details</span>
                </h3>
                <button onclick="closeInspector()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 custom-scrollbar space-y-6">
                
                <!-- Metrics -->
                <div>
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 border-b border-slate-700 pb-1">Core Metrics</h4>
                    <div class="grid grid-cols-2 gap-3" id="insp-metrics">
                        <!-- Injected -->
                    </div>
                </div>

                <!-- Exposure -->
                <div>
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 border-b border-slate-700 pb-1">Risk Exposure</h4>
                    <div class="space-y-3" id="insp-risks">
                        <!-- Injected -->
                    </div>
                </div>

                <!-- Relationships -->
                <div>
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 border-b border-slate-700 pb-1">Dependencies</h4>
                    <ul class="text-xs text-slate-300 space-y-2 font-mono" id="insp-deps">
                        <!-- Injected -->
                    </ul>
                </div>

            </div>

            <div class="p-4 border-t border-slate-700 bg-slate-800/50">
                <button class="w-full bg-slate-700 hover:bg-slate-600 text-white text-xs font-bold py-2 rounded border border-slate-600 transition">
                    View Full Dossier
                </button>
            </div>
        </aside>

        <!-- Controls -->
        <div class="absolute bottom-6 left-6 flex flex-col gap-2 z-10">
            <div class="bg-slate-900/80 backdrop-blur border border-slate-700 rounded-lg p-3 w-64">
                <h4 class="text-xs font-bold text-slate-400 mb-2">Filters</h4>
                <div class="flex flex-wrap gap-2">
                    <button class="text-[10px] bg-blue-900/30 text-blue-300 border border-blue-800 rounded px-2 py-1 hover:bg-blue-800/50 transition">Subsidiaries</button>
                    <button class="text-[10px] bg-red-900/30 text-red-300 border border-red-800 rounded px-2 py-1 hover:bg-red-800/50 transition">Risks</button>
                    <button class="text-[10px] bg-green-900/30 text-green-300 border border-green-800 rounded px-2 py-1 hover:bg-green-800/50 transition">Assets</button>
                </div>
            </div>
        </div>

    </main>

    <script src="js/nav.js"></script>
    <script>
        let network = null;
        let nodes = null;
        let edges = null;

        document.addEventListener('DOMContentLoaded', () => {
            initGraph();
        });

        function initGraph() {
            // Mock Data representing JPM Digital Twin
            const data = {
                nodes: [
                    { id: 1, label: 'JPMORGAN CHASE', group: 'core', value: 50 },

                    // Business Lines
                    { id: 2, label: 'Consumer & Community', group: 'unit', value: 30 },
                    { id: 3, label: 'Corporate & Inv. Bank', group: 'unit', value: 35 },
                    { id: 4, label: 'Asset Management', group: 'unit', value: 25 },

                    // Risks
                    { id: 10, label: 'Credit Risk', group: 'risk', value: 20 },
                    { id: 11, label: 'Market Risk', group: 'risk', value: 15 },
                    { id: 12, label: 'Cyber Threat', group: 'risk', value: 10 },

                    // Assets / Exposures
                    { id: 20, label: 'CRE Loans', group: 'asset', value: 15 },
                    { id: 21, label: 'Treasury Sec.', group: 'asset', value: 20 },
                    { id: 22, label: 'Derivatives', group: 'asset', value: 25 },

                    // Subsidiaries
                    { id: 30, label: 'Chase Bank NA', group: 'sub', value: 20 },
                    { id: 31, label: 'JPM Securities', group: 'sub', value: 15 }
                ],
                edges: [
                    { from: 1, to: 2 }, { from: 1, to: 3 }, { from: 1, to: 4 },
                    { from: 1, to: 30 }, { from: 1, to: 31 },
                    { from: 3, to: 11 }, { from: 2, to: 10 }, { from: 1, to: 12 },
                    { from: 2, to: 20 }, { from: 3, to: 22 }, { from: 4, to: 21 }
                ]
            };

            const container = document.getElementById('twin-network');

            nodes = new vis.DataSet(data.nodes);
            edges = new vis.DataSet(data.edges);

            const options = {
                nodes: {
                    shape: 'dot',
                    font: { face: 'JetBrains Mono', color: '#e2e8f0', size: 12 },
                    borderWidth: 2,
                    shadow: true
                },
                edges: {
                    width: 1,
                    color: { color: '#475569', highlight: '#22d3ee' },
                    smooth: { type: 'continuous' }
                },
                groups: {
                    core: { color: { background: '#0f172a', border: '#22d3ee' }, size: 40 },
                    unit: { color: { background: '#1e293b', border: '#3b82f6' } },
                    risk: { color: { background: '#450a0a', border: '#ef4444' }, shape: 'diamond' },
                    asset: { color: { background: '#064e3b', border: '#10b981' }, shape: 'square' },
                    sub: { color: { background: '#334155', border: '#94a3b8' } }
                },
                physics: {
                    stabilization: false,
                    barnesHut: { gravitationalConstant: -2000, springConstant: 0.04 }
                },
                interaction: { hover: true }
            };

            network = new vis.Network(container, { nodes, edges }, options);

            network.on("click", function (params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    const node = nodes.get(nodeId);
                    openInspector(node);
                } else {
                    closeInspector();
                }
            });
        }

        function openInspector(node) {
            const insp = document.getElementById('inspector');
            insp.classList.remove('translate-x-full');

            document.getElementById('insp-title').innerText = node.label;

            // Mock Data Generation based on node type
            let metricsHtml = '';
            let riskHtml = '';

            if (node.group === 'unit' || node.group === 'core') {
                metricsHtml = `
                    <div class="bg-slate-800 p-2 rounded">
                        <div class="text-[10px] text-slate-500 uppercase">Revenue (TTM)</div>
                        <div class="text-sm font-bold text-white font-mono">$${(Math.random()*50).toFixed(1)}B</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded">
                        <div class="text-[10px] text-slate-500 uppercase">Employees</div>
                        <div class="text-sm font-bold text-white font-mono">${(Math.random()*100).toFixed(1)}k</div>
                    </div>
                `;
            } else if (node.group === 'risk') {
                metricsHtml = `
                    <div class="bg-slate-800 p-2 rounded">
                        <div class="text-[10px] text-slate-500 uppercase">VaR (99%)</div>
                        <div class="text-sm font-bold text-red-400 font-mono">$${(Math.random()*500).toFixed(0)}M</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded">
                        <div class="text-[10px] text-slate-500 uppercase">Sensitivity</div>
                        <div class="text-sm font-bold text-white font-mono">High</div>
                    </div>
                `;
            } else {
                metricsHtml = `
                    <div class="bg-slate-800 p-2 rounded">
                        <div class="text-[10px] text-slate-500 uppercase">Value</div>
                        <div class="text-sm font-bold text-white font-mono">$${(Math.random()*10).toFixed(1)}B</div>
                    </div>
                `;
            }
            document.getElementById('insp-metrics').innerHTML = metricsHtml;

            // Risks
            document.getElementById('insp-risks').innerHTML = `
                <div class="flex items-center justify-between text-xs">
                    <span class="text-slate-400">Contagion Score</span>
                    <div class="w-24 bg-slate-700 h-2 rounded-full overflow-hidden">
                        <div class="bg-amber-500 h-full" style="width: ${Math.random()*100}%"></div>
                    </div>
                </div>
                <div class="flex items-center justify-between text-xs">
                    <span class="text-slate-400">Regulatory Impact</span>
                    <span class="text-slate-300 font-mono">Medium</span>
                </div>
            `;

            // Dependencies
            const connectedIds = network.getConnectedNodes(node.id);
            let depsHtml = '';
            connectedIds.forEach(id => {
                const n = nodes.get(id);
                depsHtml += `
                    <li class="flex items-center gap-2">
                        <i class="fas fa-link text-slate-600 text-[10px]"></i>
                        <span>${n.label}</span>
                        <span class="text-[10px] text-slate-500 ml-auto uppercase">${n.group}</span>
                    </li>
                `;
            });
            document.getElementById('insp-deps').innerHTML = depsHtml;
        }

        function closeInspector() {
            document.getElementById('inspector').classList.add('translate-x-full');
            network.unselectAll();
        }

        function runSimulation() {
            // Visual shockwave
            const nodeIds = nodes.getIds();
            const updates = nodeIds.map(id => {
                const isRisk = nodes.get(id).group === 'risk';
                return {
                    id: id,
                    color: isRisk ? { background: '#ff0000' } : null,
                    size: isRisk ? 30 : 20
                };
            });
            nodes.update(updates);

            setTimeout(() => {
                // Revert
                nodes.update(nodeIds.map(id => ({
                    id: id,
                    color: { background: nodes.get(id).group === 'risk' ? '#450a0a' : undefined },
                    size: nodes.get(id).group === 'core' ? 40 : 20
                })));
                alert("Simulation Complete: Stress impact recorded in risk nodes.");
            }, 1000);
        }
    </script>
</body>
</html>
