<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | Financial Digital Twin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        .ticker-text {
            animation: scroll-left 20s linear infinite;
        }
        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .live-indicator {
            box-shadow: 0 0 10px #ef4444;
        }
    </style>
</head>
<body class="h-screen flex flex-col grid-bg overflow-hidden">
    <div class="scan-line"></div>

    <!-- Nav injected by nav.js -->

    <!-- Ticker Tape -->
    <div class="bg-slate-900 border-b border-slate-700 h-8 overflow-hidden flex items-center relative z-20">
        <div class="whitespace-nowrap ticker-text font-mono text-xs text-slate-300 flex gap-8">
            <span>AAPL <span class="text-emerald-400">▲ 185.00 (+1.2%)</span></span>
            <span>MSFT <span class="text-emerald-400">▲ 402.10 (+0.8%)</span></span>
            <span>TSLA <span class="text-red-400">▼ 172.50 (-2.1%)</span></span>
            <span>NVDA <span class="text-emerald-400">▲ 850.00 (+3.5%)</span></span>
            <span>BTC-USD <span class="text-emerald-400">▲ 65,400 (+1.5%)</span></span>
            <span>US10Y <span class="text-emerald-400">▲ 4.25%</span></span>
            <span>EUR/USD <span class="text-red-400">▼ 1.085</span></span>
            <span>VIX <span class="text-red-400">▼ 13.50</span></span>
        </div>
    </div>

    <main class="flex-1 p-6 grid grid-cols-12 gap-6 overflow-hidden">

        <!-- Header -->
        <div class="col-span-12 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white font-mono flex items-center gap-2">
                <span class="w-3 h-3 bg-red-500 rounded-full animate-pulse live-indicator"></span>
                FINANCIAL_DIGITAL_TWIN: <span class="text-cyan-400">TSLA (Tesla Inc.)</span>
            </h1>
            <div class="flex gap-2">
                <button class="px-3 py-1 bg-slate-800 border border-slate-600 rounded text-xs text-white hover:bg-slate-700">Change Entity</button>
                <button class="px-3 py-1 bg-cyan-600 border border-cyan-500 rounded text-xs text-white hover:bg-cyan-500">Run Simulation</button>
            </div>
        </div>

        <!-- Left Column: Real-time Metrics -->
        <div class="col-span-12 lg:col-span-3 space-y-4">

            <div class="glass-panel p-4 rounded border border-slate-700">
                <h3 class="text-xs text-slate-400 uppercase font-bold mb-4">Live Sentiment</h3>
                <div class="relative h-32 flex items-center justify-center">
                    <!-- Gauge Mock -->
                    <svg viewBox="0 0 100 50" class="w-full h-full">
                        <path d="M10 50 A 40 40 0 0 1 90 50" fill="none" stroke="#334155" stroke-width="10" />
                        <path d="M10 50 A 40 40 0 0 1 60 18" fill="none" stroke="#ef4444" stroke-width="10" />
                        <text x="50" y="45" text-anchor="middle" fill="white" font-size="12" font-family="monospace" font-weight="bold">BEARISH</text>
                    </svg>
                </div>
                <div class="text-center text-xs text-red-400 mt-[-10px]">Score: 32/100</div>
            </div>

            <div class="glass-panel p-4 rounded border border-slate-700">
                <h3 class="text-xs text-slate-400 uppercase font-bold mb-2">Supply Chain Health</h3>
                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between text-xs text-slate-300 mb-1">Battery Cells (CATL)</div>
                        <div class="w-full bg-slate-800 h-1 rounded"><div class="bg-emerald-500 w-[90%] h-full"></div></div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs text-slate-300 mb-1">Semiconductors (TSMC)</div>
                        <div class="w-full bg-slate-800 h-1 rounded"><div class="bg-yellow-500 w-[60%] h-full"></div></div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs text-slate-300 mb-1">Raw Lithium</div>
                        <div class="w-full bg-slate-800 h-1 rounded"><div class="bg-red-500 w-[40%] h-full"></div></div>
                    </div>
                </div>
            </div>

            <div class="glass-panel p-4 rounded border border-slate-700">
                 <h3 class="text-xs text-slate-400 uppercase font-bold mb-2">News Feed (Live)</h3>
                 <div class="text-[10px] space-y-2 font-mono h-40 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-slate-900/90 pointer-events-none"></div>
                    <div class="text-slate-300 border-l-2 border-red-500 pl-2">
                        <span class="text-slate-500">10:42 AM</span> Breaking: Production halt rumors at Berlin Gigafactory due to protests.
                    </div>
                    <div class="text-slate-300 border-l-2 border-blue-500 pl-2">
                        <span class="text-slate-500">10:38 AM</span> Analyst Upgrade: Wedbush maintains outperform, citing AI day.
                    </div>
                    <div class="text-slate-300 border-l-2 border-slate-500 pl-2">
                        <span class="text-slate-500">10:15 AM</span> New patent filed for autonomous charging robot.
                    </div>
                 </div>
            </div>

        </div>

        <!-- Center: 3D Twin Visualization (Mocked with Canvas/SVG) -->
        <div class="col-span-12 lg:col-span-6 glass-panel rounded relative overflow-hidden flex items-center justify-center bg-black">
             <div class="absolute top-4 left-4 z-10">
                <h3 class="text-xs font-bold text-white bg-slate-800 px-2 py-1 rounded border border-slate-600">Global Production Map</h3>
            </div>

            <!-- Use a background image or SVG to simulate a map -->
            <div id="world-map" class="w-full h-full opacity-60"></div>

            <!-- Animated dots -->
            <div class="absolute inset-0 pointer-events-none" id="map-overlays">
                <!-- Dots injected via JS -->
            </div>
        </div>

        <!-- Right Column: Financials & Predictions -->
        <div class="col-span-12 lg:col-span-3 space-y-4">
             <div class="glass-panel p-4 rounded border border-slate-700">
                <h3 class="text-xs text-slate-400 uppercase font-bold mb-4">Projected Earnings (Q3)</h3>
                <div class="text-3xl font-bold text-white font-mono">$24.2B</div>
                <div class="text-xs text-emerald-400 mt-1">▲ +4.2% vs Consensus</div>
                <div class="mt-4 h-24 bg-slate-800/50 rounded flex items-end justify-between p-2 gap-1">
                    <div class="w-1/4 bg-slate-600 h-[60%] rounded-t"></div>
                    <div class="w-1/4 bg-slate-600 h-[70%] rounded-t"></div>
                    <div class="w-1/4 bg-slate-600 h-[65%] rounded-t"></div>
                    <div class="w-1/4 bg-emerald-500 h-[85%] rounded-t animate-pulse"></div>
                </div>
            </div>

            <div class="glass-panel p-4 rounded border border-slate-700 flex-1">
                <h3 class="text-xs text-slate-400 uppercase font-bold mb-4">Scenario Analysis</h3>
                <div class="space-y-2">
                    <button class="w-full text-left p-2 rounded bg-slate-800 hover:bg-slate-700 border border-transparent hover:border-slate-500 transition text-xs text-slate-300 flex justify-between group">
                        <span>Recession (Hard Landing)</span>
                        <span class="text-red-400 group-hover:text-white">-15%</span>
                    </button>
                    <button class="w-full text-left p-2 rounded bg-slate-800 hover:bg-slate-700 border border-transparent hover:border-slate-500 transition text-xs text-slate-300 flex justify-between group">
                        <span>AI Breakthrough</span>
                        <span class="text-emerald-400 group-hover:text-white">+25%</span>
                    </button>
                    <button class="w-full text-left p-2 rounded bg-slate-800 hover:bg-slate-700 border border-transparent hover:border-slate-500 transition text-xs text-slate-300 flex justify-between group">
                        <span>Supply Chain Crisis</span>
                        <span class="text-amber-400 group-hover:text-white">-8%</span>
                    </button>
                </div>
            </div>
        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initMap();
        });

        function initMap() {
            // Simple D3 Geo Map
            const width = document.getElementById('world-map').clientWidth;
            const height = document.getElementById('world-map').clientHeight;

            const svg = d3.select("#world-map").append("svg")
                .attr("width", "100%")
                .attr("height", "100%");

            const projection = d3.geoMercator()
                .scale(100)
                .translate([width / 2, height / 1.5]);

            const path = d3.geoPath().projection(projection);

            // Fetch a simple world geojson or just draw some circles if internet blocked
            // Since we can't reliably fetch external geojson without a proxy tool in browser,
            // we will simulate the map with static points or a placeholder image if available.
            // For now, let's just draw a grid and some glowing nodes.

            // Grid
            const grid = svg.append("g").attr("class", "grid");
            for (let x = 0; x < width; x += 40) {
                grid.append("line").attr("x1", x).attr("y1", 0).attr("x2", x).attr("y2", height).attr("stroke", "#1e293b").attr("stroke-width", 1);
            }
            for (let y = 0; y < height; y += 40) {
                grid.append("line").attr("x1", 0).attr("y1", y).attr("x2", width).attr("y2", y).attr("stroke", "#1e293b").attr("stroke-width", 1);
            }

            // Factory Locations (Mock)
            const factories = [
                { name: "Fremont", x: width * 0.2, y: height * 0.4 },
                { name: "Austin", x: width * 0.25, y: height * 0.45 },
                { name: "Shanghai", x: width * 0.8, y: height * 0.45 },
                { name: "Berlin", x: width * 0.55, y: height * 0.35 }
            ];

            const g = svg.append("g");

            // Connections
            g.selectAll("line")
                .data([
                    {s: 0, t: 2}, {s: 1, t: 3}, {s: 2, t: 3}
                ])
                .join("line")
                .attr("x1", d => factories[d.s].x)
                .attr("y1", d => factories[d.s].y)
                .attr("x2", d => factories[d.t].x)
                .attr("y2", d => factories[d.t].y)
                .attr("stroke", "#06b6d4")
                .attr("stroke-width", 1)
                .attr("stroke-dasharray", "4 4")
                .attr("opacity", 0.5);

            // Nodes
            g.selectAll("circle")
                .data(factories)
                .join("circle")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", 6)
                .attr("fill", "#ef4444")
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .attr("class", "animate-pulse");

            // Labels
            g.selectAll("text")
                .data(factories)
                .join("text")
                .attr("x", d => d.x + 10)
                .attr("y", d => d.y + 4)
                .text(d => d.name)
                .attr("fill", "#fff")
                .attr("font-size", "10px")
                .attr("font-family", "monospace");
        }
    </script>
</body>
</html>
