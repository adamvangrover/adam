<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM System | Financial Digital Twin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .company-node:hover { transform: scale(1.1); box-shadow: 0 0 20px rgba(99,102,241,0.6); }
    </style>
</head>
<body class="h-screen flex flex-col grid-bg text-slate-200">
    <div class="scan-line"></div>
    <!-- Nav via nav.js -->

    <main class="flex-1 p-8 overflow-y-auto grid grid-cols-12 gap-6">

        <!-- Header -->
        <div class="col-span-12 glass-panel p-6 rounded-lg border-l-4 border-indigo-500">
            <h1 class="text-3xl font-bold text-white mb-2 font-mono">FINANCIAL DIGITAL TWIN (FDT)</h1>
            <p class="text-slate-400 max-w-3xl">
                The Financial Digital Twin creates a high-fidelity virtual replica of corporate entities and market structures.
                It utilizes the <span class="text-indigo-400 font-bold">Financial Industry Business Ontology (FIBO)</span> to map complex relationships, ownership structures, and risk contagion paths.
            </p>
        </div>

        <!-- 3D Visualization Placeholder -->
        <div class="col-span-12 lg:col-span-8 glass-panel rounded-lg h-[600px] relative overflow-hidden flex flex-col">
            <div class="absolute top-4 left-4 z-10">
                <span class="text-xs font-mono bg-slate-900/80 px-2 py-1 rounded text-cyan-400 border border-slate-700">LIVE SIMULATION</span>
                <div id="selected-company-overlay" class="mt-2 text-xl font-bold text-white drop-shadow-md">No Entity Selected</div>
            </div>

            <!-- Mock Network View -->
            <div class="flex-1 bg-slate-900 flex items-center justify-center relative" id="network-container">
                <!-- Dynamically populated nodes -->
                <div class="text-slate-600">Select a company to visualize connectivity</div>
            </div>

            <!-- Controls -->
            <div class="h-16 bg-slate-800 border-t border-slate-700 flex items-center justify-between px-6">
                <div class="flex space-x-4">
                    <button class="text-slate-400 hover:text-white" onclick="resetView()">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    </button>
                    <button class="text-slate-400 hover:text-white"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></button>
                </div>
                <div class="w-1/3">
                    <div class="h-1 bg-slate-600 rounded">
                        <div class="h-1 bg-indigo-500 w-2/3 rounded animate-pulse"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Panel -->
        <div class="col-span-12 lg:col-span-4 space-y-6">

            <!-- Entity Selector -->
             <div class="glass-panel p-5 rounded-lg">
                <h3 class="text-emerald-400 font-bold font-mono uppercase mb-4">Tracked Entities</h3>
                <div class="space-y-2 h-40 overflow-y-auto" id="company-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="glass-panel p-5 rounded-lg">
                <h3 class="text-indigo-400 font-bold font-mono uppercase mb-4">Entity Details</h3>
                <div id="entity-details" class="space-y-3 font-mono text-xs text-slate-400">
                    <p>Select a company to view details.</p>
                </div>
            </div>

            <div class="glass-panel p-5 rounded-lg">
                <h3 class="text-amber-400 font-bold font-mono uppercase mb-4">Scenario Injection</h3>
                <div class="space-y-2">
                    <button class="w-full text-left p-2 hover:bg-slate-800 rounded text-xs text-slate-300 border border-transparent hover:border-amber-900 transition">
                        ⚡ Interest Rate Shock (+200bps)
                    </button>
                    <button class="w-full text-left p-2 hover:bg-slate-800 rounded text-xs text-slate-300 border border-transparent hover:border-amber-900 transition">
                        ⚡ Supply Chain Halt (Asia-Pac)
                    </button>
                    <button class="w-full text-left p-2 hover:bg-slate-800 rounded text-xs text-slate-300 border border-transparent hover:border-amber-900 transition">
                        ⚡ Credit Downgrade Cascade
                    </button>
                </div>
            </div>

        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/nav.js"></script>
    <script>
        let companyData = {};

        document.addEventListener('DOMContentLoaded', () => {
             const data = window.MOCK_DATA || {};
             companyData = data.company_data || {};
             const companyList = document.getElementById('company-list');

             if (Object.keys(companyData).length === 0) {
                 companyList.innerHTML = '<div class="text-slate-500">No company data loaded.</div>';
             } else {
                 Object.keys(companyData).forEach(ticker => {
                     const comp = companyData[ticker];
                     const el = document.createElement('div');
                     el.className = 'p-2 bg-slate-800/50 hover:bg-slate-700 rounded cursor-pointer flex justify-between items-center border border-transparent hover:border-emerald-500/50 transition';
                     el.innerHTML = `
                        <span class="font-bold text-white">${ticker}</span>
                        <span class="text-xs text-slate-400">${comp.name}</span>
                     `;
                     el.onclick = () => selectCompany(ticker);
                     companyList.appendChild(el);
                 });
                 // Select first one by default
                 selectCompany(Object.keys(companyData)[0]);
             }
        });

        function selectCompany(ticker) {
            const data = companyData[ticker];
            if (!data) return;

            document.getElementById('selected-company-overlay').textContent = `${data.name} (${ticker})`;

            // Render Details
            const details = document.getElementById('entity-details');
            details.innerHTML = `
                <div class="flex justify-between border-b border-slate-700 pb-2">
                    <span class="text-slate-400">Industry</span>
                    <span class="text-white">${data.industry}</span>
                </div>
                 <div class="flex justify-between border-b border-slate-700 pb-2">
                    <span class="text-slate-400">Growth Rate</span>
                    <span class="text-white">${(data.growth_rate * 100).toFixed(1)}%</span>
                </div>
                 <div class="flex justify-between border-b border-slate-700 pb-2">
                    <span class="text-slate-400">Tax Rate</span>
                    <span class="text-white">${(data.tax_rate * 100).toFixed(1)}%</span>
                </div>
                <div class="mt-2 text-xs">
                    <span class="text-slate-500">Competitors:</span> <span class="text-slate-300">${(data.competitors || []).join(', ')}</span>
                </div>
            `;

            // Visualize (Simple Star Topology)
            const container = document.getElementById('network-container');
            container.innerHTML = '';

            // Center Node
            const center = document.createElement('div');
            center.className = 'w-32 h-32 rounded-full border-4 border-indigo-500 flex items-center justify-center bg-indigo-900/40 shadow-[0_0_50px_rgba(99,102,241,0.5)] z-20 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 company-node transition-all duration-300 cursor-pointer';
            center.innerHTML = `<div class="text-center"><div class="font-bold text-xl text-white">${ticker}</div><div class="text-[0.6rem] text-indigo-300">Target</div></div>`;
            container.appendChild(center);

            // Competitor Nodes
            const competitors = data.competitors || [];
            const radius = 150;
            const angleStep = (2 * Math.PI) / (competitors.length + 3); // +3 for mock nodes

            competitors.forEach((comp, i) => {
                const angle = i * angleStep;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;

                const node = document.createElement('div');
                node.className = 'absolute w-20 h-20 rounded-full border-2 border-cyan-500 flex items-center justify-center bg-cyan-900/30 z-10 company-node transition-all duration-300 cursor-pointer';
                node.style.top = `calc(50% + ${y}px - 40px)`;
                node.style.left = `calc(50% + ${x}px - 40px)`;
                node.innerHTML = `<span class="font-bold text-white text-xs">${comp}</span>`;

                // Line
                const line = document.createElement('div');
                line.className = 'absolute bg-slate-600 origin-left z-0';
                line.style.height = '1px';
                line.style.width = `${radius}px`;
                line.style.top = '50%';
                line.style.left = '50%';
                line.style.transform = `rotate(${angle * (180/Math.PI)}deg)`;

                container.appendChild(line);
                container.appendChild(node);
            });

            // Mock Data Nodes (Supply Chain, etc)
            ['Supply\nChain', 'Credit\nSwap', 'ESG\nScore'].forEach((label, i) => {
                const angle = (competitors.length + i) * angleStep;
                 const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;

                const node = document.createElement('div');
                let color = 'emerald';
                if(i===1) color = 'purple';
                node.className = `absolute w-16 h-16 rounded-full border-2 border-${color}-500 flex items-center justify-center bg-${color}-900/30 z-10 company-node transition-all duration-300 cursor-pointer`;
                node.style.top = `calc(50% + ${y}px - 32px)`;
                node.style.left = `calc(50% + ${x}px - 32px)`;
                node.innerHTML = `<span class="text-[0.6rem] text-center leading-tight text-slate-300">${label}</span>`;

                 // Line
                const line = document.createElement('div');
                line.className = 'absolute bg-slate-700 origin-left z-0 dashed-line';
                line.style.height = '1px';
                line.style.width = `${radius}px`;
                line.style.top = '50%';
                line.style.left = '50%';
                line.style.transform = `rotate(${angle * (180/Math.PI)}deg)`;

                container.appendChild(line);
                container.appendChild(node);
            });
        }

        function resetView() {
            // ...
        }
    </script>
</body>
</html>
