<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ADAM | System Knowledge Graph</title>



    <script src=https://cdn.tailwindcss.com></script>

    <link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css rel="stylesheet">

    <link href=https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap rel="stylesheet">

    <script type="text/javascript" src=https://unpkg.com/vis-network/standalone/umd/vis-network.min.js></script>



    <style>

        :root {

            --bg-dark: #020408;

            --panel-bg: rgba(15, 23, 42, 0.95);

            --border-color: #334155;

            --accent-cyan: #22d3ee;

        }



        body {

            background-color: var(--bg-dark);

            color: #e2e8f0;

            font-family: 'Inter', sans-serif;

            overflow: hidden;

        }



        .scan-line {

            position: fixed;

            top: 0; left: 0; width: 100%; height: 100%;

            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));

            background-size: 100% 2px, 3px 100%;

            pointer-events: none;

            z-index: 50;

        }



        .glass-panel {

            background: var(--panel-bg);

            backdrop-filter: blur(12px);

            border: 1px solid var(--border-color);

        }



        .mono { font-family: 'JetBrains Mono', monospace; }



        .custom-scrollbar::-webkit-scrollbar { width: 4px; }

        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }

        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--accent-cyan); }

    </style>

</head>

<body class="h-screen flex flex-col">

    <div class="scan-line"></div>



    <header class="h-16 border-b border-slate-700/50 flex items-center justify-between px-6 bg-[#0f172a]/90 backdrop-blur-md z-40 shrink-0">

        <div class="flex items-center gap-4">

            <div class="w-8 h-8 bg-purple-900/50 rounded flex items-center justify-center border border-purple-500/30">

                <i class="fas fa-brain text-purple-400"></i>

            </div>

            <h1 class="text-xl font-bold tracking-tight mono">ADAM <span class="text-purple-400">CORE</span> <span class="text-slate-500 font-normal">| System Knowledge Graph</span></h1>

        </div>



        <div class="flex items-center gap-4 text-xs font-mono">

             <div class="relative">

                <i class="fas fa-search absolute left-3 top-2 text-slate-500"></i>

                <input type="text" id="search-input" placeholder="Search modules..." class="bg-slate-800 border border-slate-700 rounded-full pl-8 pr-4 py-1.5 w-64 text-white focus:outline-none focus:border-purple-500">

            </div>

            <button id="btn-cluster" class="bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-600 rounded px-3 py-1.5 transition">

                <i class="fas fa-project-diagram mr-1"></i> Cluster

            </button>

            <div class="h-6 w-px bg-slate-700"></div>

             <!-- Code Detail Toggle -->

             <label class="flex items-center gap-2 cursor-pointer">

                <input type="checkbox" id="toggle-code" class="w-4 h-4 rounded border-slate-600 bg-slate-800 text-purple-500 focus:ring-0">

                <span class="text-slate-400 hover:text-white transition">Show Code</span>

            </label>

            <div class="h-6 w-px bg-slate-700"></div>

            <div class="flex items-center gap-2">

                <span class="text-slate-400">MODE:</span>

                <button id="mode-dev" class="px-2 py-1 rounded bg-purple-900/40 text-purple-300 border border-purple-700">DEV</button>

                <button id="mode-train" class="px-2 py-1 rounded hover:bg-slate-800 text-slate-500 border border-transparent">TRAINING</button>

            </div>

        </div>

    </header>



    <main class="flex-1 flex overflow-hidden relative">

        <div id="graph-container" class="flex-1 bg-gradient-to-b from-[#0f172a] to-[#020408]"></div>



        <!-- Node Inspector (Side Panel) -->

        <aside id="inspector" class="w-96 glass-panel absolute right-0 top-0 h-full transform transition-transform duration-300 translate-x-full z-30 flex flex-col shadow-2xl border-l border-slate-700">

            <div class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-900/50">

                <h3 class="font-bold text-white mono flex items-center gap-2 text-sm">

                    <i class="fas fa-cube text-purple-400"></i>

                    <span id="insp-title">Node Details</span>

                </h3>

                <button onclick="app.closeInspector()" class="text-slate-400 hover:text-white transition"><i class="fas fa-times"></i></button>

            </div>



            <div class="flex-1 overflow-y-auto p-4 custom-scrollbar space-y-4" id="insp-content">

                <!-- Dynamic Content -->

                <div class="text-center text-slate-500 text-xs italic mt-10">Select a node to view details...</div>

            </div>

        </aside>



        <!-- Legend / Stats -->

        <div class="absolute bottom-6 left-6 z-20 pointer-events-none">

            <div class="glass-panel rounded-lg p-4 w-64 pointer-events-auto">

                <h4 class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-wider mono">Repo Stats</h4>

                <div class="grid grid-cols-2 gap-4 text-xs mono mb-4">

                    <div>

                        <div class="text-slate-500">Nodes</div>

                        <div class="text-white font-bold text-lg" id="stat-nodes">0</div>

                    </div>

                    <div>

                        <div class="text-slate-500">Links</div>

                        <div class="text-white font-bold text-lg" id="stat-edges">0</div>

                    </div>

                </div>



                <h4 class="text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-wider mono">Legend</h4>

                <div class="space-y-1 text-[10px] mono text-slate-300">

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#ef4444]"></span> House View / Strategy</div>

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#a855f7]"></span> Core / Infrastructure</div>

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#10b981]"></span> Agents (Extracted)</div>

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#3b82f6]"></span> UI / Showcase</div>

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#ec4899]"></span> Prompt / Skill</div>

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#f59e0b]"></span> Knowledge Base</div>

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#eab308]"></span> Class</div>

                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#3b82f6]"></span> Function</div>

                </div>

            </div>

        </div>

    </main>



    <script>

        class SystemGraph {

            constructor() {

                this.container = document.getElementById('graph-container');

                this.network = null;

                this.data = null;

                this.isClustered = false;

            }



            async init() {

                try {

                    const res = await fetch('data/system_knowledge_graph.json');

                    const json = await res.json();



                    document.getElementById('stat-nodes').innerText = json.nodes.length;

                    document.getElementById('stat-edges').innerText = json.edges.length;



                    this.data = {

                        nodes: new vis.DataSet(json.nodes),

                        edges: new vis.DataSet(json.edges)

                    };



                    this.render();

                    this.setupEvents();

                    this.updateVisibility(); // Initial filter

                } catch (e) {

                    console.error("Failed to load graph", e);

                }

            }



            render() {

                const options = {

                    nodes: {

                        shape: 'dot',

                        font: { face: 'Inter', color: '#cbd5e1', size: 10 },

                        borderWidth: 1

                    },

                    edges: {

                        color: { color: '#334155', opacity: 0.3 },

                        smooth: { type: 'continuous', roundness: 0.5 },

                        arrows: { to: { enabled: true, scaleFactor: 0.5 } }

                    },

                    groups: {

                        strategy: { color: '#ef4444', size: 40, font: {size: 14, face:'JetBrains Mono'} },

                        core: { color: '#a855f7' },

                        agent: { color: '#10b981' },

                        ui: { color: '#3b82f6' },

                        prompt: { color: '#ec4899', shape: 'box' },

                        knowledge: { color: '#f59e0b', shape: 'square' },

                        code: { color: '#64748b' },

                        doc: { color: '#94a3b8', shape: 'text' },

                        class: { color: '#eab308' },

                        function: { color: '#3b82f6' }

                    },

                    layout: {

                        improvedLayout: false

                    },

                    physics: {

                        stabilization: false,

                        barnesHut: {

                            gravitationalConstant: -2000,

                            springConstant: 0.01,

                            springLength: 150

                        }

                    },

                    interaction: { tooltipDelay: 200, hover: true, selectConnectedEdges: false }

                };



                this.network = new vis.Network(this.container, this.data, options);



                // Stabilize event

                this.network.on("stabilizationIterationsDone", () => {

                    this.network.setOptions({ physics: { enabled: false } });

                });



                this.network.on("click", (params) => {

                    if (params.nodes.length > 0) {

                        const node = this.data.nodes.get(params.nodes[0]);

                        this.openInspector(node);

                    } else {

                        this.closeInspector();

                    }

                });

            }



            setupEvents() {

                document.getElementById('search-input').addEventListener('input', (e) => {

                    const term = e.target.value.toLowerCase();

                    if(term.length < 2) return;



                    const matches = this.data.nodes.get({

                        filter: n => n.label.toLowerCase().includes(term)

                    });



                    if(matches.length > 0) {

                        this.network.focus(matches[0].id, { scale: 1.5, animation: true });

                        this.network.selectNodes([matches[0].id]);

                        this.openInspector(matches[0]);

                    }

                });



                document.getElementById('btn-cluster').addEventListener('click', () => {

                    if(!this.isClustered) {

                        const groups = ['core', 'agent', 'ui', 'knowledge', 'strategy', 'prompt'];

                        groups.forEach(g => {

                            this.network.cluster({

                                joinCondition: (opts) => opts.group === g,

                                clusterNodeProperties: {

                                    label: g.toUpperCase(),

                                    shape: 'database',

                                    color: '#fff',

                                    font: {size: 20, color: '#000'}

                                }

                            });

                        });

                        this.isClustered = true;

                    } else {

                        Object.keys(this.network.clustering.clusteredNodes).forEach(id => {

                            try { this.network.openCluster(id); } catch(e){}

                        });

                        this.isClustered = false;

                    }

                });



                // Mode Toggle

                document.getElementById('mode-train').addEventListener('click', () => {

                   this.setMode('train');

                });

                document.getElementById('mode-dev').addEventListener('click', () => {

                   this.setMode('dev');

                });



                // Code Toggle

                document.getElementById('toggle-code').addEventListener('change', (e) => {

                    this.toggleCode(e.target.checked);

                });

            }



            // Initial view state management

            updateVisibility() {

                const isTrain = document.getElementById('mode-train').classList.contains('text-amber-300');

                const showCode = document.getElementById('toggle-code').checked;



                const allNodes = this.data.nodes.get();

                const updates = allNodes.map(n => {

                    let visible = true;



                    // Train Mode Filter: Only docs and strategy

                    if (isTrain) {

                        if (!(n.group === 'knowledge' || n.group === 'strategy' || n.path?.endsWith('.md') || n.group === 'prompt')) {

                            visible = false;

                        }

                    }



                    // Code Filter: Hide class/function if unchecked

                    if (!showCode) {

                        if (n.group === 'class' || n.group === 'function') {

                            visible = false;

                        }

                    }



                    return { id: n.id, hidden: !visible };

                });

                this.data.nodes.update(updates);

            }



            toggleCode(checked) {

                this.updateVisibility();

            }



            setMode(mode) {

                const trainBtn = document.getElementById('mode-train');

                const devBtn = document.getElementById('mode-dev');



                if(mode === 'train') {

                    trainBtn.className = "px-2 py-1 rounded bg-amber-900/40 text-amber-300 border border-amber-700";

                    devBtn.className = "px-2 py-1 rounded hover:bg-slate-800 text-slate-500 border border-transparent";

                } else {

                    devBtn.className = "px-2 py-1 rounded bg-purple-900/40 text-purple-300 border border-purple-700";

                    trainBtn.className = "px-2 py-1 rounded hover:bg-slate-800 text-slate-500 border border-transparent";

                }

                this.updateVisibility();

            }



            openInspector(node) {

                const insp = document.getElementById('inspector');

                insp.classList.remove('translate-x-full');

                document.getElementById('insp-title').innerText = node.label;



                let html = '';



                // Header Info

                html += `<div class="mb-4 text-xs text-slate-400 mono break-all">${node.path || node.title || ''}</div>`;

                html += `<div class="mb-4"><span class="bg-slate-800 text-slate-300 px-2 py-1 rounded text-[10px] uppercase font-bold border border-slate-700">${node.group}</span></div>`;



                // Logic based on Type

                if (node.group === 'class' || node.group === 'function') {

                    // Code Details

                    if (node.docstring) {

                        html += `<div class="mb-4">

                            <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Docstring</h4>

                            <div class="bg-slate-800/50 border border-slate-700 p-3 rounded text-xs text-slate-300 mono whitespace-pre-wrap">${this.escapeHtml(node.docstring)}</div>

                        </div>`;

                    }

                    if (node.args) {

                        html += `<div class="mb-4">

                            <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Arguments</h4>

                            <div class="flex flex-wrap gap-2">

                                ${node.args.map(a => `<span class="bg-blue-900/30 text-blue-300 px-2 py-1 rounded border border-blue-800 text-xs mono">${a}</span>`).join('')}

                            </div>

                        </div>`;

                    }

                    if (node.bases && node.bases.length > 0) {

                        html += `<div class="mb-4">

                            <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Inherits From</h4>

                            <div class="flex flex-wrap gap-2">

                                ${node.bases.map(b => `<span class="bg-purple-900/30 text-purple-300 px-2 py-1 rounded border border-purple-800 text-xs mono">${b}</span>`).join('')}

                            </div>

                        </div>`;

                    }

                    if(node.lineno) {

                        html += `<div class="text-xs text-slate-600 mono">Defined on line ${node.lineno}</div>`;

                    }



                } else if (node.preview) {

                    // Prompt / Knowledge Preview

                     html += `<div class="mb-4">

                            <div class="flex justify-between items-center mb-2">

                                <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Preview / Definition</h4>

                                <button onclick="app.copyContent('${node.id}')" class="text-[10px] bg-slate-800 hover:bg-slate-700 text-purple-400 border border-slate-600 px-2 py-1 rounded transition">

                                    <i class="fas fa-copy mr-1"></i> Copy Context

                                </button>

                            </div>

                            <div class="bg-slate-800/50 border border-slate-700 p-3 rounded text-xs text-slate-300 mono whitespace-pre-wrap h-64 overflow-y-auto custom-scrollbar" id="preview-${node.id}">${this.escapeHtml(node.preview)}</div>

                        </div>`;

                }



                // Connections

                const connectedIds = this.network.getConnectedNodes(node.id);

                if(connectedIds.length > 0) {

                     html += `<div class="mt-6 border-t border-slate-700 pt-4">

                            <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Connections (${connectedIds.length})</h4>

                            <div class="flex flex-wrap gap-1">

                                ${connectedIds.slice(0, 10).map(id => {

                                    const n = this.data.nodes.get(id);

                                    return `<span class="text-[9px] bg-slate-800 text-slate-500 px-1.5 py-0.5 rounded">${n.label}</span>`;

                                }).join('')}

                                ${connectedIds.length > 10 ? `<span class="text-[9px] text-slate-600 px-1">+${connectedIds.length - 10} more</span>` : ''}

                            </div>

                        </div>`;

                }



                document.getElementById('insp-content').innerHTML = html;

            }



            closeInspector() {

                document.getElementById('inspector').classList.add('translate-x-full');

            }



            copyContent(nodeId) {

                // Handle potentially stringified IDs from HTML attributes

                let node = this.data.nodes.get(nodeId);

                if (!node) node = this.data.nodes.get(parseInt(nodeId));



                if(node && node.preview) {

                    navigator.clipboard.writeText(node.preview).then(() => {

                        const btn = document.querySelector(`button[onclick="app.copyContent('${nodeId}')"]`);

                        if(btn) {

                            const original = btn.innerHTML;

                            btn.innerHTML = '<i class="fas fa-check mr-1"></i> Copied';

                            btn.classList.add('text-green-400', 'border-green-800');

                            setTimeout(() => {

                                btn.innerHTML = original;

                                btn.classList.remove('text-green-400', 'border-green-800');

                            }, 2000);

                        }

                    });

                }

            }



            escapeHtml(text) {

                if(!text) return "";

                return text

                    .replace(/&/g, "&amp;")

                    .replace(/</g, "&lt;")

                    .replace(/>/g, "&gt;")

                    .replace(/"/g, "&quot;")

                    .replace(/'/g, "&#039;");

            }

        }



        const app = new SystemGraph();

        document.addEventListener('DOMContentLoaded', () => app.init());

    </script>

    <script src="js/hud.js"></script>

</body>

</html>