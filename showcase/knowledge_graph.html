<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph Visualizer - Analyst OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .node text { pointer-events: none; font-family: sans-serif; font-size: 10px; fill: #cbd5e1; }
        .link { stroke: #475569; stroke-opacity: 0.6; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="bg-slate-900 border-b border-slate-700 p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold text-cyan-400">Analyst OS Knowledge Graph</h1>
        <div class="text-sm text-slate-400">Provenance & Relationship Explorer</div>
    </header>

    <main class="flex-grow relative overflow-hidden" id="graph-container">
        <!-- D3 Graph will be rendered here -->
    </main>

    <script src="js/mock_knowledge_graph_data.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const width = document.getElementById('graph-container').clientWidth;
            const height = document.getElementById('graph-container').clientHeight;

            const data = window.KNOWLEDGE_GRAPH_DATA || { nodes: [], links: [] };

            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const simulation = d3.forceSimulation(data.nodes)
                .force("link", d3.forceLink(data.links).id(d => d.id).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2));

            const svg = d3.select("#graph-container").append("svg")
                .attr("width", width)
                .attr("height", height)
                .call(d3.zoom().on("zoom", (event) => {
                    svg.attr("transform", event.transform);
                })).append("g");

            const link = svg.append("g")
                .attr("class", "links")
                .selectAll("line")
                .data(data.links)
                .join("line")
                .attr("class", "link")
                .attr("stroke-width", d => Math.sqrt(d.value));

            const node = svg.append("g")
                .attr("class", "nodes")
                .selectAll("g")
                .data(data.nodes)
                .join("g")
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            node.append("circle")
                .attr("r", 8)
                .attr("fill", d => color(d.group));

            node.append("text")
                .attr("dx", 12)
                .attr("dy", ".35em")
                .text(d => d.label);

            node.append("title")
                .text(d => d.id);

            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("transform", d => `translate(${d.x},${d.y})`);
            });

            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }

            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }

            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }
        });
    </script>
</body>
</html>
