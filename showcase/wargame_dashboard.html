<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber-Financial Wargame Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Courier New', monospace; }
        .red-team { border-left: 4px solid #ef4444; }
        .blue-team { border-left: 4px solid #3b82f6; }
        .log-entry { transition: all 0.3s; opacity: 0; animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
    </style>
</head>
<body class="p-6 h-screen flex flex-col">

    <header class="mb-6 flex justify-between items-center border-b border-slate-700 pb-4">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-widest">WARGAME CONSOLE</h1>
            <p class="text-slate-400 text-xs">SIMULATION ID: <span id="match-id">LOADING...</span></p>
        </div>
        <div class="text-right">
            <div class="text-sm text-slate-400">SYSTEM HEALTH</div>
            <div class="text-2xl font-bold text-emerald-400" id="health-val">100%</div>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow overflow-hidden">

        <!-- Red Team Panel -->
        <div class="bg-slate-900 border border-red-900/50 p-4 rounded flex flex-col">
            <h2 class="text-red-500 font-bold mb-4 flex items-center">
                <span class="w-2 h-2 bg-red-500 rounded-full mr-2 animate-pulse"></span> RED TEAM (ADVERSARY)
            </h2>
            <div class="space-y-2 overflow-y-auto" id="red-log">
                <!-- Injected via JS -->
            </div>
        </div>

        <!-- Center Display (Battlefield) -->
        <div class="bg-slate-800 border border-slate-700 p-4 rounded flex flex-col items-center justify-center relative">
            <div class="absolute top-4 left-4 text-xs text-slate-500">MARKET STABILITY INDEX</div>

            <div class="w-full max-w-md h-4 bg-slate-700 rounded-full overflow-hidden mb-8">
                <div id="health-bar" class="h-full bg-emerald-500 transition-all duration-500" style="width: 100%"></div>
            </div>

            <div id="battle-status" class="text-xl font-bold text-white text-center animate-pulse">
                INITIALIZING SIMULATION...
            </div>
        </div>

        <!-- Blue Team Panel -->
        <div class="bg-slate-900 border border-blue-900/50 p-4 rounded flex flex-col">
            <h2 class="text-blue-500 font-bold mb-4 flex items-center">
                <span class="w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse"></span> BLUE TEAM (DEFENDER)
            </h2>
            <div class="space-y-2 overflow-y-auto" id="blue-log">
                <!-- Injected via JS -->
            </div>
        </div>

    </div>

    <script>
        async function runSimulation() {
            try {
                // Fetch data generated by python script
                // For simulation feel, we fetch the whole log but render it step-by-step
                const response = await fetch('data/wargame_log.json');
                const data = await response.json();

                document.getElementById('match-id').innerText = data.match_id;

                const logs = data.log;
                let i = 0;

                const interval = setInterval(() => {
                    if (i >= logs.length) {
                        clearInterval(interval);
                        document.getElementById('battle-status').innerText = `WINNER: ${data.winner}`;
                        document.getElementById('battle-status').className = "text-4xl font-bold text-white text-center";
                        return;
                    }

                    const action = logs[i];
                    renderAction(action);
                    updateHealth(data, i); // Approximation based on turn
                    i++;
                }, 800); // 800ms per turn

            } catch (e) {
                console.error(e);
                document.getElementById('battle-status').innerText = "DATA NOT FOUND. RUN SIMULATION SCRIPT.";
            }
        }

        function renderAction(action) {
            const div = document.createElement('div');
            div.className = "bg-slate-800 p-2 rounded text-xs border-l-2 log-entry mb-2";
            div.innerHTML = `
                <div class="font-bold mb-1">${action.action_type}</div>
                <div class="text-slate-400">${action.description}</div>
                <div class="mt-1 text-[10px] opacity-70">Impact: ${action.impact_score.toFixed(1)}</div>
            `;

            if (action.actor === "RED_TEAM") {
                div.classList.add("border-red-500");
                document.getElementById('red-log').prepend(div);
            } else {
                div.classList.add("border-blue-500");
                document.getElementById('blue-log').prepend(div);
            }
        }

        function updateHealth(finalData, currentStep) {
            // Simple visual interpolation logic
            // In a real app we'd have health snapshots per turn
            // Here we assume linear degradation for demo or just flicker
            const health = document.getElementById('health-bar');
            const healthVal = document.getElementById('health-val');

            // Random fluctuation for effect
            const w = parseFloat(health.style.width) - (Math.random() * 2);
            // health.style.width = w + "%";
            // Better: Parse the final health and animate towards it
        }

        document.addEventListener('DOMContentLoaded', runSimulation);
    </script>
</body>
</html>
