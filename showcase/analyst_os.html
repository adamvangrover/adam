<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM Analyst OS | v25.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-dark: #020408;
            --cyan-glow: #00f0ff;
            --purple-glow: #bc13fe;
            --panel-glass: rgba(10, 15, 30, 0.85);
            --dock-glass: rgba(5, 10, 20, 0.6);
        }

        body {
            background-color: var(--bg-dark);
            color: #e2e8f0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            background-image: url('https://images.unsplash.com/photo-1642427749670-f20e2e76ed8c?q=80&w=2000&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        /* Dark overlay for background image */
        .bg-overlay {
            position: absolute; inset: 0; background: rgba(2, 4, 8, 0.85); z-index: -1;
        }

        /* Window Styling */
        .os-window {
            position: absolute;
            background: #020408;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            border-radius: 6px;
            overflow: hidden;
            resize: both;
            min-width: 400px; min-height: 300px;
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .os-window.active {
            border-color: var(--cyan-glow);
            z-index: 50;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.15);
        }

        .window-bar {
            background: #0f172a;
            padding: 6px 10px;
            display: flex; justify-content: space-between; items-center;
            cursor: move;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            user-select: none;
        }

        .window-content { flex-grow: 1; position: relative; }
        iframe { width: 100%; height: 100%; border: none; background: #020408; }

        /* Dock Styling */
        .dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: var(--dock-glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 10px 20px;
            display: flex; gap: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .dock-item {
            width: 48px; height: 48px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            display: flex; justify-content: center; items-center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .dock-item:hover {
            transform: translateY(-5px) scale(1.1);
            background: rgba(255,255,255,0.1);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
        }

        /* Tooltip */
        .dock-item::after {
            content: attr(data-title);
            position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white;
            padding: 4px 8px; border-radius: 4px; font-size: 10px;
            opacity: 0; pointer-events: none; transition: opacity 0.2s;
            white-space: nowrap;
        }
        .dock-item:hover::after { opacity: 1; }

        .app-dot {
            width: 4px; height: 4px; background: var(--cyan-glow); border-radius: 50%;
            position: absolute; bottom: -6px; opacity: 0;
        }
        .app-dot.running { opacity: 1; }

        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div class="bg-overlay"></div>

    <!-- Top Bar -->
    <div class="fixed top-0 left-0 w-full h-8 bg-black/40 backdrop-blur flex justify-between items-center px-4 z-40 border-b border-white/5">
        <div class="flex items-center gap-4 text-[10px] font-bold tracking-widest text-gray-400">
            <span class="text-white">ADAM OS <span class="text-cyan-400">v25.5</span></span>
            <span class="hover:text-white cursor-pointer">FILE</span>
            <span class="hover:text-white cursor-pointer">EDIT</span>
            <span class="hover:text-white cursor-pointer">VIEW</span>
        </div>
        <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 px-2 py-0.5 bg-green-900/20 border border-green-500/30 rounded text-[10px] text-green-400">
                <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
                LOCAL ENVIRONMENT
            </div>
            <div class="text-[10px] text-gray-400 font-mono" id="clock">00:00</div>
        </div>
    </div>

    <!-- Desktop Area -->
    <div id="desktop" class="w-full h-full pt-8 pb-24 relative">
        <!-- Windows injected here -->
    </div>

    <!-- Dock -->
    <div class="dock">
        <div class="dock-item" onclick="openWindow('dcf', 'DCF Valuator', 'apps/dcf.html', 800, 600)" data-title="DCF Valuator">
            <i data-lucide="bar-chart-2" class="text-cyan-400 w-6 h-6"></i>
            <div class="app-dot" id="dot-dcf"></div>
        </div>
        <div class="dock-item" onclick="openWindow('lbo', 'LBO Modeler', 'apps/lbo.html', 800, 600)" data-title="LBO Modeler">
            <i data-lucide="layers" class="text-purple-400 w-6 h-6"></i>
            <div class="app-dot" id="dot-lbo"></div>
        </div>
        <div class="dock-item" onclick="toggleFullScreen()" data-title="Toggle Fullscreen">
            <i data-lucide="monitor" class="text-gray-400 w-6 h-6"></i>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let zIndexCounter = 100;

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        setInterval(updateClock, 1000);
        updateClock();

        function openWindow(id, title, src, w, h) {
            // Check if exists
            let win = document.getElementById(`win-${id}`);
            if (win) {
                // Restore if hidden/minimized logic (not impl yet, just bring to front)
                bringToFront(win);
                return;
            }

            // Create Window
            win = document.createElement('div');
            win.id = `win-${id}`;
            win.className = 'os-window active';
            win.style.width = w + 'px';
            win.style.height = h + 'px';
            // Center roughly
            win.style.top = '10%';
            win.style.left = (20 + (Math.random()*10)) + '%';
            win.style.zIndex = ++zIndexCounter;

            win.innerHTML = `
                <div class="window-bar" onmousedown="startDrag(event, '${id}')">
                    <div class="flex items-center gap-2">
                         <i data-lucide="app-window" class="w-3 h-3 text-gray-500"></i>
                         <span class="text-xs font-bold text-gray-300 tracking-wider">${title}</span>
                    </div>
                    <div class="flex gap-2">
                        <div onclick="closeWindow('${id}')" class="w-3 h-3 rounded-full bg-red-500/50 hover:bg-red-500 cursor-pointer border border-red-500/30"></div>
                    </div>
                </div>
                <div class="window-content">
                    <iframe src="${src}"></iframe>
                </div>
            `;

            document.getElementById('desktop').appendChild(win);
            document.getElementById(`dot-${id}`).classList.add('running');

            // Bring to front on click
            win.onmousedown = () => bringToFront(win);
            lucide.createIcons(); // Refresh icons inside the new HTML string (if any)
        }

        function closeWindow(id) {
            const win = document.getElementById(`win-${id}`);
            if(win) win.remove();
            document.getElementById(`dot-${id}`).classList.remove('running');
        }

        function bringToFront(el) {
            document.querySelectorAll('.os-window').forEach(w => w.classList.remove('active'));
            el.classList.add('active');
            el.style.zIndex = ++zIndexCounter;
        }

        // Drag Logic
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let currentWindow = null;

        function startDrag(e, id) {
            isDragging = true;
            currentWindow = document.getElementById(`win-${id}`);
            bringToFront(currentWindow);

            const rect = currentWindow.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;

            // Prevent text selection inside iframe during drag (iframe overlay fix often needed, but basic here)
            document.body.style.userSelect = 'none';
        }

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !currentWindow) return;

            let x = e.clientX - dragOffset.x;
            let y = e.clientY - dragOffset.y;

            // Bounds check (rough)
            if(y < 32) y = 32; // Below top bar

            currentWindow.style.left = x + 'px';
            currentWindow.style.top = y + 'px';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            currentWindow = null;
            document.body.style.userSelect = 'auto';
        });

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
    </script>
</body>
</html>
