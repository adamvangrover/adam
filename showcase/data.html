<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | Data Vault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Prism for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
    <style>
        .file-tree-item {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: #94a3b8;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .file-tree-item:hover {
            background: rgba(56, 189, 248, 0.1);
            color: #38bdf8;
        }
        .file-tree-item.active {
            background: rgba(56, 189, 248, 0.2);
            color: #fff;
            border-left: 2px solid #38bdf8;
        }
        .folder-toggle {
            margin-right: 6px;
            width: 12px;
            display: inline-block;
            text-align: center;
        }
    </style>
</head>
<body class="h-screen flex flex-col grid-bg overflow-hidden text-slate-200">
    <div class="scan-line"></div>

    <header class="h-16 border-b border-slate-700/50 flex items-center justify-between px-6 bg-[#0f172a]/90 backdrop-blur-md z-40 shrink-0">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-400 hover:text-white transition"><i class="fas fa-arrow-left"></i></a>
            <h1 class="text-xl font-bold tracking-tight mono">ADAM <span class="text-cyan-400">v23.5</span> <span class="text-slate-500 font-normal">| Data Vault</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <button class="bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs px-3 py-1.5 rounded border border-slate-700 transition" onclick="downloadFile()">
                <i class="fas fa-download mr-2"></i> Export
            </button>
        </div>
    </header>

    <main class="flex-1 flex overflow-hidden">

        <!-- Sidebar: File Tree -->
        <aside class="w-80 bg-[#0b1120] border-r border-slate-700/50 flex flex-col">
            <div class="p-4 border-b border-slate-700/50">
                <input type="text" placeholder="Filter files..." class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-1.5 text-xs text-white focus:outline-none focus:border-cyan-500 font-mono" id="file-filter" onkeyup="filterTree(this.value)">
            </div>
            <div class="flex-1 overflow-y-auto p-2 custom-scrollbar" id="file-tree">
                <!-- Injected via JS -->
                <div class="text-center mt-10 text-slate-500 text-xs animate-pulse">Scanning repository structure...</div>
            </div>
            <div class="p-2 border-t border-slate-700/50 text-[10px] text-slate-500 text-center font-mono">
                /root/adam_v23_core
            </div>
        </aside>

        <!-- Main: Code Viewer -->
        <section class="flex-1 flex flex-col bg-[#0f1115] relative">
            
            <!-- Tabs / Breadcrumbs -->
            <div class="h-10 bg-[#0d1117] border-b border-slate-700 flex items-center px-4 justify-between">
                <div class="flex items-center gap-2 text-xs font-mono text-slate-400" id="file-path-display">
                    <i class="fas fa-cube text-cyan-500"></i>
                    <span>Select a file to view content</span>
                </div>
                <div class="text-[10px] text-slate-600 font-mono" id="file-meta">
                    -- lines | -- KB
                </div>
            </div>

            <!-- Editor -->
            <div class="flex-1 overflow-auto custom-scrollbar relative">
                <pre class="m-0 p-4 text-sm font-mono h-full"><code id="code-content" class="language-json">
// System ready.
// Select a file from the vault to inspect.
                </code></pre>
            </div>

        </section>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/nav.js"></script>
    <script>
        let fileSystem = {};
        let currentFile = null;

        document.addEventListener('DOMContentLoaded', () => {
            initFileSystem();
        });

        function initFileSystem() {
            // If mock data has files, use them. Otherwise generate a structure.
            if (window.MOCK_DATA && window.MOCK_DATA.files && window.MOCK_DATA.files.length > 0) {
                // Not implemented in mock_data generator yet usually, so fallback
                buildMockFS();
            } else {
                buildMockFS();
            }
        }

        function buildMockFS() {
            // Simulate a rich file structure based on the project description
            fileSystem = {
                "core": {
                    "agents": {
                        "specialized": {
                            "snc_rating_agent.py": { type: "python", content: "class SNCRatingAgent(AgentBase):\n    def execute(self, context):\n        # Logic for SNC rating..." },
                            "risk_assessment_agent.py": { type: "python", content: "class RiskAssessmentAgent(AgentBase):\n    def assess(self, portfolio):\n        # Monte Carlo sim..." },
                            "market_sentiment_agent.py": { type: "python", content: "class MarketSentimentAgent(AgentBase):\n    # NLP Logic..." }
                        },
                        "orchestrator.py": { type: "python", content: "class Orchestrator:\n    def route(self, task):..." }
                    },
                    "config": {
                        "system_prompt.md": { type: "markdown", content: "# System Role\nYou are Adam, a financial AI..." },
                        "risk_params.json": { type: "json", content: "{\n  \"var_confidence\": 0.99,\n  \"stress_scenarios\": [\"recession\", \"inflation\"]\n}" }
                    }
                },
                "data": {
                    "gold_standard": {
                        "v23_knowledge_graph.json": { type: "json", content: window.MOCK_DATA ? JSON.stringify(window.MOCK_DATA.omni_graph || {}, null, 2) : "{}" }
                    },
                    "reports": {
                        "aapl_credit_memo.json": { type: "json", content: window.MOCK_DATA && window.MOCK_DATA.reports ? JSON.stringify(window.MOCK_DATA.reports[0] || {}, null, 2) : "{}" }
                    }
                },
                "docs": {
                    "architecture.md": { type: "markdown", content: "# Adam v23.5 Architecture\n\n## Overview\nHybrid Neuro-Symbolic System..." },
                    "api_reference.md": { type: "markdown", content: "# API V1\n\n## Endpoints\nPOST /v1/agent/run..." }
                },
                "README.md": { type: "markdown", content: "# Adam Financial System\n\nWelcome to the repository..." }
            };

            renderTree(fileSystem, document.getElementById('file-tree'));
        }

        function renderTree(node, container, path = "") {
            container.innerHTML = "";
            const ul = document.createElement('ul');
            ul.className = "pl-2";

            Object.keys(node).sort().forEach(key => {
                const item = node[key];
                const isFolder = !item.type; // Simplistic check: if no 'type', it's a folder object
                const fullPath = path ? `${path}/${key}` : key;

                const li = document.createElement('li');
                
                const div = document.createElement('div');
                div.className = `file-tree-item flex items-center ${isFolder ? 'text-slate-300 font-bold' : ''}`;
                div.onclick = (e) => {
                    e.stopPropagation();
                    if (isFolder) {
                        // Toggle
                        const childUl = li.querySelector('ul');
                        const icon = div.querySelector('.fa-folder, .fa-folder-open');
                        if (childUl) {
                            childUl.classList.toggle('hidden');
                            if(icon.classList.contains('fa-folder')) {
                                icon.classList.remove('fa-folder');
                                icon.classList.add('fa-folder-open');
                            } else {
                                icon.classList.remove('fa-folder-open');
                                icon.classList.add('fa-folder');
                            }
                        }
                    } else {
                        // Open File
                        openFile(key, item, fullPath);
                        // Highlight
                        document.querySelectorAll('.file-tree-item').forEach(el => el.classList.remove('active'));
                        div.classList.add('active');
                    }
                };

                const iconClass = isFolder ? 'fa-folder text-amber-500' : getFileIcon(key);
                div.innerHTML = `<i class="fas ${iconClass} w-4 text-center mr-2"></i> ${key}`;

                li.appendChild(div);

                if (isFolder) {
                    const subContainer = document.createElement('div'); // Wrapper for recursion
                    renderTree(item, subContainer, fullPath);
                    // Move the UL from subContainer to here
                    if(subContainer.firstChild) li.appendChild(subContainer.firstChild);
                }

                ul.appendChild(li);
            });

            container.appendChild(ul);
        }

        function getFileIcon(filename) {
            if (filename.endsWith('.py')) return 'fa-python text-blue-400';
            if (filename.endsWith('.js')) return 'fa-js text-yellow-400';
            if (filename.endsWith('.json')) return 'fa-code text-green-400';
            if (filename.endsWith('.md')) return 'fa-file-alt text-slate-400';
            if (filename.endsWith('.html')) return 'fa-html5 text-orange-500';
            return 'fa-file text-slate-500';
        }

        function openFile(filename, fileObj, path) {
            currentFile = { name: filename, content: fileObj.content };
            
            document.getElementById('file-path-display').innerHTML = `<i class="fas fa-file-code text-cyan-500"></i> ${path}`;
            
            const lines = fileObj.content.split('\n').length;
            const size = (fileObj.content.length / 1024).toFixed(1);
            document.getElementById('file-meta').innerText = `${lines} lines | ${size} KB`;

            const codeEl = document.getElementById('code-content');
            
            // Set class for Prism
            codeEl.className = ""; // Reset
            if (filename.endsWith('.py')) codeEl.classList.add('language-python');
            else if (filename.endsWith('.json')) codeEl.classList.add('language-json');
            else if (filename.endsWith('.md')) codeEl.classList.add('language-markdown');
            else codeEl.classList.add('language-none');

            codeEl.textContent = fileObj.content;
            
            // Re-highlight
            if(window.Prism) Prism.highlightElement(codeEl);
        }

        function downloadFile() {
            if(!currentFile) return;
            const blob = new Blob([currentFile.content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFile.name;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function filterTree(query) {
            // Simplified filter: just hide items that don't match
            const items = document.querySelectorAll('.file-tree-item');
            if (!query) {
                items.forEach(el => el.parentElement.style.display = 'block');
                return;
            }

            items.forEach(el => {
                // If folder, don't hide yet (or handle logic to show if child matches)
                // For simplicity in this mock, just filtering leaf nodes
                if (el.innerText.toLowerCase().includes(query.toLowerCase())) {
                    el.parentElement.style.display = 'block';
                    // Walk up parents to show folders
                    let parent = el.parentElement.parentElement; // UL
                    while(parent && parent.id !== 'file-tree') {
                        parent.style.display = 'block'; // Show UL
                        if(parent.parentElement) parent.parentElement.style.display = 'block'; // Show LI
                        parent = parent.parentElement.parentElement;
                    }
                } else {
                    el.parentElement.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
