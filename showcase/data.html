<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM | Cortex Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="h-screen flex flex-col grid-bg">
    <div class="scan-line"></div>

    <!-- Nav injected by nav.js -->

    <main class="flex-1 p-6 flex flex-col overflow-hidden">

        <div class="flex justify-between items-end mb-6 border-b border-slate-700 pb-4">
            <div>
                <h2 class="text-3xl font-bold text-white font-mono">CORTEX_DATA_EXPLORER</h2>
                <p class="text-slate-400 text-sm mt-1">Direct access to the system's training data, prompts, and config files.</p>
            </div>
             <div class="flex gap-2 text-xs font-mono text-slate-500">
                <span>Index Status: <span class="text-emerald-400">SYNCED</span></span>
                <span>|</span>
                <span>Total Files: <span class="text-white" id="total-files">--</span></span>
            </div>
        </div>

        <div class="flex-1 glass-panel rounded-lg border border-slate-700 flex overflow-hidden">

            <!-- File Tree Sidebar -->
            <div class="w-1/4 bg-slate-900/50 border-r border-slate-700 flex flex-col">
                <div class="p-3 border-b border-slate-700 bg-slate-800/30">
                    <input type="text" placeholder="Filter files..." class="w-full bg-slate-900 border border-slate-700 rounded px-2 py-1 text-xs text-white focus:outline-none focus:border-cyan-500" onkeyup="filterTree(this.value)">
                </div>
                <div class="flex-1 overflow-y-auto p-2 space-y-1 font-mono text-xs" id="file-tree">
                    <!-- Tree injected via JS -->
                </div>
            </div>

            <!-- Content Viewer -->
            <div class="flex-1 flex flex-col bg-slate-900 relative">
                <!-- Tabs -->
                <div class="flex bg-slate-800 border-b border-slate-700 overflow-x-auto" id="file-tabs">
                    <!-- Tabs injected -->
                </div>

                <!-- Editor/Viewer -->
                <div class="flex-1 overflow-auto p-4 relative group">
                    <pre class="text-sm font-mono text-slate-300 leading-relaxed whitespace-pre-wrap" id="file-content">
                        // Select a file to view its contents...
                    </pre>
                    <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition">
                        <button class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs border border-slate-500 shadow" onclick="copyContent()">Copy</button>
                    </div>
                </div>

                <!-- Status Bar -->
                <div class="bg-slate-800 border-t border-slate-700 p-2 text-[10px] text-slate-500 font-mono flex justify-between">
                    <span id="file-path">No file selected</span>
                    <span id="file-size">0 KB</span>
                </div>
            </div>

        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            renderFileTree();
        });

        function renderFileTree() {
            const tree = document.getElementById('file-tree');
            const files = window.MOCK_DATA.files || [];

            document.getElementById('total-files').textContent = files.length;

            // Organize by directory
            const structure = {};
            files.forEach(f => {
                const parts = f.path.split('/');
                let current = structure;
                parts.forEach((part, i) => {
                    if (i === parts.length - 1) {
                        current[part] = f; // Leaf
                    } else {
                        current[part] = current[part] || {};
                        current = current[part];
                    }
                });
            });

            tree.innerHTML = buildTreeHtml(structure);
        }

        function buildTreeHtml(node, path = '', depth = 0) {
            let html = '';
            const indent = depth * 12;

            // Sort: folders first, then files
            const keys = Object.keys(node).sort((a, b) => {
                const isADir = !node[a].path; // rough check if it's a leaf node object from our structure
                const isBDir = !node[b].path;
                if (isADir && !isBDir) return -1;
                if (!isADir && isBDir) return 1;
                return a.localeCompare(b);
            });

            keys.forEach(key => {
                const item = node[key];
                const isFile = item.path !== undefined;

                if (isFile) {
                    // File
                    let icon = 'üìÑ';
                    if (key.endsWith('.json')) icon = '{}';
                    if (key.endsWith('.md')) icon = 'üìù';
                    if (key.endsWith('.py')) icon = 'üêç';
                    if (key.endsWith('.js') || key.endsWith('.html')) icon = 'üåê';

                    html += `
                        <div class="hover:bg-slate-700 cursor-pointer p-1 rounded flex items-center gap-2 text-slate-400 hover:text-white transition"
                             style="padding-left: ${indent + 8}px"
                             onclick="viewFile('${item.path}')">
                            <span class="opacity-70 w-4 text-center">${icon}</span>
                            <span class="truncate">${key}</span>
                        </div>
                    `;
                } else {
                    // Directory (Folder)
                    html += `
                        <div class="font-bold text-slate-500 hover:text-slate-300 p-1 mt-1 flex items-center gap-2" style="padding-left: ${indent}px">
                            <span>üìÅ</span>
                            <span>${key}/</span>
                        </div>
                        ${buildTreeHtml(item, path + key + '/', depth + 1)}
                    `;
                }
            });
            return html;
        }

        function viewFile(path) {
            // Find file content
            // Since MOCK_DATA.files is just a list of metadata in the memory dump,
            // we'll have to simulate content or check if 'content' property exists.
            // But wait! mock_data.js structure in memory showed "type": "blob", "size": 0
            // It doesn't seem to have actual content.
            // We will have to check other arrays like 'prompts' or 'reports' to find actual text.

            let content = "// Content not available in mock preview.";

            // Try to find if it matches a report or prompt
            const report = window.MOCK_DATA.reports?.find(r => r.file_path === path || r.file_name === path.split('/').pop());
            if (report) {
                content = JSON.stringify(report, null, 2);
            }

            const prompt = window.MOCK_DATA.prompts?.find(p => p.path === path || p.name === path.split('/').pop());
            if (prompt) {
                content = JSON.stringify(prompt, null, 2);
            }

            // If it's a known static file type we might fake it
            if(path.endsWith('.py') && content.startsWith('//')) {
                 content = `
# Source: ${path}
# This is a simulated preview of the python source code.

import os
import sys
from core.system import AgentBase

class ${path.split('/').pop().replace('.py', '').split('_').map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join('')}(AgentBase):
    """
    Implementation for ${path}
    """
    def __init__(self):
        super().__init__()
        self.logger.info("Initializing module...")

    def execute(self, context):
        # TODO: Implement logic
        return {"status": "success"}
                 `;
            }

            document.getElementById('file-content').textContent = content;
            document.getElementById('file-path').textContent = path;
            document.getElementById('file-size').textContent = (content.length / 1024).toFixed(2) + " KB";

            // Update tabs (simple single tab for now)
            document.getElementById('file-tabs').innerHTML = `
                <div class="px-4 py-2 bg-slate-900 border-r border-slate-700 text-cyan-400 text-xs font-mono border-t-2 border-t-cyan-500 flex items-center gap-2">
                    ${path.split('/').pop()}
                    <span class="hover:text-white cursor-pointer">&times;</span>
                </div>
            `;
        }

        function copyContent() {
            const text = document.getElementById('file-content').textContent;
            navigator.clipboard.writeText(text);
            alert("Copied to clipboard!");
        }

        function filterTree(query) {
             // Basic implementation: reload tree?
             // A real filter would hide/show nodes.
             // For this showcase, let's just highlight matches if we wanted to be fancy,
             // or just leave it as visual placeholder.
        }
    </script>
</body>
</html>
