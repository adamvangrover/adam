<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM System | Data & Libraries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="h-screen flex flex-col grid-bg text-slate-200">
    <div class="scan-line"></div>
    <!-- Nav via nav.js -->

    <main class="flex-1 p-8 overflow-y-auto grid grid-cols-12 gap-6">

        <!-- Header -->
        <div class="col-span-12 glass-panel p-6 rounded-lg border-l-4 border-purple-500 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2 font-mono">DATA & LIBRARIES</h1>
                <p class="text-slate-400">Central repository for training sets, financial ontologies, and artisanal data.</p>
            </div>
            <div class="text-right font-mono text-xs text-slate-400">
                 <div class="mb-1"><span class="text-white font-bold">Total Storage:</span> <span id="total-storage">--</span></div>
                 <div><span class="text-white font-bold">Last Index:</span> <span id="last-index">--</span></div>
            </div>
        </div>

        <!-- Directory View -->
        <div class="col-span-12 lg:col-span-8 glass-panel rounded-lg overflow-hidden">
            <div class="bg-slate-900/80 p-3 border-b border-slate-700 flex space-x-2 text-xs font-mono">
                <span class="text-slate-500">ROOT /</span>
                <span class="text-slate-300 hover:text-white cursor-pointer">data</span>
                <span class="text-slate-500">/</span>
                <span class="text-cyan-400 font-bold" id="current-dir">ALL</span>
            </div>

            <table class="w-full text-left text-sm">
                <thead>
                    <tr class="bg-slate-800 text-slate-400 font-mono text-xs uppercase">
                        <th class="p-3">Name</th>
                        <th class="p-3">Type</th>
                        <th class="p-3">Size</th>
                        <th class="p-3">Modified</th>
                        <th class="p-3">Actions</th>
                    </tr>
                </thead>
                <tbody id="file-list" class="divide-y divide-slate-700">
                    <!-- Populated by JS -->
                    <tr><td colspan="5" class="p-3 text-center text-slate-500">Loading data files...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Data Preview / Stats -->
        <div class="col-span-12 lg:col-span-4 flex flex-col space-y-6">

            <!-- Quick Stats -->
            <div class="glass-panel p-4 rounded-lg">
                <h3 class="text-purple-400 font-bold font-mono text-sm mb-3 uppercase">Dataset Quality</h3>
                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span>SNC Training Data</span>
                            <span class="text-white">98.5% Clean</span>
                        </div>
                        <div class="w-full bg-slate-700 h-1 rounded">
                            <div class="bg-emerald-500 h-1 rounded" style="width: 98%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span>Risk Taxonomy Alignment</span>
                            <span class="text-white">92.0%</span>
                        </div>
                        <div class="w-full bg-slate-700 h-1 rounded">
                            <div class="bg-blue-500 h-1 rounded" style="width: 92%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Card -->
            <div class="glass-panel p-4 rounded-lg flex-1 flex flex-col h-64 lg:h-auto">
                <h3 class="text-slate-400 font-bold font-mono text-sm mb-3 uppercase">File Preview</h3>
                <div class="flex-1 bg-slate-900 rounded p-3 font-mono text-xs text-slate-300 overflow-auto whitespace-pre-wrap" id="file-preview">
Select a file to view snippet...
                </div>
            </div>

        </div>

    </main>

    <script src="js/mock_data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/nav.js"></script>
    <script>
        let dataFiles = [];

        document.addEventListener('DOMContentLoaded', () => {
             const data = window.MOCK_DATA || {};
             const allFiles = data.files || [];

             // Filter for data directory
             dataFiles = allFiles.filter(f => f.path.startsWith('data/'));

             renderFiles();
             updateStats();
        });

        function renderFiles() {
            const tbody = document.getElementById('file-list');
            tbody.innerHTML = '';

            if (dataFiles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="p-3 text-center text-slate-500">No data files found.</td></tr>';
                return;
            }

            dataFiles.forEach((file, idx) => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-800 transition cursor-pointer group';
                tr.onclick = () => showPreview(file);

                const name = file.path.replace('data/', '');
                const type = name.split('.').pop().toUpperCase();
                const size = formatSize(file.size);
                const date = new Date(file.last_modified * 1000).toISOString().split('T')[0];

                tr.innerHTML = `
                    <td class="p-3 font-mono text-slate-300 group-hover:text-white flex items-center">
                        <svg class="w-4 h-4 mr-2 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        ${name}
                    </td>
                    <td class="p-3 text-slate-400">${type}</td>
                    <td class="p-3 text-slate-400 font-mono">${size}</td>
                    <td class="p-3 text-slate-500">${date}</td>
                    <td class="p-3">
                        <button class="text-cyan-600 hover:text-cyan-400 font-bold text-xs uppercase" onclick="alert('Download mock')">Download</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function showPreview(file) {
            const el = document.getElementById('file-preview');
            el.innerHTML = '<span class="text-slate-500">Loading...</span>';
            el.classList.add('animate-pulse');

            // Try to fetch content
            const content = await window.dataManager.getFileContent(file.path);

            // Truncate if too long
            const displayContent = content.length > 2000 ? content.substring(0, 2000) + "\n... [Truncated]" : content;

            el.textContent = displayContent;
            el.classList.remove('animate-pulse');
        }

        function formatSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function updateStats() {
            let totalSize = 0;
            dataFiles.forEach(f => totalSize += f.size);
            document.getElementById('total-storage').textContent = formatSize(totalSize);
            document.getElementById('last-index').textContent = new Date().toISOString().replace('T', ' ').substring(0, 16);
        }
    </script>
</body>
</html>
