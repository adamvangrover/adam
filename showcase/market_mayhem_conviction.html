<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM :: CONVICTION PAPER VIEWER</title>
    <link rel="stylesheet" href="css/conviction_paper.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Embedded CSS for simplicity */
        .loading {
            color: #fff;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            margin-top: 100px;
        }
    </style>
</head>
<body>

    <nav class="binder-nav">
        <div style="font-weight: bold; color: #00f3ff; letter-spacing: 1px;">ADAM // CONVICTION PAPER</div>

        <div style="display: flex; gap: 10px;">
            <button id="prevBtn" class="binder-btn" onclick="prevPage()">Previous</button>
            <span id="pageIndicator" style="font-family: 'JetBrains Mono'; font-size: 0.8rem; align-self: center; margin: 0 10px; color: #aaa;">PAGE 1 / 1</span>
            <button id="nextBtn" class="binder-btn" onclick="nextPage()">Next</button>
        </div>

        <div>
            <button class="binder-btn print-btn" onclick="window.print()">PRINT TO PDF</button>
            <a href="market_mayhem_archive.html" class="binder-btn" style="text-decoration: none; margin-left: 10px;">EXIT</a>
        </div>
    </nav>

    <div id="binderContainer" class="binder-container">
        <div class="loading">Loading Intelligence...</div>
    </div>

    <script>
        let articles = [];
        let currentIndex = 0;

        async function loadData() {
            try {
                const response = await fetch('data/market_mayhem_index.json');
                if (!response.ok) throw new Error('Failed to load index');
                articles = await response.json();

                // Filter out items without full body or minimal content
                articles = articles.filter(a => a.full_body && a.full_body.length > 50);

                if (articles.length === 0) {
                    document.getElementById('binderContainer').innerHTML = '<div class="loading">No conviction papers found.</div>';
                    return;
                }

                renderPage(currentIndex);
            } catch (e) {
                console.error(e);
                document.getElementById('binderContainer').innerHTML = `<div class="loading" style="color:red">Error loading data: ${e.message}</div>`;
            }
        }

        function renderPage(index) {
            const container = document.getElementById('binderContainer');
            const item = articles[index];

            // Update Indicator
            document.getElementById('pageIndicator').innerText = `PAGE ${index + 1} / ${articles.length}`;
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === articles.length - 1;

            // Generate Content
            let convictionBadge = '';
            if (item.conviction) {
                convictionBadge = `<div class="conviction-stamp" style="border-color: ${getConvictionColor(item.conviction)}; color: ${getConvictionColor(item.conviction)}">CONVICTION: ${item.conviction}%</div>`;
            }

            // Clean body (sometimes has HTML structure in it, we strip main container if present)
            let bodyContent = item.full_body;
            // Simple cleanup if needed, but usually full_body is just the content HTML

            const html = `
                <div class="paper-sheet">
                    ${convictionBadge}

                    <div class="meta-header">
                        <span>DATE: ${item.date}</span>
                        <span>TYPE: ${item.type || 'REPORT'}</span>
                        <span>ID: ${item.provenance_hash ? item.provenance_hash.substring(0,8) : 'UNKNOWN'}</span>
                    </div>

                    <h1 class="headline">${item.title}</h1>

                    <div style="font-style: italic; font-family: 'Times New Roman', serif; margin-bottom: 30px; border-left: 3px solid #ccc; padding-left: 15px;">
                        ${item.summary}
                    </div>

                    <div class="article-body">
                        ${bodyContent}
                    </div>

                    <div class="footer-note">
                        Generated by ADAM v23.5 | Autonomous Financial Intelligence System<br>
                        Confidential - For Internal Use Only
                    </div>
                </div>
            `;

            container.innerHTML = html;
            window.scrollTo(0, 0);
        }

        function getConvictionColor(score) {
            if (score >= 80) return '#cc0000'; // High conviction red
            if (score >= 60) return '#009900'; // Green
            return '#888'; // Grey
        }

        function nextPage() {
            if (currentIndex < articles.length - 1) {
                currentIndex++;
                renderPage(currentIndex);
            }
        }

        function prevPage() {
            if (currentIndex > 0) {
                currentIndex--;
                renderPage(currentIndex);
            }
        }

        // Initialize
        loadData();

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextPage();
            if (e.key === 'ArrowLeft') prevPage();
        });
    </script>
</body>
</html>
