<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAM v23.5 :: QUANTITATIVE RISK ENGINE</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #00f3ff;
            --accent-color: #0aff60;
            --danger-color: #ff3333;
            --bg-color: #050b14;
            --panel-bg: rgba(5, 11, 20, 0.8);
            --text-primary: #e0e0e0;
            --panel-border: #333;
        }
        body { margin: 0; background: var(--bg-color); color: var(--text-primary); font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Header */
        .cyber-header {
            height: 60px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; border-bottom: 1px solid var(--primary-color);
            background: rgba(5, 11, 20, 0.95); position: sticky; top: 0; z-index: 100;
        }

        .cyber-btn {
            font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; padding: 6px 12px;
            border: 1px solid #444; color: var(--text-primary); background: rgba(0,0,0,0.3);
            border-radius: 2px; text-transform: uppercase; cursor: pointer; text-decoration: none;
        }
        .cyber-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }

        /* Layout */
        .container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 100px);
        }

        .panel {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--panel-border);
            border-radius: 4px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--primary-color);
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Metrics Table */
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #333;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }
        .metric-label { color: #888; }
        .metric-val { color: var(--accent-color); font-weight: bold; }
        .metric-val.danger { color: var(--danger-color); }

        /* Chart Container */
        .chart-wrapper {
            flex-grow: 1;
            position: relative;
        }
    </style>
</head>
<body>
    <header class="cyber-header">
        <div style="display: flex; align-items: center; gap: 20px;">
            <h1 class="mono" style="margin: 0; font-size: 1.5rem; color: var(--primary-color); letter-spacing: 2px;">QUANT RISK ENGINE</h1>
            <div class="mono" style="font-size: 0.8rem; color: #666; border-left: 1px solid #333; padding-left: 10px;">MONTE CARLO SIMULATOR</div>
        </div>
        <nav style="display: flex; gap: 10px;">
            <a href="index.html" class="cyber-btn">BACK TO ARCHIVE</a>
            <button class="cyber-btn" onclick="runSimulation()">RERUN SIMULATION</button>
        </nav>
    </header>

    <div class="container">
        <!-- Main Chart: Paths -->
        <div class="panel" style="grid-row: 1 / 3;">
            <div class="panel-header">
                <span>/// STOCHASTIC PATHS (EBITDA TRAJECTORIES)</span>
                <span class="mono" style="font-size: 0.75rem; color: #666;">MODEL: GBM / ITER: 10,000</span>
            </div>
            <div class="chart-wrapper">
                <canvas id="pathsChart"></canvas>
            </div>
        </div>

        <!-- Secondary Chart: Distribution -->
        <div class="panel">
            <div class="panel-header">
                <span>/// TERMINAL DISTRIBUTION</span>
                <span class="mono" style="font-size: 0.75rem; color: #666;">HORIZON: 12 MONTHS</span>
            </div>
            <div class="chart-wrapper">
                <canvas id="distChart"></canvas>
            </div>
        </div>

        <!-- Metrics Panel -->
        <div class="panel">
            <div class="panel-header">
                <span>/// RISK METRICS (VaR / CVaR)</span>
            </div>
            <div id="metrics-container">
                <!-- Metrics injected by JS -->
            </div>
        </div>
    </div>

    <script>
        // MOCK DATA GENERATOR (Simulating the Agent's Output)
        function generateMockData() {
            const steps = 12;
            const iterations = 50; // Visualized paths
            const dt = 1/12;
            const mu = 0.05;
            const sigma = 0.2;
            const s0 = 100;
            const threshold = 85;

            const paths = [];
            const terminalValues = [];

            for (let i = 0; i < iterations; i++) {
                let path = [s0];
                let current = s0;
                for (let t = 1; t <= steps; t++) {
                    const z = (Math.random() + Math.random() + Math.random() + Math.random() + Math.random() + Math.random()) - 3; // Approx normal
                    current = current * Math.exp((mu - 0.5 * sigma*sigma)*dt + sigma * Math.sqrt(dt) * z);
                    path.push(current);
                }
                paths.push(path);
                terminalValues.push(current);
            }

            // Generate distribution (more points for smoothness)
            const distValues = [];
            for(let i=0; i<1000; i++) {
                 let current = s0;
                 for (let t = 1; t <= steps; t++) {
                    const z = (Math.random() + Math.random() + Math.random() + Math.random() + Math.random() + Math.random()) - 3;
                    current = current * Math.exp((mu - 0.5 * sigma*sigma)*dt + sigma * Math.sqrt(dt) * z);
                 }
                 distValues.push(current);
            }
            distValues.sort((a,b) => a-b);

            // Metrics
            const var95 = distValues[Math.floor(distValues.length * 0.05)];
            const var99 = distValues[Math.floor(distValues.length * 0.01)];
            const cvar95 = distValues.filter(v => v <= var95).reduce((a,b)=>a+b,0) / distValues.filter(v => v <= var95).length;

            return {
                paths: paths,
                terminalDist: distValues,
                metrics: {
                    var95: var95,
                    var99: var99,
                    cvar95: cvar95,
                    threshold: threshold
                }
            };
        }

        let pathsChartInstance = null;
        let distChartInstance = null;

        function initDashboard() {
            const data = generateMockData();
            renderPaths(data.paths, data.metrics.threshold);
            renderDistribution(data.terminalDist, data.metrics.threshold);
            renderMetrics(data.metrics);
        }

        function renderMetrics(metrics) {
            const container = document.getElementById('metrics-container');
            container.innerHTML = `
                <div class="metric-row">
                    <span class="metric-label">Distress Threshold</span>
                    <span class="metric-val danger">$${metrics.threshold.toFixed(2)}M</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">VaR (95%)</span>
                    <span class="metric-val">$${metrics.var95.toFixed(2)}M</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">CVaR (95%)</span>
                    <span class="metric-val">$${metrics.cvar95.toFixed(2)}M</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">VaR (99%)</span>
                    <span class="metric-val">$${metrics.var99.toFixed(2)}M</span>
                </div>
                <div class="metric-row" style="margin-top: 15px; border-top: 1px solid #333; padding-top: 10px;">
                    <span class="metric-label">Default Probability</span>
                    <span class="metric-val danger">Low (< 1%)</span>
                </div>
            `;
        }

        function renderPaths(paths, threshold) {
            const ctx = document.getElementById('pathsChart').getContext('2d');
            const labels = Array.from({length: 13}, (_, i) => `Month ${i}`);

            const datasets = paths.map(path => ({
                data: path,
                borderColor: 'rgba(0, 243, 255, 0.3)',
                borderWidth: 1,
                pointRadius: 0,
                fill: false,
                tension: 0.4
            }));

            // Threshold Line
            datasets.push({
                label: 'Distress Threshold',
                data: Array(13).fill(threshold),
                borderColor: '#ff3333',
                borderWidth: 2,
                borderDash: [5, 5],
                pointRadius: 0,
                order: 0
            });

            if (pathsChartInstance) pathsChartInstance.destroy();

            pathsChartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#888' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#888' }
                        }
                    },
                    animation: { duration: 2000 }
                }
            });
        }

        function renderDistribution(values, threshold) {
            const ctx = document.getElementById('distChart').getContext('2d');

            // Histogram Bins
            const min = Math.min(...values);
            const max = Math.max(...values);
            const bins = 20;
            const step = (max - min) / bins;
            const histogram = Array(bins).fill(0);
            const labels = [];

            for(let i=0; i<bins; i++) {
                labels.push((min + i*step).toFixed(0));
            }

            values.forEach(v => {
                const bin = Math.min(Math.floor((v - min) / step), bins - 1);
                histogram[bin]++;
            });

            const bgColors = labels.map(l => parseFloat(l) < threshold ? 'rgba(255, 51, 51, 0.6)' : 'rgba(10, 255, 96, 0.6)');

            if (distChartInstance) distChartInstance.destroy();

            distChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: histogram,
                        backgroundColor: bgColors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: false },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#888', font: {size: 10} }
                        }
                    }
                }
            });
        }

        function runSimulation() {
            initDashboard();
        }

        // Initialize
        initDashboard();

    </script>
</body>
</html>